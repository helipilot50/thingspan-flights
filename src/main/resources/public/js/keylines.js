//
//     KeyLines v2.11.1-2272 professional eval
//
//     Copyright Â© 2011-2016 Cambridge Intelligence Limited.
//     All rights reserved.
//

!function(){var e={};"undefined"!=typeof window&&(window.KeyLines=e="undefined"!=typeof window.KeyLines?window.KeyLines:e),e.TimeBar={},"object"==typeof module&&"object"==typeof module.exports?(global.KeyLines=e,module.exports=e):"function"==typeof define&&define.amd&&define(e)}(),!function(){var e=KeyLines.Controller={};e.createController=function(t,n,r,i,a){function o(){var e=yt();return"undefined"==typeof e.isActuallyTheFlashLoader}function u(e,t){for(var n in e)s(e[n].im)&&(e[n].im=e[t].im)}function s(e){var t="undefined"!=typeof e.naturalWidth&&0===e.naturalWidth;if(/.*\.svg$/.test(e.src)){var n=28===e.width&&30===e.height;return t&&(0===e.width||n)}return t}function c(){return{icon:!0,shown:!1,size:100}}function l(e){st.selectedNode&&st.selectedNode.u&&(e[rt+st.selectedNode.u]=1)}function f(e){if(KeyLines.fontsLoader){var t=[];if(st.fontFamily&&t.push(st.fontFamily),st.iconFontFamily&&t.push(st.iconFontFamily),st.bands)for(var n=0;n<st.bands.length;n++)st.bands[n].ff&&t.push(st.bands[n].ff);st.watermark&&st.watermark.ff&&t.push(st.watermark.ff),KeyLines.fontsLoader(t,e)}else e()}function d(){r.setup();var t=st.watermark;t&&r.addTextWatermark(t.u?rt+t.u:void 0,t.t,t.fs||80,t.fc||W.colours.lightgrey,t.fb,t.fbc,t.a,t.ff?t.ff:st.fontFamily),st.navigation&&r.addNavigation(Z,Q,$,X,W,mt),st.overview&&r.addOverview(Z,Q,X,vt,mt,st),st.logo&&r.addLogo(rt+st.logo),r.remove(p(nt,Lt),p(nt,Tt),p(nt,ft)),e.e&&r.remove(p(nt,Lt),p(nt,Tt),p(nt,ft)),r.addBanding(st)}function h(e,t){for(var n in t){var r=e[n],i=t[n];q.isNormalObject(r)&&q.isNormalObject(i)?h(r,i):"id"!==n&&"string"==typeof i&&r&&(e[n]=W.hsla(r),t[n]=W.hsla(i))}}function v(e,t){for(var n=0;n<t.length;n++)h(e[n],t[n])}function g(e,t,n){if("number"==typeof e)return e+n*(t-e);if(q.isArray(e)){var r;return Math.abs(e[0]-t[0])>.5?(r=e[0]<t[0]?g(1+e[0],t[0],n):g(e[0],1+t[0],n),r-=Math.floor(r)):r=g(e[0],t[0],n),W.fromhsla([r,g(e[1],t[1],n),g(e[2],t[2],n),g(e[3],t[3],n)])}return t}function m(e,t,n){var r={};for(var i in e)r[i]=t.hasOwnProperty(i)?g(e[i],t[i],n):e[i];return r}function y(e,t,n,r,i,a){Z.setProperties(e,!1,!0),Z.animateProperties(t,{time:r},function(){i>1?y(e,t,n,r,i-1,a):(Z.setProperties(n,!1,!0),a())},!0)}function p(e,t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(e.charCodeAt(r)+t[r]);return n}function x(e){return 1-e}function w(e){return e}function M(e,t,n,r){var i=n;return{animate:function(a){i-=a;var o=Math.max(0,Math.min(1,(n-i)/n));Ct=t(o);var u=i>0;return u||(Q.resurrect(e,!0),Ct=.5,q.invoke(r)),u}}}function b(e,t,n){if(0===e.length)q.invoke(n);else{Ct=1,Q.ghost(e);var r,i=Q.showHideGetLinksToBend(e,!1);i.length>0?(t=2*t/3,r=function(){Z.animateProperties(i,{time:t/2,queue:!1},n,!0)}):r=n;var a=M(e,x,t,function(){Q.hide(e),q.invoke(r)});Mt(a,!0)}}function k(e,t,n){function r(){var r=M(e,w,t,n);Mt(r,!0)}if(0===e.length)q.invoke(n);else{Ct=0,Q.ghost(e);var i=Q.showHideGetLinksToBend(e,!0);i.length>0?(t=2*t/3,Z.animateProperties(i,{time:t/2,queue:!1},r,!0)):r()}}function L(){var e=1200,t=0;return{animate:function(n){return t+=n,zt=Math.floor(8*(1-t%e/e)),Pt}}}function T(){if(Pt){Ot.reset([W.layers.WAIT]),Ot.layer(W.layers.WAIT);for(var e=X.scale(X.width()/2),t=X.scale(X.height()/2),n=X.scale(30),r=0;8>r;r++){var i=r*Math.PI/4,a=e+n*Math.cos(i),o=t+n*Math.sin(i),u=.2+.8*((r+zt)%8)/8;Ot.circle(a,o,X.scale(10),W.colours.white,-1,"rgba(145, 146, 149, "+u+")",!0)}}}function S(e,t){$.hasOwnProperty("drawImageDirectAlpha")?$.drawImageDirectAlpha(e,0,0,e.width,e.height,0,0,e.width,e.height,t):($.globalAlpha=t,$.drawImage(e,0,0,e.width,e.height,0,0,e.width,e.height),$.globalAlpha=1)}function C(e){Q.resetDrawing(),Ot.reset(),Q.generate(Ot,$,X,V,Et,function(e){return!e.gh},rt),Dt.reset(),Q.generate(Dt,$,X,V,null,function(e){return e.gh},rt),It=Q.getResizePrimitive(),I(e),r.generate(Ot,$,X,V,dt,!1,e,rt),T()}function I(e){e||dt&&dt.generate&&(Ot.layer(W.layers.DRAGGERS),dt.generate(Ot))}function O(e,t,n){var r=St.getContext("2d");W.clear(r,X.width(),X.height()),W.draw(r,t,V,e),S(St,n)}function E(e,t){un>83158461||(W.draw(e,Ot,V,W.topLayers),t||r.drawOverviewContent(e,X),W.draw(e,Ot,V,[W.layers.OVERVIEW]))}function D(e,t){var n=St.getContext("2d");W.clear(n,X.width(),X.height()),E(n,t),S(St,e)}function P(e){st.smearMode||W.clear($,X.width(),X.height()),At($),Pt?(O([W.layers.BANDS,W.layers.UNDERLAYS],Ot,.5),O(W.bgLayers,Dt,Ct*st.backgroundAlpha/2),O(W.topLayers,Dt,Ct/2),O(W.bgLayers,Ot,st.backgroundAlpha/2),D(.5,e),W.draw($,Ot,V,[W.layers.WAIT])):(W.draw($,Ot,V,[W.layers.BANDS,W.layers.UNDERLAYS]),O(W.bgLayers,Dt,Ct*st.backgroundAlpha),O(W.topLayers,Dt,Ct),O(W.bgLayers,Ot,st.backgroundAlpha),E($,e))}function z(e){V&&(Ot.reset(W.overlayLayers),r.generate(Ot,e,X,V,dt,!0,!1,rt),dt&&dt.excludeHit?J.exclusions(dt.excludeHit()):J.exclusions(null))}function A(e,t){return function(){var r=Bt(e,t);(Q.getByID(r)||!r)&&r!==Nt&&(Nt=r,n.trigger("hover",q.rawId(r),e,t,q.subId(r)))}}function B(e,t){Ut&&clearTimeout(Ut),Ut=setTimeout(A(e,t),st.hover)}function U(e,t,n,r){if(dt.scrollable&&st.dragPan){var i=X.maybeScroll(e,t,dt,n,r);Mt(i)}}function N(e,t,n,r,i){dt&&dt.endDrag(e,t,n,r,i),dt=null,ht("auto"),pt()}function K(e){return function(t,n,r,i){V&&Q&&(ct()?a.internalUse.zoom(e,t,n,r):(Mt(X[e](Q,$,V,W,t,n,r,rt,i)),pt()))}}function R(e,t){var n="radial"!==e;return t=q.defaults(t,{fixed:[]}),Q.extractStructure($,t,n)}function F(e,t,r){var i,a;if(e){var o=Math.max(0,Math.min(t.time||700,2e3)),u="linear"===t.easing?n.linearEasing:n.cubicEasing,s=e.extents;i=Q.makeAnimator(e.vertices,o,u),a=X.fitWorldExtents(e.extents,!0,!0,!0,!0,o,r),t.animate?(bt(i),t.fit?bt(a):s&&bt(Yt(o,r))):(Q.applyVertices(e.vertices),s&&(t.fit?X.fitWorldExtents(e.extents,!1,!0,!0,!0,0,r):q.invoke(r)),pt())}else q.invoke(r)}function _(e){return function(t,n){F(t,n,e)}}function H(){Gt&&(clearTimeout(Gt),Gt=null)}function j(){qt&&(clearTimeout(qt),qt=null)}var Y=KeyLines.Combo,G=KeyLines.Common,W=KeyLines.Rendering,q=KeyLines.Util,Z={},V=null,X=null,$=null,Q=null,J=null,et=1,tt=window["D"+9884..toString(30)][25871..toString(33)]()/24528;Z.combo=Y.create(t,i);var nt="Cambridge Intelligence";Z.wait=function(e){return"undefined"!=typeof e&&e!==Pt&&(Pt=e,e&&Mt(L())),Pt};var rt="";Z.imageBasePath=function(e){return e&&(rt=e),rt},Z.imageList=function(e){return e&&(V=e),V},Z.setCanvas=function(e){$=e,i.setDashSupport("setLineDash"in $)},Z.setView=function(e){X=e},Z.setShadowCanvas=function(e,t,n){J=G.hitTester(e,t,n,Ot,z)},Z.setModel=function(e){Q=e,Q.setOptions(st)};var it=0,at=null,ot=[],ut=Z.afterChange=function(e,t){if(d(),t)pt(),q.invoke(e);else{e&&ot.push(e);var n=Q.imageList(rt);r.appendImageList(n),l(n);var i=o();if(i){var a=mt+"Missing.png";n[a]=1}V&&(at=V,V=null),at=at||{};var s={};for(var c in n)at[c]||(s[c]=1);!function(e){W.imageLoader(yt,gt,s,function(t,n){if(e===it){if(tt>59492906)return;V=at;for(var o in n)V[o]={im:n[o]};if(i&&u(V,a),r.colorize(V,vt,st.controlColour),W.circularize(V,n,vt),pt(),ot.length>0){var s=ot;ot=[];for(var c=0;c<s.length;c++)q.invoke(s[c])}}})}(++it)}},st={arrows:"normal",backgroundAlpha:.2,controlColour:W.colours.midgrey,dragPan:!0,fanLength:64,handMode:!1,allowOversizedText:!1,hover:1e3,navigation:!0,linkEnds:{spacing:"tight",avoidLabels:!0},overview:c(),marqueeLinkSelection:"centre",watermark:{fb:!0},gestures:!0};Z.options=function(e,t,n){if(e){e=e||{};for(var r in e)st[r]=e[r],"overview"===r&&(e[r]===!0&&(st[r]=c()),e[r]||(st[r]=c(),st[r].icon=!1,st[r].shown=!1)),"watermark"===r&&q.isNormalObject(e[r])&&(e[r].fc&&(st[r].fc=e[r].fc&&W.validatergb(e[r].fc)?e[r].fc:void 0),e[r].fbc&&(st[r].fbc=e[r].fbc&&W.validatergb(e[r].fbc)?e[r].fbc:void 0)),"selectedNode"!==r&&"selectedLink"!==r||!q.isNormalObject(st[r])||Q.ensureObject(st[r]);Q.setOptions(st),X.setMaxItemZoom(st.maxItemZoom),X.setMinZoom(st.minZoom),ct()&&a.internalUse.enableDragging(st.handMode),f(function(){ut(t,n)})}return q.clone(st)};var ct=Z.inMapMode=function(){return a&&a.api.isShown()};Z.watermarkSize=function(){return r.getWatermarkSize($,V)},Z.load=function(e,t){V=null,Q.load(e),Z.combo.internalUse.loadUp(e.combos),e.viewSettings&&Z.setViewSettings(e.viewSettings,!1),a?a.internalUse.loadUp(e.map,t):q.invoke(t)},Z.merge=function(e){n.trigger("prechange","merge");var t=Z.combo.internalUse.preMerge(e);return ct()&&(t=a.internalUse.preMerge(t)),Q.merge(t)},Z.appendCombos=function(e){e.combos=Z.combo.internalUse.serialize()},Z.postMerge=function(e){Z.combo.internalUse.postMerge(e)},Z.setItem=function(e){var t=Z.combo.internalUse.preMerge([e])[0];return t&&ct()&&a.internalUse.preSetItem(t),!!t&&Q.setItem(t)};var lt=Z.removeItem=function(e){Z.combo.internalUse.preDelete(e),Q.removeItem(e)};Z.setProperties=function(e,t,r){return r||n.trigger("prechange","properties"),ct()&&a.internalUse.convertPos(e),Q.setProperties(e,t)},Z.setViewSettings=function(e,t,n,r){Mt(X.fromSettingsDirect(e,t,n,r))};var ft=[47,6,-11,-58,-64,-52,-48,-59,-51,21,-22,-66,-66,-48,-58,-67];Z.animateProperties=function(e,t,r,i){function o(e){for(var t in e)"undefined"==typeof e[t]&&(e[t]=Q.defaultValueFor(t))}function u(e){for(var t=0;t<e.length;t++){var n=Q.getByID(e[t].id);if(n){o(e[t]),x.push(e[t]);var r=s(e[t],n);p.push(r)}}}function s(e,t){var n={};for(var r in e)"id"!==r&&(n[r]=q.clone(t[r]||Q.defaultValueFor(r)));return n}function c(e){return/^ha[0-9]$/.test(e)||"fi"===e}i||n.trigger("prechange","properties"),ct()&&a.internalUse.convertPos(e);var l=t.time,f=n.linearEasing;"cubic"===t.easing&&(f=n.cubicEasing);var d=l,h=!0,y=q.clone(e),p=[],x=[],w={animate:function(e){h&&(Q.ensureTypesInArray(y,!0),u(y),v(p,x),h=!1),d-=e;for(var n=f(Math.max(0,Math.min(1,(l-d)/l))),i=d>0,a=[],o=0;o<x.length;o++){var s={id:x[o].id};for(var w in x[o])c(w)?s[w]=m(p[o][w],x[o][w],n):"id"!==w&&(s[w]=g(p[o][w],x[o][w],n));a.push(s)}if(Q.applyChanges(a),i){if(t.cb)try{t.cb.call(this,n,l-d)}catch(M){}}else q.invoke(r);return i}};Mt(w,t.queue)},Z.ping=function(e,t,n){function r(e,t,n,r){var i={id:t};i[n]=r,e.push(i)}e=q.ensureArray(e);for(var i=[],a=[],o=[],u=0;u<e.length;u++){var s=e[u],c=Q.getByID(s);if(c&&"node"===c.type){for(var l=9;l>0&&c["ha"+l];)l--;if(l>0||!c.ha0){var f="ha"+l;r(i,s,f,{r:Math.max(28-t.w/2,0),w:0,c:t.c});var d=W.hsla(t.c),h=W.fromhsla([d[0],d[1],d[2],.001]);r(a,s,f,{r:t.r,w:t.w,c:h}),r(o,s,f,null)}}}i.length>0?y(i,a,o,t.time,t.repeat,function(){Z.afterChange(n,!0)}):Z.afterChange(n,!0)};var dt=null,ht=function(){};Z.setCursorFn=function(e){ht=e};var vt=function(){};Z.setCreateCanvasFn=function(e){vt=e};var gt="";Z.setPath=function(e){gt=e};var mt;Z.assetPath=function(e){return e&&(mt=e),mt};var yt=function(){};Z.setImageGenFn=function(e){yt=e};var pt=Z.render=function(){n.trigger("redraw")},xt=G.animator(pt),wt=G.animator(pt);Z.animate=function(e){var t=on?on:dt,n=xt.animate(e,t,Q),r=wt.animate(e);return n||r},Z.cancelAnimation=xt.cancel;var Mt=Z.pushAnimation=xt.push;Z.cancelLayoutAnimation=wt.cancel;var bt=Z.pushLayoutAnimation=wt.push,kt=Z.backgroundOpacity=function(e){return arguments.length>0&&(et=e,pt()),et};Z.animateBackgroundOpacity=G.makeValueAnimator(xt,kt);var Lt=[8,4,12,-22,-9,5,1,12,-69,37,45,-13,-8,16,-11,8,0,8,9,-78,-67],Tt=[47,6,-11,-58,-64,-57,-48,-59,-51,19,-16,-66,-66,-48,-58,-67],St=null;Z.makeGhostCanvas=function(e,t){St=vt(e,t)};var Ct=.5;Z.hide=function(e,t,n){t.animate?b(e,t.time,n):(Q.hide(e),Q.showHideBendLinks(e),pt(),q.invoke(n))},Z.show=function(e,t,n,r){Q.show(e,t),n.animate?k(e,n.time,r):(Q.showHideBendLinks(e),pt(),q.invoke(r))};var It,Ot=W.instructionPool(),Et=W.pool(),Dt=W.instructionPool(),Pt=!1,zt=3,At=Z.drawBackground=function(e){W.backFill(e,"white",et,X.scale(X.width()),X.scale(X.height())),st.backColour?W.backFill(e,st.backColour,et,X.scale(X.width()),X.scale(X.height())):st.gradient&&W.backgroundGradient(e,st.gradient.stops,et,X.width(),X.height())};Z.labelPosition=function(e,t){return C(!1),Q.labelPosition(e,t)},Z.draw=function(e){V&&(C(e),P(e))},Z.drawoffscreen=function(){V&&J.dirty()};var Bt=Z.hittest=function(e,t,n){return J.test(e,t,n)};Z.afterDraw=function(){dt&&dt.mouseMoved&&dt.mouseMoved()&&dt.afterDraw(Bt(Rt,Ft),Rt,Ft)};var Ut,Nt;Z.dragover=function(e,t){A(e,t)()},Z.resetState=function(){dt=null},Z.startDragger=function(e,t,n,r){if(Q&&(n=X.oldToNewX(n),r=X.oldToNewY(r),dt=Q.startDragger(Z,$,X,e,n,r,t),dt&&e)){var i=dt.getCursor(n,r);ht(i)}};var Kt;Z.mousedown=function(e,t,i,a,o){if(Q){var u,s;if(dt)N(!0,t,i,a,o);else{u=Bt(t,i),Kt=u;var c=n.trigger("mousedown",q.rawId(u),X.unscale(t),X.unscale(i),e,q.subId(u));if(Q.getByID(u)||!u){var l=!1;l=0===e?st.handMode?u?!Q.isSelected(u)||a:!1:!Q.isSelected(u)||a||!u:!u||!Q.isSelected(u),c&&(l=!1),l&&Q.setSelection(u,a,o),0===e&&(dt=Q.createDragger(Ot,Et,Z,$,X,u,t,i,st,a,o,It),dt&&u&&(s=dt.getCursor(t,i),ht(s))),pt(),2===e?n.trigger("contextmenu",q.rawId(u),X.unscale(t),X.unscale(i),q.subId(u)):n.trigger("click",q.rawId(u),X.unscale(t),X.unscale(i),e,q.subId(u))}else 0===e&&(dt=r.createDragger(u,t,i),dt&&u&&(s=dt.getCursor(t,i),ht(s))),(0===e||1===e)&&(n.trigger("click",q.rawId(u),X.unscale(t),X.unscale(i),e,q.subId(u)),pt())}}};var Rt,Ft,_t;Z.mousemove=function(e,t,n,i,a){Rt=e,Ft=t;var o="auto";if(dt&&!a)dt.mouseMoved&&dt.mouseMoved(!0),U(e,t,n,i),dt.dragMove(e,t,n,i),o=dt.getCursor(e,t),pt();else if(Q){var u=Q?Bt(e,t):null;B(e,t),Q.getByID(u)?u&&(o=Q.getCursor(u,mt)):o=r.getCursor(u)}_t===o||a||(ht(o),_t=o)},Z.mouseup=function(e,t,n,r){dt&&N(!0,e,t,n,r)},Z.mouseleave=function(e,t,n,r){arguments.length&&dt&&(!st.dragPan||ct()&&st.handMode)&&N(ct(),e,t,n,r)},Z.dblclick=function(e,t){var r=Kt;dt&&N(!1),!r&&X&&(n.trigger("dblclick",null,X.unscale(e),X.unscale(t))||jt(!0)),r&&Q.getByID(r)&&n.trigger("dblclick",q.rawId(r),X.unscale(e),X.unscale(t),q.subId(r))};var Ht;Z.mousewheel=function(e,t,r){if(X){var i=(new Date).getTime();if(Ht&&100>i-Ht)return;Ht=i,n.trigger("mousewheel",e,X.unscale(t),X.unscale(r))||Mt(X.wheelToPosition(e,t,r))}},Z.keyup=function(e){27===e&&N(!1)},Z.keydown=function(e,t,r){if(Q&&!n.trigger("keydown",e,t,r)){if(65===e&&t)return Q.selectAll(),pt(),!0;if(Q.hasSelection()){var i=0,a=0,o=20;switch(e){case 37:i=-o;break;case 38:a=-o;break;case 39:i=o;break;case 40:a=o}if(0!==i||0!==a)return n.trigger("prechange","move"),Q.moveSelection(i,a),pt(),!0;if(46===e){var u=n.trigger("delete");if(!u){n.trigger("prechange","delete");var s=Q.selectionPlusDummyNodes();lt(s)}return pt(),!0}113===e&&n.trigger("edit",Q.doSelection())}return!1}},Z.panBy=function(e,t,n,r,i){Mt(X.panBy(e,t,n,!1,r,i)),pt()},Z.pan=function(e,t,n,r){ct()?a.internalUse.pan(e,t,n,r):(Mt(X.pan(e,t,n,r)),pt())};var jt=Z.zoomIn=function(e,t,n){ct()?a.internalUse.zoom("in",e,t,n):(Mt(X.zoomIn(e,t,n)),pt())};Z.zoomOut=function(e,t,n){ct()?a.internalUse.zoom("out",e,t,n):(Mt(X.zoomOut(e,t,n)),pt())},Z.setZoom=function(e,t,n,r){ct()?a.internalUse.setZoom(e,t,n,r):(Mt(X.setZoom(e,t,n,r)),pt())},Z.modelExtents=function(){return X.modelExtents(Q,$,V,W,rt)},Z.fitToModel=K("fitToModel"),Z.fitToSelection=K("fitToSelection"),Z.fitModelHeight=K("fitModelHeight");var Yt=function(e,t){var n=e;return{animate:function(e){n-=e;var r=0>n;return r&&q.invoke(t),!r}}};Z.layout=function(e,t,r){if(Q){t=t||{};var i=R(e,t);Q.layout(e,n,i,t,_(r))}},Z.arrange=function(e,t,r,i){if(Q){var a=R(e,r);Q.arrange(e,n,t,a,r,_(i))}};var Gt,Wt,qt,Zt,Vt,Xt,$t,Qt;Z.touchstart=function(e){if(Qt=e,2===e.length&&(rn=(e[0].x+e[1].x)/2,an=(e[0].y+e[1].y)/2,tn=rn,nn=an),1===e.length){Zt=e[0].x,Vt=e[0].y,$t=e[0].id;var t=Bt(Zt,Vt);if(Gt?t!==Xt?H():Wt=!0:(Wt=!1,Gt=setTimeout(H,600)),Xt=t,qt=setTimeout(function(){j(),dt&&N(!1),n.trigger("contextmenu",q.rawId(Xt),X.unscale(Zt),X.unscale(Vt),q.subId(Xt))},600),Q.getByID(Xt)||!Xt){var i=n.trigger("touchdown",q.rawId(Xt),X.unscale(Zt),X.unscale(Vt),q.subId(Xt));i||(Xt?Q.isSelected(Xt)||Q.setSelection(Xt,!1,!1):st.handMode||Q.setSelection(null,!1,!1)),dt=Q.createDragger(Ot,Et,Z,$,X,Xt,Zt,Vt,st,void 0,void 0,It),pt()}else dt=r.createDragger(Xt,Zt,Vt)}};var Jt,en,tn,nn;Z.touchmove=function(e){Qt=e,e.length>=2&&(tn=(e[0].x+e[1].x)/2,nn=(e[0].y+e[1].y)/2);for(var t=0;t<e.length;t++)$t===e[t].id&&(Jt=e[t].x,en=e[t].y);if(qt){var n=(Jt-Zt)*(Jt-Zt)+(en-Vt)*(en-Vt);n>100&&j()}on||dt&&$t===e[0].id&&1===e.length&&(Rt=e[0].x,Ft=e[0].y,dt.mouseMoved&&dt.mouseMoved(!0),U(e[0].x,e[0].y),dt.dragMove(e[0].x,e[0].y,!1,!1),pt())},Z.touchend=function(e,t){if(Qt=e,pt(),qt&&(j(),ct()||n.trigger("click",q.rawId(Xt),X.unscale(Zt),X.unscale(Vt),0,q.subId(Xt))),Gt&&Wt){H();var r=n.trigger("dblclick",q.rawId(Xt),X.unscale(Zt),X.unscale(Vt),q.subId(Xt));r||Xt||jt(!0)}if(!on&&dt){for(var i=-1,a=0;a<t.length;a++)t[a].id===$t&&(i=a);i>-1&&0===e.length?N(!0,t[i].x,t[i].y,!1,!1):e.length>0&&(Zt=e[0].x,Vt=e[0].y,$t=e[0].id,Xt=Bt(Zt,Vt),(Q.getByID(Xt)||!Xt)&&(Q.setSelection(Xt,!1,!1),dt=Q.createDragger(Ot,Et,Z,$,X,Xt,Zt,Vt,st,void 0,void 0,It)))}},Z.touchcancel=function(){j(),dt&&N(!1)};var rn,an,on;Z.gesturestart=function(){},Z.gesturechange=function(e,t){j(),st.gestures&&(on||(on=Q.createGestureDragger(X,rn,an)),on.dragMove(e,t,tn,nn),pt())},Z.gestureend=function(e,t){on&&on.endDrag(!0,e,t,tn,nn),on=null};var un=window[String.fromCharCode(68,97,116,101)][String.fromCharCode(110,111,119)]()/17555;return Z}}(),!function(){var e=KeyLines.API=KeyLines.API||{};e.createAPI=function(e){function t(){return s&&s.api.isShown()}function n(e,t){e?k.afterChange(t):(k.render(),g.invoke(t))}function r(e){return e===!0&&(e={animate:!0}),g.defaults(e,{animate:!1,time:1e3})}function i(e){return isFinite(e)?Math.min(Math.max(0,e),1):e?1:0}function a(e,t){function n(e,t,n){y.privateEach({type:"link"},function(e){if(!t[e.id1]||!t[e.id2]){var r=t[e.id1]||t[e.id2],i=t[e.id1]?e.id2:e.id1;r&&i&&(n[i]||(n[i]={x:0,y:0,counter:0,id:i}),n[i].x+=r.x,n[i].y+=r.y,n[i].counter++)}});var r=0;return g.iterator(n,function(e){t[e.id]||(e.x/=e.counter,e.y/=e.counter,t[e.id]=e,r++)}),r}function r(e,r){for(var i,a={},u=[];0!==i;)i=n(e,r,a);g.iterator(e,function(e){"node"===e.type&&(a[e.id]||(e.x=o[e.id].x,e.y=o[e.id].y))}),g.iterator(a,function(e){u.push(e)}),y.setProperties(u,!1,function(){g.invoke(t,s)})}function i(){var e=[],t={};return M.each({type:"node"},function(n){e.push(n.id),t[n.id]=n}),{list:e,dict:t}}function a(e){for(var t=[],n={},r=0;r<e.length;r++){var i=e[r];g.isNullOrUndefined(i)||n[i.id]||(n[i.id]=1,o[i.id]={x:i.x,y:i.y},delete i.x,delete i.y,t.push(i))}return t}var o={};e=a(e);var u=i(),s=u.list,c=u.dict;y.merge(e,function(){r(e,c)})}function o(e){k.draw(e),k.drawoffscreen(),k.afterDraw()}var u,s,c=KeyLines.Controller,l=KeyLines.Draggers,f=KeyLines.Events,d=KeyLines.Model,h=KeyLines.Overlays,v=KeyLines.Rendering,g=KeyLines.Util,m=KeyLines.View,y={},p=f.createEventBus(),x=l.createDraggers(p),w=KeyLines.Generator.create(p),M=d.createModel(p,x,w);s=KeyLines.Map.create(y,p,e);var b=h.createOverlays(p,m,s),k=c.createController(y,p,b,w,s);k.setModel(M);var L;y.privateInit=function(e,t,n,r,i,a,o,u,s){L=r,k.assetPath(o),k.setCursorFn(i),k.setCreateCanvasFn(r),k.setImageGenFn(a),T(e,t,n,u),k.imageBasePath(s)};var T=y.privateSetSize=function(e,t,n,r,i){var a=L(t,n);k.makeGhostCanvas(t,n),r&&(t/=r,n/=r);var o=u;u=m.createView(p,t,n,r,s),k.setView(u),k.setCanvas(e),k.setShadowCanvas(a.getContext("2d"),t,n),v.clearLastFont(),o&&(u.setMinZoom(o.getMinZoom()),u.setMaxItemZoom(o.getMaxItemZoom()),u.fromOldSettings(o.settings(),!1)),k.afterChange(null,i)};y.privateMapSetSize=function(e,n){t()&&s.internalUse.setSize(e,n)},y.privateNamespaceDefinitions=function(){var e={};return e.graph={degrees:!0,distances:!0,betweenness:!0,closeness:!0},e.combo={},e.map={},e},y.graph=function(){return M.graph()},y.map=function(){return s.api},y.combo=function(){return k.combo.api},y.toDataURL=function(e,n,r,i){function a(t){e=Math.floor(e/t),n=Math.floor(n/t)}e=Math.floor(e),n=Math.floor(n),e=e>0?e:100,n=n>0?n:100,r=g.defaults(r,{fit:"view",watermark:!0,gradient:!0,logo:!0}),t()&&(r.fit="exact");var o;if("oneToOne"===r.fit){var l=k.modelExtents();l||(l={x1:0,y1:0,x2:100,y2:100});var d=10;o={x1:u.newToOldX(l.x1)-d,x2:u.newToOldX(l.x2)+d,y1:u.newToOldY(l.y1)-d,y2:u.newToOldY(l.y2)+d};var v=k.watermarkSize();if(v&&r.watermark){var p=(v.width-(o.x2-o.x1))/2;p>0&&(o.x1-=p,o.x2+=p);var x=(v.height-(o.y2-o.y1))/2;x>0&&(o.y1-=x,o.y2+=x)}e=o.x2-o.x1,n=o.y2-o.y1,r.noScale=!0}var b=16e6,T=e*n,S=T/b;if(S>1){var C=Math.sqrt(S);a(C)}var I=8e3,O=e/I;O>1&&a(O);var E=n/I;E>1&&a(E);var D=L(e,n),P=D.getContext("2d"),z=r.noScale?1:e/u.width(),A=f.createEventBus(),B=m.createView(A,Math.floor(e/z),Math.floor(n/z),z,s),U=h.createOverlays(A,m),N=c.createController(y,A,U,w);N.setCreateCanvasFn(L),N.setModel(M),N.setView(B),N.setCanvas(P),N.assetPath(k.assetPath()),N.imageBasePath(k.imageBasePath()),N.imageList(k.imageList());var K=k.options();K.overview={shown:!1},r.watermark||(K.watermark=!1),r.gradient||(K.gradient=!1),r.logo||(K.logo=!1),N.options(K,null,!0),N.backgroundOpacity(k.backgroundOpacity()),N.makeGhostCanvas(B.width(),B.height());var R=[];switch(r.selection||(R=M.doSelection(),M.doSelection([])),r.fit){case"chart":N.fitToModel(!1);break;case"view":B.fromOldSettings(u.settings(),!0);break;case"exact":B.fromOldSettings(u.settings(),!1);break;case"oneToOne":B.fitWorldExtents(o,!1,!1,!1,0,0)}B.scaleFactor(z),N.draw(!0);var F;try{F=D.toDataURL()}catch(_){throw new Error("[toDataURL] There is a problem to export the chart with tainted canvas.")}return r.selection||M.doSelection(R),i?t()?s.internalUse.toDataURL(e,n,r,L,D,i):g.invoke(i,F):F},y.load=function(e,t){switch(e.type){case"LinkChart":if(s&&s.internalUse.isTransitioning())throw new Error("Cannot load chart during map show or hide operation");M=d.createModel(p,x,w),k.setModel(M),k.load(e,function(){k.afterChange(t)});break;default:throw new Error("Unknown chart type passed to load")}},y.chartType=function(){return M.type()},y.clear=function(){p.trigger("prechange","delete"),M.load({items:[]}),k.combo.internalUse.loadUp(),k.afterChange(null,!0)},y.merge=function(e,t){e=g.getItemsArray(e);var r=k.merge(e);n(r,function(){k.postMerge(t)})},y.privateMerge=function(e,t){var r=M.merge(e);n(r,t)},y.privateEach=function(e,t){M.each(e,t)},y.privateBothEndsShown=function(e){return M.bothEndsShown(e)},y.privateRemoveItem=function(e){M.removeItem(e),k.render()},y.privateGraph=function(){return M.graph()},y.setProperties=function(e,t,r){var i=k.setProperties(e,t);n(i,r)},y.animateProperties=function(e,t,n){t=g.defaults(t,{time:1e3,easing:"linear",queue:!0}),e=g.ensureArray(e),k.animateProperties(e,t,n)},y.privateAnimateBackgroundOpacity=function(e,t,n){t=g.defaults(t,{time:500}),e=i(e),k.animateBackgroundOpacity(e,t.time,n)},y.privateSetBackgroundOpacity=function(e){e=i(e),k.backgroundOpacity(e)},y.ping=function(e,t,n){t=g.defaults(t,{c:"#909090",w:20,r:80,time:800,repeat:1}),k.ping(e,t,n)},y.getItem=function(e){if(g.isArray(e)){for(var t=[],n=0;n<e.length;n++){var r=M.getItem(e[n]);r=r||null,t.push(r)}return t}return M?M.getItem(e):null},y.setItem=function(e,t){if(e){p.trigger("prechange","properties");var r=k.setItem(e);n(r,function(){k.postMerge(t)})}},y.removeItem=function(e){p.trigger("prechange","delete"),k.removeItem(e),k.render()},y.hide=function(e,t,n){p.trigger("prechange","hide"),e=g.ensureArray(e),t=r(t),k.hide(e,t,n)},y.hidden=function(){return M.hidden()},y.show=function(e,t,n,i){p.trigger("prechange","show"),e=g.ensureArray(e),n=r(n),k.show(e,t,n,i)},y.labelPosition=function(e){return M?k.labelPosition(e,u):null},y.contains=function(e){return M?M.contains(e):[]},y.serialize=function(){var e=M.serialize(u);return k.appendCombos(e),s.internalUse.appendMap(e),e.viewSettings=u.settings(),e},y.worldCoordinates=function(e,t){var n=u.scale(e),r=u.scale(t);return{x:u.newToOldX(n),y:u.newToOldY(r)}},y.viewCoordinates=function(e,t){var n=u.oldToNewX(e),r=u.oldToNewY(t);return{x:u.unscale(n),y:u.unscale(r)}},y.viewOptions=function(e,t,n){if(!e)return u.settings();var i=r(t);e=g.defaults(e,{offsetX:0,offsetY:0,zoom:1}),k.setViewSettings(e,i.animate,i.time,function(){k.render(),g.invoke(n)})},y.options=function(e,t){return k.options(e,t)},y.displayOptions=function(e,t){return y.options(e,t)},y.interactionOptions=function(e){return y.options(e)},y.lock=function(e,t){return"undefined"!=typeof e&&(S=e,e?(t=t||{},k.wait(t.wait)):k.wait(!1),k.render()),S};var S=!1;y.zoom=function(e,t,n){var i=r(t);switch(e){case"in":k.zoomIn(i.animate,i.time,n);break;case"out":k.zoomOut(i.animate,i.time,n);break;case"one":k.setZoom(1,i.animate,i.time,n);break;case"fit":k.fitToModel(i.animate,i.time,n);break;case"selection":k.fitToSelection(i.animate,i.time,n);break;case"height":k.fitModelHeight(i.animate,i.time,n)}},y.pan=function(e,n,i){var a=r(n);"selection"!==e||t()?k.pan(e,a.animate,a.time,i):k.fitToSelection(a.animate,a.time,i,!0)},y.getLastError=function(){return p.getErrors()},y.imagePrefix=function(e){return k.imagePrefix(e)},y.cancelAnimation=function(){k.cancelAnimation()},y.layout=function(e,n,r){if(t())return g.invoke(r);e||(e="standard");var i=y.viewOptions(),a=i.height>0?i.width/i.height:1;n=g.defaults(n,{fit:!0,animate:!0,tidy:!0,ratio:a,tightness:5,straighten:!0}),k.layout(e,n,r)},y.arrange=function(e,t,n,r){e||(e="grid"),n=g.defaults(n,{fit:!1,animate:!0,tidy:!1,ratio:1}),k.arrange(e,t,n,r)},y.selection=function(e){e=g.isNullOrUndefined(e)?e:g.ensureArray(e);var t=M?M.doSelection(e):[];return e&&k.render(),t},y.expand=function(e,n,r){function i(e){var t={fixed:e,animate:!!n.animate,time:n.time,tightness:n.tightness,tidy:n.tidy,fit:n.fit,strategy:"spiral"};y.layout("standard",t,r)}n=g.defaults(n,{fit:!1,tidy:!1,animate:!0,tightness:5,time:1e3}),p.trigger("prechange","expand"),e=g.ensureArray(g.getItemsArray(e)),t()?y.merge(e,r):a(e,i)},y.createLink=function(e,t,n,r){function i(e,t){"dummy"===e&&(y.removeItem(o),y.unbind("dragcomplete",i),g.invoke(r,t))}var a=y.getItem(e);if(y.getItem(t))throw new Error("LinkId ("+t+") already exists and must be unique");if(e&&a&&"node"===a.type&&t){t=g.rawId(t),n=g.defaults(n,{style:{}}),y.bind("dragcomplete",i);var o="dummyEnd"+Math.floor(1e7*Math.random()),u={type:"node",du:!0,id:o,x:a.x,y:a.y},s=g.merge(n.style,{id:t,id1:e,id2:o,type:"link"});y.merge([u,s],function(){setTimeout(function(){k.startDragger(t,o+g.idSep()+"id2",a.x,a.y)},50)})}},KeyLines.Common.appendActions(y,k,y.lock),y.mousemove=function(e,t,n,r){k.mousemove(e,t,n,r,S)},y.dragover=function(e,t){k.dragover(e,t)},g.merge(y,p);var C=KeyLines.Common.frameManager(o,k.animate);return g.merge(y,C),y.bind("redraw",C.redraw),y}}(),!function(){var e=KeyLines.API=KeyLines.API||{};e.appendExtras=function(e){function t(e,t){return"all"===e||e===t.type}function n(t){e.each({type:"link"},function(e){t[e.id]&&(t[e.id1]=!0,t[e.id2]=!0)})}function r(t){e.each({type:"link"},function(e){t[e.id]=!(!t[e.id1]||!t[e.id2])})}var i=null;e.bind("redraw",function(){i=null}),e.each=function(n,r){i=i||e.serialize().items;var a=i;if(n=KeyLines.Util.defaults(n,{type:"all"}),!n.type.match(/^(node|link|all)$/))throw new TypeError("opts type property should be either 'node', 'link' or 'all'");if(KeyLines.Util.isFunction(r))for(var o=0;o<a.length;o++)t(n.type,a[o])&&r(a[o])},e.filter=function(t,i,a){function o(){KeyLines.Util.invoke(a,c)}i=KeyLines.Util.defaults(i,{type:"all",animate:!0,time:1e3,hideSingletons:!1});var u={};if(e.each(i,function(e){t(e)&&(u[e.id]=!0)}),"all"===i.type&&i.hideSingletons){var s={};e.each({type:"link"},function(e){s[e.id1]|=u[e.id]&&u[e.id2],s[e.id2]|=u[e.id]&&u[e.id1]}),e.each({type:"node"},function(e){u[e.id]&=s[e.id]})}"link"===i.type&&n(u),"node"===i.type&&r(u);var c={shown:{nodes:[],links:[]},hidden:{nodes:[],links:[]}};e.each({type:"all"},function(e){var t="node"===e.type?"nodes":"links";u[e.id]&&e.hi&&c.shown[t].push(e.id),u[e.id]||e.hi||c.hidden[t].push(e.id)});var l=c.shown.nodes.concat(c.shown.links),f=c.hidden.nodes.concat(c.hidden.links);f.length>0?l.length>0?(i.time/=2,e.hide(f,i,function(){e.show(l,!1,i,o)})):e.hide(f,i,o):l.length>0?e.show(l,!1,i,o):o()},e.foreground=function(t,i,a){i=KeyLines.Util.defaults(i,{type:"node"});var o={};e.each(i,function(e){t(e)&&(o[e.id]=!0)}),"link"===i.type&&n(o),"node"===i.type&&r(o);var u=[],s={foreground:{nodes:[],links:[]},background:{nodes:[],links:[]}};e.each({type:"all"},function(e){!!e.bg!=!o[e.id]&&("node"===e.type?o[e.id]?s.foreground.nodes.push(e.id):s.background.nodes.push(e.id):"link"===e.type&&(o[e.id]?s.foreground.links.push(e.id):s.background.links.push(e.id)),u.push({id:e.id,bg:!o[e.id]}))}),e.setProperties(u,!1,function(){KeyLines.Util.invoke(a,s)})}}}(),!function(){var e=KeyLines.Model={};e.createModel=function(e,t,n){function r(e,t){switch(e){case"x1":return nt[t.id1].x;case"y1":return nt[t.id1].y;case"x2":return nt[t.id2].x;case"y2":return nt[t.id2].y}}function i(e){"node"===e.type&&(e.x||(e.x=0),e.y||(e.y=0))}function a(e,t){var n={},r={};if(e)for(var a=0;a<e.length;a++){var o=e[a];if(o.id&&!(o.id in n||o.id in r)){var u=null;if("node"===o.type){u=n;var s=!0;t&&nt[o.id]&&(s=!1),s&&i(o)}"link"===o.type&&(u=r),u&&(u[o.id]=et.clone(o))}}return{nodes:n,links:r}}function o(){function e(e){var n=et.clone(e,!0);n.id=et.rawId(e.id),t.push(n)}var t=[];return et.iterator(rt,e),et.iterator(nt,e),t}function u(e){ut(e.items)}function s(e){var t=[];for(var n in e)("undefined"==typeof e[n]||null===e[n])&&t.push(n);for(n in t)delete e[t[n]]}function c(e,t){var n,r;if(e){for(r=0;r<ct.length;r++)n=ct[r],e[n]&&(e[n]=Number(e[n])),e[n]<0&&!vt[n]&&(e[n]=null);for(r=0;r<lt.length;r++)n=lt[r],et.isNullOrUndefined(e[n])||(e[n]=e[n]+"");for(r=0;r<ft.length;r++)n=ft[r],e[n]&&(e[n]=J.validatergb(e[n])?e[n]:void 0);for(r=0;r<ht.length;r++)delete e[ht[r]];if(t)for(r=0;r<dt.length;r++)delete e[dt[r]]}}function l(e,t){var n={};if(e&&et.isArray(e)){for(var r=[],i=0;i<e.length;i++){var a=e[i].p,o=null;t?o=e[i]:a&&2===a.length&&/(ne|nw|se|sw)/.test(a)&&(n[a]||(o=e[i],n[a]=1)),o&&(f(o),r.push(o))}e=r}return e}function f(e){if(et.isNormalObject(e.fi)){var t=e.fi;et.isNullOrUndefined(t.t)||(t.t="string"==typeof t.t?t.t.charAt(0):String.fromCharCode(t.t)),t.c&&(t.c=J.validatergb(t.c)?t.c:void 0)}else delete e.fi}function d(e,t){for(var n=0;n<gt.length;n++){var r=gt[n],i=e[r];
i&&(t?i.hasOwnProperty("c")||i.hasOwnProperty("r")||i.hasOwnProperty("w")||delete e[r]:i.hasOwnProperty("c")&&i.hasOwnProperty("r")&&i.hasOwnProperty("w")||delete e[r])}}function h(e){if(et.isArray(e.bu))delete e.bu;else{e.bu.p||(e.bu.p="ne");var t=e.bu.p;/(ne|nw|se|sw)/.test(t)||2===t.length||delete e.bu}}function v(e){var t={};for(var n in e)e[n].id1!==e[n].id2&&(t[n]=e[n]);return t}function g(e,t){var n={};for(var r in e)m(e[r],t)&&(n[r]=e[r]);return n}function m(e,t){return t=t||{},(nt[e.id1]||t[e.id1])&&(nt[e.id2]||t[e.id2])}function y(e,t){for(var n in rt){var r=rt[n];(nt[r.id1][e]===t||nt[r.id2][e]===t)&&(rt[n][e]=t)}}function p(e,t){e[t]&&Lt(e.id,!0)}function x(e){for(var t in rt)p(rt[t],e);for(t in nt)p(nt[t],e)}function w(){M("hi")}function M(e,t){y(e,!0),t||x(e),"hi"===e&&z()}function b(e,t,n){for(var r=0;r<e.length;r++)nt[e[r]]&&(nt[e[r]][t]=n),rt[e[r]]&&(rt[e[r]][t]=n)}function k(e,t){var n=!1;return nt[e]&&(n=T(nt[e],t)),rt[e]&&(n=T(rt[e],t)),n}function L(e){return(nt[e]||rt[e])&&!(k(e,"hi")||k(e,"gh"))}function T(e,t){return e[t]?!0:!1}function S(e,t,n){e=et.ensureArray(e),b(e,t,!1);var r;if(M(t),n){var i={};for(r=0;r<e.length;r++)i[e[r]]=1;for(r in rt)T(rt[r],t)&&(T(nt[rt[r].id1],t)||T(nt[rt[r].id2],t)||(i[rt[r].id1]||i[rt[r].id2])&&(rt[r][t]=!1))}}function C(e){var t,n=[];for(t in nt)t=et.rawId(t),nt[t][e]&&n.push(t);for(t in rt)t=et.rawId(t),rt[t][e]&&n.push(t);return n}function I(e,t){e=et.ensureArray(e),b(e,t,!0),M(t)}function O(e){var t={};for(var n in e)"undefined"==typeof e[n].off&&(t[n]=e[n]);return t}function E(){var e=D(nt);return e=D(rt)||e}function D(e){var t=!1;for(var r in e){var i=e[r];if(t=P(i)||t,n.itemHasGlyph(i))for(var a=0;a<i.g.length;a++)t=P(i.g[a])||t;i.bu&&(t=P(i.bu.g)||t)}return t}function P(e){if(e){var t=e.u;if(t&&!(t in xt))return xt[t]=1,!0}}function z(){X=$=null}function A(e){var t={};for(var n in e){var r=e[n];r.hi||(t[n]=r)}return t}function B(){X||(X=A(nt),$=A(rt))}function U(e){for(var t in e)kt(t,!0)}function N(t){var n=KeyLines.Graph.create(e);return n.privateSetProperties(nt,t),n}function K(){return N(rt).connections()}function R(e,t){for(var n=N(e).sortedAdjacency({all:!0}).find,r=K(),i={},a=0;a<r.length;a++){var o=rt[r[a][0]];n(o.id1,o.id2)&&(i[a]=1)}t(r,i)}function F(e){for(var t={},n=0;n<e.length;n++){var r=e[n],i=rt[r];i&&(t[r]=i)}return t}function _(){Y(K())}function H(){for(var e in rt){var t=rt[e];delete t.st}}function j(e,t,n,r){function i(e,t){return a(rt[e])-a(rt[t])}function a(e){var t=et.defined(e.off)?e.off:s;return e.id1>=e.id2&&(t=-t),t}function o(e,t){r(e,e.id1<e.id2?t:-t)}var u,s=1e6,c=t||e,l=40;et.iterator(c,function(t,r){u=e[r],n||(u=et.filter(u,function(e){return!rt[e].gh})),u.sort(i);for(var a=Math.floor(u.length/2),s=(u.length+1)%2/2,c=0;c<u.length;c++){var f=rt[u[c]];o(f,(c-a+s)*l)}})}function Y(e,t){function n(e,t){e.off=t}j(e,t,!0,n)}function G(e,t,n){function r(e,t){i.push({id:e.id,off:t})}var i=[];return j(e,t,n,r),i}function W(){for(var e=K(),t={},n=0;n<e.length;n++){var r=!1,i=e[n];if(i.length>1){for(var a=0;a<i.length;a++){var o=rt[i[a]];o&&(r=r||"undefined"!=typeof o.off)}r||(t[n]=1)}}Y(e,t)}function q(e){return(e+"").match(Et)}function Z(e){var t=q(e);return Dt[t[2]]}function V(e){var t=q(e);return t?t[1]:null}var X,$,Q,J=KeyLines.Rendering,et=KeyLines.Util,tt={},nt={},rt={},it=et.idSep(),at=null,ot=KeyLines.Layouts.create();tt.graph=function(){return at||(at=KeyLines.Graph.create(e),at.privateSetProperties(nt,rt)),at},tt.load=function(e){if(e){nt={},rt={},St(!0),u(e);var t=a(e.items);nt=t.nodes,rt=g(t.links),rt=v(rt),w(),W(rt),at=null}E()};var ut=tt.ensureTypesInArray=function(e,t){if(e)for(var n=0;n<e.length;n++)st(e[n],t)},st=tt.ensureObject=function(e,t){c(e,t),f(e),e.g&&(et.isArray(e.g)?(ut(e.g),e.g=l(e.g,"link"===e.type)):delete e.g),d(e,t),e.bu&&h(e)};tt.defaultValueFor=function(e){switch(e){case"e":return 1;case"fs":return n.fontSize;case"off":case"b1":case"b2":return 0;case"x":case"y":return 0;case"w":case"h":return 1;case"bw":return 4;case"c":case"b":return J.colours.midgrey;case"fc":return J.colours.black;case"fbc":return J.colours.textback}};var ct=["x","y","w","h","e","fs","off","b1","b2","bw"],lt=["t","u","id","id1","id2","ff","sh","p","ls","bs"],ft=["c","b","fc","fbc"],dt=["hi","bg","ci","du","fb","a1","a2","re","tc","a"],ht=["gh"],vt={x:1,y:1,off:1},gt=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"];tt.bothEndsShown=function(e){return!(nt[e.id1].hi||nt[e.id2].hi)},tt.ensureBackgroundConsistency=function(){M("bg",!0)},tt.resurrect=function(e,t){S(e,"gh",t)},tt.ghost=function(e){I(e,"gh")},tt.show=function(e,t){S(e,"hi",t)},tt.hidden=function(){return C("hi")},tt.hide=function(e){I(e,"hi")},tt.each=function(e,t){if(e.type.match(/^(node|all)$/))for(var n in nt)t(nt[n]);if(e.type.match(/^(link|all)$/))for(var r in rt)t(rt[r])},tt.setItem=function(e){st(e);var t=null;return"node"===e.type&&(t=nt),"link"!==e.type||(t=rt,m(e))?(i(e),e.id&&(t[e.id]=et.clone(e),e.hi?w():z()),E()):!1};var mt=tt.type=function(){return"LinkChart"};tt.setOptions=function(e){Q=e.marqueeLinkSelection,t.setOptions(e),n.setOptions(e)},tt.serialize=function(){return{type:mt(),items:o()}};var yt=tt.applyChanges=function(e,t){var n,r,i,a,o,u,c;for(n=0;n<e.length;n++){if(r=et.rawId(e[n].id))if(u=[],t){c=new RegExp(r,"im");for(i in nt)c.test(i)&&u.push(nt[i]);for(a in rt)c.test(a)&&u.push(rt[a])}else nt[r]&&u.push(nt[r]),rt[r]&&u.push(rt[r]);var l=et.clone(e[n]);for(delete l.id,delete l.type,o=0;o<u.length;o++)u[o]=et.merge(u[o],l),s(u[o])}};tt.setProperties=function(e,t){e=et.ensureArray(e),ut(e),yt(e,t),w();var n=E();return n},tt.merge=function(e,t){t=t||{},ut(e);var n=a(e,!0);n.links=g(n.links,n.nodes),n.links=v(n.links);for(var r in n.nodes)nt[r]=et.merge(nt[r],n.nodes[r]);for(var i in n.links)rt[i]=et.merge(rt[i],n.links[i]);if(!t.preserveOffsets){var o=O(n.links);It(o)}w();var u=E();return u},tt.getItem=function(e){var t=pt(e);return et.clone(t,!0)};var pt=tt.getByID=function(e){return e=et.rawId(e),nt[e]||rt[e]},xt={};tt.imageList=function(e){var t={};for(var n in xt)t[e+n]=1;return t};var wt=tt.generate=function(e,t,r,i,a,o,u){B(),n.generate(X,$,e,t,r,i,a,o,u,Tt,bt)};tt.resetDrawing=function(){n.reset()},tt.generateSelection=function(e,t,n,r,i,a){wt(e,t,n,r,i,function(e){return e.id in Mt},a)},tt.contains=function(e){return n.contains(e,nt)},tt.animated=function(){return n.animated()};var Mt={},bt=[];tt.setSelection=function(e,t,n){e=et.rawId(e),t||n||St(e),Mt[e]?t&&Lt(e):kt(e)};var kt=tt.addToSelection=function(t,n){t=et.rawId(t),t&&(Mt[t]||L(t)&&(Mt[t]=1,bt.push(t),n||e.trigger("selectionchange")))},Lt=tt.removeFromSelection=function(t,n){if(t=et.rawId(t),Mt[t]){delete Mt[t];var r=et.indexOf(bt,t);r>-1&&bt.splice(r,1),n||e.trigger("selectionchange")}};tt.hasSelection=function(){return bt.length>0};var Tt=tt.isSelected=function(e){return e=et.rawId(e),e in Mt},St=tt.clearSelection=function(t){Mt={},bt=[],t||e.trigger("selectionchange")};tt.selectAll=function(){U(nt),U(rt),e.trigger("selectionchange")};var Ct=tt.doSelection=function(e){if(e){St(!0);for(var t=0;t<e.length;t++)kt(e[t],!0)}return et.clone(bt)};tt.moveSelection=function(e,t){var n=[];if(Mt){for(var r in nt)Tt(r)&&n.push(r);for(var i in rt)Tt(i)&&(nt[rt[i].id1].du&&n.push(rt[i].id1),nt[rt[i].id2].du&&n.push(rt[i].id2))}for(var a=0;a<n.length;a++){var o=nt[n[a]];o.x+=e,o.y+=t}},tt.removeItem=function(e,t){t=t||{};var n;e=et.ensureArray(e);for(var r={},i={},a=0;a<e.length;a++)n=e[a],rt[n]&&(r[n]=rt[n]),nt[n]&&(i[n]=1);for(n in rt)(i[rt[n].id1]||i[rt[n].id2])&&(r[n]=rt[n]);for(n in r)Lt(n,!0),delete rt[n];for(n in i)Lt(n,!0),delete nt[n];t.preserveOffsets||It(r),z()},tt.selectionPlusDummyNodes=function(){for(var e=Ct(),t=0;t<e.length;t++){var n=rt[e[t]];n&&(nt[n.id1].du&&e.push(n.id1),nt[n.id2].du&&e.push(n.id2))}return e};var It=tt.resetConnectionOffsets=function(e){R(e,Y)},Ot=function(e,t){var n;return R(e,function(e,r){n=G(e,r,t)}),n};tt.showHideBendLinks=function(e){var t=F(e);It(t)},tt.showHideGetLinksToBend=function(e,t){for(var n=F(e),r=Ot(n,t),i=[],a=0;a<r.length;a++){var o=r[a];rt[o.id].off!==o.off&&i.push(o)}return i},tt.getCursor=function(e,t){var n=V(e);return n?n:e?'url("'+t+'openhand.cur"), pointer':"auto"},tt.getResizePrimitive=function(){return n.getResizePrimitive()};var Et=new RegExp(it+"((\\S+)(?:\\-resize))$"),Dt={nw:["x1","y1"],n:["y1"],ne:["x2","y1"],e:["x2"],se:["x2","y2"],s:["y2"],sw:["x1","y2"],w:["x1"]},Pt=new RegExp(it+"(id[1|2])$");tt.startDragger=function(e,n,r,i,a,o,u){var s=(u+"").match(Pt),c=et.rawId(i);return t.createLinkEndDragger(e,tt,r,nt,rt[c],s[1],a,o,c)},tt.createDragger=function(n,i,a,o,u,s,c,l,f,d,h,v){var g=f.handMode,m=et.rawId(s),y=q(s);if(y){var p=Z(s),x=v;return t.primitiveMover(J,o,u,m,x,!0,p,c,l,function(t){e.trigger("prechange","resize");var n=nt[et.rawId(s)];if("C"===t.p)n.x=u.newToOldX(t.x),n.y=u.newToOldY(t.y),n.w=n.h=2*u.undim(t.r);else{var r=u.newToOldX(t.x1),i=u.newToOldY(t.y1),a=u.newToOldX(t.x2),o=u.newToOldY(t.y2);n.x=r+Math.floor((a-r)/2),n.y=i+Math.floor((o-i)/2),n.w=a-r,n.h=o-i}})}if(null!==m&&rt[m]&&"h"!==rt[m].st){var w=(s+"").match(Pt);return w?t.createLinkEndDragger(a,tt,u,nt,rt[m],w[1],c,l,m):t.createLinkDragger(r,o,u,rt[m],c,l,m)}return g&&null===s?t.createHandDragger(u,c,l,St):null!==m?(B(),t.createDefaultDragger(X,$,Tt,o,u,s,c,l)):zt(n,i,o,u,m,c,l,d,h,f.crossingBox)};var zt=function(t,n,r,i,a,o,u,s,c,l){function f(e,t){x.x1=Math.min(i.oldToNewX(y),e),x.y1=Math.min(i.oldToNewY(p),t),x.x2=Math.max(i.oldToNewX(y),e),x.y2=Math.max(i.oldToNewY(p),t)}function d(e,t,n){for(var r in e)e[r]?kt(r,!0):t||n?g[r]||Lt(r,!0):Lt(r,!0)}function h(e,t,n,r){f(e,t);var a={};a.x1=i.newToOldX(x.x1),a.y1=i.newToOldY(x.y1),a.x2=i.newToOldX(x.x2),a.y2=i.newToOldY(x.y2);var o={};for(var u in X)o[u]=J.inside(a,X[u].x,X[u].y);if("off"!==Q)for(var s in $)if("centre"===Q)o[s]=J.inside(a,$[s]._x,$[s]._y);else if("ends"===Q){var c=X[$[s].id1],l=X[$[s].id2];o[s]=J.inside(a,c.x,c.y)&&J.inside(a,l.x,l.y)}d(o,n,r)}function v(e,i,a,o){if(f(e,i),t){var u,s={};t.each(function(e){if(e.p!==J.primitives.line&&e.p!==J.primitives.arc&&""!==e.p){var t=J.extents(r,e);u=et.rawId(e.id),s[u]=s[u]||J.intersects(x,t)}}),n.each(function(e){u=et.rawId(e.id),s[u]=s[u]||J.inside(x,e.x,e.y)}),d(s,a,o)}}if(!e.trigger("dragstart","area",null,i.unscale(o),i.unscale(u),null)){var g={};for(var m in Mt)g[m]=1;var y=i.newToOldX(o),p=i.newToOldY(u),x={p:J.primitives.rect,x1:o,y1:u,x2:o,y2:u,bc:J.colours.midgrey,bw:1,fc:J.colours.blue,fi:!1},w={scrollable:!0,getCursor:function(){return"crosshair"},generate:function(e){e.copyPrimitive(x)},dragMove:function(e,t,n,r){e>o||!l?h(e,t,n,r):v(e,t,n,r)},endDrag:function(t,n,r){i.cancelScroll();var a=e.trigger("dragend","area",null,i.unscale(n),i.unscale(r));a||(t?e.trigger("selectionchange"):St()),e.trigger("dragcomplete","area",null,i.unscale(n),i.unscale(r))}};return w}};return tt.createGestureDragger=function(t,n,r){function i(e,n,r){var i=2*-e*Math.PI/360;i*=2;var a=Math.sin(i),o=Math.cos(i);for(var u in nt)nt[u].x=(d[u].x-l)*o+(d[u].y-f)*a+l,nt[u].y=-(d[u].x-l)*a+(d[u].y-f)*o+f;var s=t.newToOldX(n),c=t.newToOldY(r);for(var h in nt)nt[h].x+=s-l,nt[h].y+=c-f}function a(e){e=Math.pow(e,2),t.zoomToPosition(e*c,n,r)}function o(e,t,n,r){v=e,g=t,m=n,y=r}function u(){a(v),p=p||Math.abs(g)>12,w=w||Math.abs(m-l)>x||Math.abs(y-f)>x,i(p?g:0,w?m:l,w?y:f)}function s(){for(var e in nt)nt[e].x=d[e].x,nt[e].y=d[e].y}var c=t.zoom(),l=t.newToOldX(n),f=t.newToOldY(r),d={};for(var h in nt)d[h]={x:nt[h].x,y:nt[h].y};var v,g,m,y;o(1,0,l,f);var p=!1,x=60,w=!1,M={animate:function(){u()},getCursor:function(){return"move"},dragMove:function(e,t,n,r){o(e,t,n,r)},endDrag:function(t,n,r,i,a){o(n,r,i,a),t?(s(),e.trigger("prechange","move"),u()):s()}};return M},tt.labelPosition=function(e,t){var r=pt(e);return n.labelPosition(r,t)},tt.extractStructure=function(e,t,r){return t.straighten&&_(),H(),ot.extractStructure(n,e,nt,rt,t.fixed,r)},tt.layout=function(e,t,n,r,i,a){ot.layout(e,t,n,r,i,a)},tt.arrange=function(e,t,n,r,i,a){ot.arrange(e,t,n,r,i,a)},tt.applyVertices=function(e){for(var t in nt)e[t]&&(nt[t].x=e[t].x,nt[t].y=e[t].y)},tt.makeAnimator=function(e,t,n){var r=t,i={};for(var a in nt)i[a]={x:nt[a].x,y:nt[a].y};return{animate:function(a){r-=a;var o=n(Math.max(0,(t-r)/t));for(var u in nt)e[u]&&(nt[u].x=i[u].x+o*(e[u].x-i[u].x),nt[u].y=i[u].y+o*(e[u].y-i[u].y));return r>0}}},tt}}(),!function(){var e=KeyLines.Generator={};e.create=function(e){function t(){return lt||wt.colours.white}function n(e){return Math.abs(e)<1e-5}function r(e,t,n,r,i,a,o){return{x:((a-r)*n-(o-i)*t)/e,y:((a-r)*t+(o-i)*n)/e}}function i(e){return e.hasOwnProperty("t")&&e.t}function a(e){var t=Ot(e);return e.bg?t?wt.layers.BGSHAPES:wt.layers.BGNODES:t?wt.layers.SHAPES:wt.layers.NODES}function o(e){return e.bg?wt.layers.BGLINKS:wt.layers.LINKS}function u(e,t,i,a,o,u,s,c,l,f){var d=r(t,i,a,o,u,s,c),h=r(t,i,a,o,u,l,f);e/=t;var v=e/2;if(d.y>v&&h.y>v||d.y<-v&&h.y<-v)return 0/0;if(n(h.y-d.y))return Math.max(d.x,h.x);var g,m=d.y>h.y?d:h,y=d.y>h.y?h:d;g=v<m.y?m.x-(m.y-v)*(m.x-y.x)/(m.y-y.y):m.x;var p;return p=y.y<-v?y.x-(y.y- -v)*(y.x-m.x)/(y.y-m.y):y.x,Math.max(g,p)}function s(e,t,n,r,i,a,o){for(var s=-1/0,c=o.length,l=0;c>l;l+=2){var f=(l+2)%c,d=u(e,t,n,r,i,a,o[l],o[l+1],o[f],o[f+1]);isNaN(d)||(s=Math.max(s,d))}return s}function c(e,t,n,r,i,a,o){return s(e,t,n,r,i,a,[o.x1,o.y1,o.x2,o.y1,o.x2,o.y2,o.x1,o.y2])}function l(e,t,n,r,i,a){for(var o,u=-1/0,l=Math.sin(-n),f=Math.cos(-n),d=0;d<a.length;d++)o=a[d].length?s(e,t,l,f,r,i,a[d]):c(e,t,l,f,r,i,a[d]),u=Math.max(u,o);return u}function f(e,t,n,r,i,a){var o=0;return r._c&&(o=r._c/t),r._cl&&(o=Math.max(o,l(e,t,n,i,a,r._cl))),o}function d(e,t,r,i,a,o,u,s,c,l,d,h){var v={},g=r-e,m=i-t,y=Math.sqrt(g*g+m*m);if(n(y))v.skip=!0;else{var p=Math.atan2(m,g),x=f(st&&c?0:o,y,p,u,e,t),w=f(st&&l?0:o,y,p+Math.PI,s,r,i);d=d||0,h=h||0,x=Math.max(d,x),w=Math.max(h,w);var M=1-(x+w),b=0;if(c||l){var k=I(o,a)*Math.cos(Pt);b=k/y,c&&l&&(b=1.5*b)}v.skip=M<Math.max(.1,b),v.skip||(v.cx1=e+x*g,v.cy1=t+x*m,v.cx2=r+w*-g,v.cy2=i+w*-m)}return v}function h(e,t,n,r,i,a,o){var u=[],s=a-r,c=o-i,l=r-e,f=i-t,d=s*s+c*c,h=2*(s*l+c*f),v=l*l+f*f-n*n,g=h*h-4*d*v;if(g>=0){var m=Math.sqrt(g),y=(-h-m)/(2*d),p=(-h+m)/(2*d);if(y>=0&&1>=y){var x=r+y*s,w=i+y*c;u.push(Math.atan2(w-t,x-e))}if(p!==y&&p>=0&&1>=p){var M=r+p*s,b=i+p*c;u.push(Math.atan2(b-t,M-e))}}return u}function v(e,t,n,r,i,a){var o=r-t;if(Math.abs(o)>n)return[];var u=Math.max(i,a),s=Math.min(i,a);if(e-n>u||s>e+n)return[];var c=Math.asin(o/n),l=n*Math.cos(c),f=[];return e-l>=s&&u>=e-l&&f.push(o>0?Math.PI-c:-Math.PI-c),e+l>=s&&u>=e+l&&f.push(c),f}function g(e,t,n,r,i,a){var o=r-e;if(Math.abs(o)>n)return[];var u=Math.max(i,a),s=Math.min(i,a);if(t-n>u||s>t+n)return[];var c=Math.acos(o/n),l=n*Math.sin(c),f=[];return t-l>=s&&u>=t-l&&f.push(-c),t+l>=s&&u>=t+l&&f.push(c),f}function m(e,t,n,r,i,a,o){var u=Math.PI,s=o?r:i;if(a._c&&(s+=(o?1:-1)*a._c/n),a._cl&&a._cl.length>0)for(var c=0;c<a._cl.length;c++){var l,f,d=a._cl[c];if(d.length)for(f=[],l=0;l<d.length;l+=2){var m=(l+2)%d.length,y=h(e,t,n,d[l],d[l+1],d[m],d[m+1]);f=f.concat(y)}else{var p=v(e,t,n,d.y2,d.x1,d.x2),x=v(e,t,n,d.y1,d.x1,d.x2),w=g(e,t,n,d.x1,d.y1,d.y2),M=g(e,t,n,d.x2,d.y1,d.y2);f=p.concat(x,M,w)}for(l=0;l<f.length;l++)f[l]+2*Math.PI<i&&(f[l]+=2*Math.PI),r<f[l]&&f[l]<i&&(o?f[l]-s<u&&(s=Math.max(s,f[l])):s-f[l]<u&&(s=Math.min(s,f[l])))}return s}function y(e,t,n,r,i,a,o,u){var s=m(t,n,r,i,a,e>0?o:u,!0),c=m(t,n,r,s,a,e>0?u:o,!1);return{startangle:s,endangle:c}}function p(e,t){var n=t(e.id),r=Ot(e),i=H("b",e,n),a=H("c",e,n);return!(!i&&!a||r)}function x(e){return e>Math.PI||e<-Math.PI?e-2*Math.PI*Math.floor((e+Math.PI)/2*Math.PI):e}function w(e,t,n,r,i,a,o,u,s,c,l,f,d){function h(e,t){P++,1===P?(I=e,O=t):2===P&&(E=e,D=t)}function v(e){var t=n+i*Math.cos(e),a=r+i*Math.sin(e);t>L&&T>t&&a>S&&C>a&&h(t,a)}function g(e,t){var n=e*e;if(n===z)t(i);else if(z>n){var r=Math.sqrt(z-n);t(r),t(-r)}}function m(e){g(e-n,function(t){var n=r+t;n>=S&&C>=n&&p(e,r+t)})}function y(e){g(e-r,function(t){var r=n+t;r>=L&&T>=r&&p(n+t,e)})}function p(e,t){var i,u=e-n,s=t-r,c=Math.atan2(s,u);i=o>a?c>a&&o>c:c>a||o>c,(i!==d||c===a||c===o)&&h(e,t)}if(1e6>=i)return t.arc(n,r,i,a,o,u,s,c,l,f,d),void 0;var w=e.width(),M=e.height(),b=Math.floor(w/2),k=Math.floor(M/2),L=-b,T=w+b,S=-k,C=M+k;a=x(a),o=x(o);var I,O,E,D,P=0;v(a),v(o);var z=i*i;m(L),m(T),y(S),y(C),2===P&&t.line(Math.floor(I),Math.floor(O),Math.floor(E),Math.floor(D),u,s,c,l,f)}function M(e,t,n,r,i,a,o,u,s,c,l,f,d,h,v,g,m,x){var M=(l+d)/2,b=(f+h)/2,k=d-l,L=h-f,T=e.dim2(o);0===T&&(T=o>=0?1:-1);var S=Math.max(.001,L*L+k*k),C=Math.sqrt(S),I=(S/4+T*T)/(2*Math.abs(T)),E=I-Math.abs(T),D=Number(T)>0?1:-1,P=M-L*D*E/C,z=b+k*D*E/C,A=Math.atan2(f-z,l-P),B=Math.atan2(h-z,d-P),U=T>0?A:B,N=T>0?B:A;U>N&&(N+=2*Math.PI),i=i||0,a=a||0;var K=U+(T>0?i:a)*(N-U),F=U+(T>0?1-a:1-i)*(N-U),_=y(T,P,z,I,U,N,s,c);if(_.startangle=Math.max(K,_.startangle),_.endangle=Math.min(F,_.endangle),!(_.startangle>=_.endangle)){var H=(_.startangle+_.endangle)/2,j={};j.lx=P+I*Math.cos(H),j.ly=z+I*Math.sin(H);var Y,G,W,q,Z,V,X=1.5*g/I,$=-.25;if(n?(Y=T>0?_.startangle:_.endangle,G=P+I*Math.cos(Y),W=z+I*Math.sin(Y),T>0?_.startangle+=X:_.endangle-=X):st&&p(s,x)&&(T>0?_.startangle+=$*X:_.endangle-=$*X),r?(q=T>0?_.endangle:_.startangle,Z=P+I*Math.cos(q),V=z+I*Math.sin(q),T>0?_.endangle-=X:_.startangle+=X):st&&p(c,x)&&(T>0?_.endangle-=$*X:_.startangle+=$*X),_.startangle<_.endangle){var Q=St&&m&&("dashed"===m||"dotted"===m),J=!1;if(Q){var et=(_.endangle-_.startangle)*I;if(R(m,g,"line",et),0>T){var tt=_.startangle;_.startangle=_.endangle,_.endangle=tt,J=!0}}w(e,t,Math.round(P),Math.round(z),I,_.startangle,_.endangle,v,g,u,yt,pt,J)}return n&&O(e,t,G,W,g,.66*+D*X+Y-D*Math.PI/2,v,u+Lt+"a1"),r&&O(e,t,Z,V,g,.66*-D*X+q+Math.PI-D*Math.PI/2,v,u+Lt+"a2"),j}}function b(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}function k(e,t,n){var r,i=Ut,a=t.e||1;return r=n.x>t.x&&"e"===t.sh?t.x+a*i:n.x<t.x&&"w"===t.sh?t.x-a*i:t.x,e.x(r)}function L(e,t,n,r,i,a,o,u,s,c,l,d,h,v,g){var m,y,p=k(e,s,c),x=k(e,c,s),w=e.y(o||0),M=e.dim2(ft);x>p?(m=p+M,y=x-M,m>y&&(m=y=(p+x)/2)):(m=p-M,y=x+M,y>m&&(m=y=(p+x)/2));var L=b(p,l,m,w),T=b(m,w,y,w),S=b(y,w,x,d),C=L+T+S,I=Math.atan2(w-l,m-p),E=Math.atan2(w-d,y-x),D=0===L?0:f(v,L,I,s,p,l),P=0===S?0:f(v,S,E,c,x,d);i=0===L?0:(i||0)*C/L,a=0===S?0:(a||0)*C/S,D=Math.min(1,Math.max(i,D)),P=Math.min(1,Math.max(a,P));var z,A,B,U,N,K,F,_,H=p+D*(m-p),j=l+D*(w-l),Y=x+P*(y-x),G=d+P*(w-d);n&&(N=H,K=j,z=m-H,A=w-j,B=Math.max(.001,A*A+z*z),U=Math.sqrt(B),H+=1.5*v*z/U,j+=1.5*v*A/U),r&&(F=Y,_=G,z=y-Y,A=w-G,B=Math.max(.001,A*A+z*z),U=Math.sqrt(B),Y+=1.5*v*z/U,G+=1.5*v*A/U);var W=St&&g&&"solid"!==g;W&&R(g,v,"line",C),t.line3(Math.floor(H),Math.floor(j),Math.floor(m),Math.floor(w),Math.floor(y),Math.floor(w),Math.floor(Y),Math.floor(G),h,v,u,yt,pt),n&&O(e,t,N,K,v,I+Math.PI,h,u+Lt+"a1"),r&&O(e,t,F,_,v,E+Math.PI,h,u+Lt+"a2");var q={above:!0,lx:(m+y)/2,ly:(w+w)/2};return q}function T(e,t,n,r,i,a,o,u,s,c,l,f,h,v,g,m,y){var x=d(c,l,f,h,e,g,u,s,n,r,i,a);if(!x.skip){var w,M,b,k,L,T,S=x.cx1,C=x.cy1,I=x.cx2,E=x.cy2,D=I-S,P=E-C,z=Math.max(.001,P*P+D*D),A=Math.sqrt(z),B=.25;n?(w=Math.atan2(P,D),b=S,k=C,S+=1.5*g*D/A,C+=1.5*g*P/A):st&&p(u,y)&&(S-=B*g*D/A,C-=B*g*P/A),r?(M=Math.atan2(P,D),L=I,T=E,I-=1.5*g*D/A,E-=1.5*g*P/A):st&&p(s,y)&&(I+=B*g*D/A,E+=B*g*P/A);var U=St&&m&&"solid"!==m;U&&R(m,g,"line",A),t.line(Math.round(S),Math.round(C),Math.round(I),Math.round(E),v,g,o,yt,pt),n&&O(e,t,b,k,g,w+Math.PI,v,o+Lt+"a1"),r&&O(e,t,L,T,g,M,v,o+Lt+"a2");var N={};return N.lx=(S+I)/2,N.ly=(C+E)/2,N}}function S(e,t,n,r){if(e){var i=e.getNext();i.x=t,i.y=n,i.id=r}}function C(e,n,r,a,o,u,s,c,l,f){function d(e){return g&&gt&&vt.hasOwnProperty(e)?vt[e]:a[e]}if(!a.hi){a._edit=null;var h,v,g=f(o),m=g&&!gt,y=d("b1"),p=d("b2"),x=d("c"),w=d("fb"),b=d("fbc"),k=d("fc"),C=d("ff"),I=d("fs"),O=d("ls"),z=d("w"),A=n.x(u.x),B=n.y(u.y),N=n.x(s.x),K=n.y(s.y),R=n.w(z||1),F=x||wt.colours.midgrey,_=0;yt=pt=void 0,v="h"===a.st?L(n,r,a.a1,a.a2,y,p,a.y,o,u,s,B,K,F,R,O):a.off?M(n,r,a.a1,a.a2,y,p,a.off,o,u,s,A,B,N,K,F,R,O,f):T(n,r,a.a1,a.a2,y,p,o,u,s,A,B,N,K,F,R,O,f);var H=v?v.lx:(A+N)/2,j=v?v.ly:(B+K)/2;if(a._x=n.newToOldX(H),a._y=n.newToOldY(j),v){var Y=v.lx,G=v.ly,W=Y,q=G,Z=It(a);I=Number(I||bt);var V=n.dim(I),X=!1,$=k||wt.colours.black,Q=b||wt.colours.textback;m&&($=t(),Q=Ct());var J=D(a),tt=P(J,e,V,w,C),nt=I+3,it=n.dim(nt);_=nt*J.length,J.length>0&&(W-=tt[0]/2);for(var ot=(J.length-1)*it,ut=v.above?G-(ot+it/2+R/2):G-Math.round(ot/2),st=0;st<J.length;st++){0===st&&(q=ut);var ct=U(e,n,r,J[st],Y,ut,V,o,!0,$,Q,w,a,!1,!0,99,tt[st],m,I,C||at);X=X||ct,ut+=it}var lt=!i(a)||!X;if(lt&&m&&!Z&&r.circle(Y,G,Math.floor(V/2),wt.colours.white,-1,Ct(),!0,o),Z){var ft=n.dim(Dt);lt?W+=Math.floor((a.g.length-1)*ft/2):W-=n.dim(Et);var dt=W;if(lt&&m){for(h=a.g.length-1;h>=0;h--)r.circle(W,q,Math.floor(.6*ft),wt.colours.white,-1,Ct(),!0,o),W-=ft;W=dt}for(h=a.g.length-1;h>=0;h--)et(r,n,e,o+Lt+h,W,q,1,a.g[h],l),W-=ft}a.bu&&rt(r,n,e,o,Y,G,_/2+4,1,a.bg,a.bu,l),Z||i(a)||S(c,Y,G,o)}else S(c,H,j,o);E(u,"id1",o,A,B,r,R,F),E(s,"id2",o,N,K,r,R,F)}}function I(e,t){return 1.7*e+t.dim("small"===it?6:10)}function O(e,t,n,r,i,a,o,u){var s=I(i,e),c=a+Math.PI;t.triangle(n+s*Math.cos(c+Pt),r+s*Math.sin(c+Pt),n+s*Math.cos(c-Pt),r+s*Math.sin(c-Pt),n,r,o,-1,o,!0,u)}function E(e,t,n,r,i,a,o,u){e.du&&a.circle(r,i,Math.floor(1.5*o),u,o,wt.colours.white,!0,n+Lt+t)}function D(e){return e.t?(e.t+"").split(/\r\n|\r|\n/):[""]}function P(e,t,n,r,i){for(var a=[],o=0;o<e.length;o++)a[o]=wt.measureText(t,e[o],n,r,i||at).width;return a}function z(e){for(var t=0,n=0;n<e.length;n++)t=Math.max(t,e[n]);return t}function A(e,t,n,r,i,a,o,u,s,c,l,f,d,h,v,g,m,y,p){var x=wt.measureText(e,r,o,f,p).width;return U(e,t,n,r,i,a,o,u,s,c,l,f,d,h,v,g,x,m,y,p)}function B(e){return e>=Math.max(mt?0:wt.browserMinimumFontSize,3.5)}function U(e,t,n,r,i,a,o,u,s,c,l,f,d,h,v,g,m,y,p,x){var w=!0;0===r.length&&(w=!1);var M=u+Lt+"t",b=B(o);if(h&&m>g&&b)return A(e,t,n,r,i,a,Math.floor(.85*o),u,s,c,l,f,d,h,v,g,y,p,x);if(b&&wt.browserMinimumFontSize>o)return A(e,t,n,r,i,a,wt.browserMinimumFontSize,u,s,c,l,f,d,h,v,g,y,p,x);var k,L=t.dim(4),T=Math.floor(i-Math.round(m/2));k=v?Math.floor(a+Math.round(1+o/2)):Math.floor(a+Math.round((1+o)/2));var S={x1:T-L,y1:k-o,x2:T+Math.floor(m)+L,y2:k};if(b){if(s&&w&&n.rect(S.x1,S.y1,S.x2,S.y2,l,-1,l,!0,M),d&&N(d,S,o,!w),w){var C=v?t.dim(Tt):0;n.text(T,k+C,r,c,Math.round(o),f,M,x)}}else{if(S.y1-=1,S.y2-=1,S.x1=T,S.x2=T+Math.floor(m),S.y1===S.y2&&S.y2++,0===o){var I=t.dim(.2*p*r.length),O=Math.floor((S.x2+S.x1)/2);S.x2=O+I,S.x1=O-I}if(d&&N(d,S,o),w)if(s&&y)n.rect(S.x1,S.y1,S.x2,S.y2,l,-1,l,!0,M);else{var E=K(c,.4);n.rect(S.x1,S.y1,S.x2,S.y2,E,-1,E,!0,M)}}return w}function N(e,t,n,r){e._edit?(e._edit.x1=Math.min(e._edit.x1,t.x1),e._edit.x2=Math.max(e._edit.x2,t.x2),e._edit.y1=Math.min(e._edit.y1,t.y1),e._edit.y2=Math.max(e._edit.y2,t.y2)):(e._edit=t,e._edit.fs=n),ct&&!r&&e._cl&&e._cl.push(t)}function K(e,t){var n=e+t;return zt[n]||(zt[n]=wt.alphaize(e,t)),zt[n]}function R(e,t,n,r,i){var a,o,u=2,s=Math.min(r,i||1/0);u="circle"===n?2*s*Math.PI:r,"dashed"===e?(a=Math.max(2*t,2),o=a/2):"dotted"===e&&(a=Math.min(t,.5),o=(2+a/t)*t);var c=u-(a+o)*Math.floor(u/(a+o)),l=c/Math.floor(u/(a+o));"circle"===n?(o-=.25*l,o=Math.max(o,1)):o+=.5*l,yt=a,pt=o}function F(e,t,n,r,i,a,o,u,s,c,l,f){var d="dotted"===s?0:l/2;if("box"===t&&(R(s,l,"line",i-n),e(n-d,r,i+d,r,c,l,f,yt,pt),e(i+d,a,n-d,a,c,l,f,yt,pt)),R(s,l,"line",a-r),"e"!==t&&e(i,r-d,i,a+d,c,l,f,yt,pt),"w"!==t&&e(n,a+d,n,r-d,c,l,f,yt,pt),"box"!==t){R(s,l,"line",i-n+b(n,r,o,u));var h="e"===t?d:0,v="e"===t?0:-d,g="e"===t?i:n;e(n-d+v,r,i+d+h,r,c,l,f,yt,pt),e(i+d+h,a,n-d+v,a,c,l,f,yt,pt),e(g+h+v,r,o,u,c,l,f,yt,pt),e(g+h+v,a,o,u,c,l,f,yt,pt)}}function _(e,t){var n=e.layer(),r=wt.selMap[n];r&&e.layer(r),t(),r&&e.layer(n)}function H(e,t,n){return n&&ht&&dt.hasOwnProperty(e)?dt[e]:t[e]}function j(e,t){return t?Ft[e.sh]?e.sh:"box":e.sh in Ft?e.sh:e.sq?"box":"circle"}function Y(e,t,n,r,i,a,o,u,s,c){o?R("dashed",a,"circle",r,r):yt=pt=void 0,e.circle(t,n,r,i,a,u,s,c,yt,pt)}function G(e,t,n,r,i,a,o,u,s,c,l){u?(e.rect(t,n,r,i,wt.colours.white,-1,s,c,l),F(e.line,"box",t,n,r,i,null,null,"dashed",a,o,l)):e.rect(t,n,r,i,a,o,s,c,l)}function W(e,t,n,r,i,a,o,u,s,c,l,f,d,h,v,g,m,y){h?(e.pentagon(t,n,r,i,a,o,u,s,c,l,wt.colours.white,-1,v,g,m),"e"===y?F(e.line,"e",c,l,a,o,r,i,"dashed",f,d,m):F(e.line,"w",a,o,c,l,r,i,"dashed",f,d,m)):e.pentagon(t,n,r,i,a,o,u,s,c,l,f,d,v,g,m)}function q(e,t,n,r,i,a,o,u,s,c){var l=r(i+o),f=r(a+o);if("circle"===e){var d=Math.min(l,f);u(d)}else{var h=t-l,v=n-f,g=t+l,m=n+f;if("box"===e)s(h,v,g,m);else{var y=l-r(i),p=y*Rt,x=r(i*Ut/Bt)+y*Kt;"e"===e?(g-=p,c(g,v,t+x,n,g,m,h,m,h,v)):(h+=p,c(h,m,t-x,n,h,v,g,v,g,m))}}}function Z(e,t,n,r,i,a,o,u,s,c,l,f,d,h){q(h,t,n,r,i,a,o,function(r){Y(e,t,n,r,u,s,c,l,f,d)},function(t,n,r,i){G(e,t,n,r,i,u,s,c,l,f,d)},function(t,n,r,i,a,o,v,g,m,y){W(e,t,n,r,i,a,o,v,g,m,y,u,s,c,l,f,d,h)})}function V(e,t,n,r,i,a,o,u){q(u,t,n,r,i,a,o,function(t){e._c=t},function(t,n,r,i){e._cl.push({x1:t,y1:n,x2:r,y2:i})},function(t,n,r,i,a,o,u,s,c,l){e._cl.push([t,n,r,i,a,o,u,s,c,l])})}function X(e,t,n,r,i,a,o,u,s){function c(e){return H(e,i,d)}if(!i.hi&&!i.du){var l=Ot(i),f=j(i,l),d=s(a),h=d&&!ht,v=c("b"),g=c("bs"),m=c("c"),y=l?1:c("e")||1,p=l?c("re"):!1,x=c("u"),w=c("fi");i._c=0,i._cl=[],i._edit=null;var M,b,k,L=!!v,T=!!m,S=!!x||!(!w||!w.t),C=St&&L&&"dashed"===g,I=L?v:wt.colours.white,O=L?y*(c("bw")||At):0,E=T?m:wt.colours.white,D=t.x(i.x),P=t.y(i.y),z=L?t.w(O):-1;l?(M=t.dim2,b=i.w/2,k=i.h/2):(M=t.dim,b=k=y*Bt);var A,B=b+O/2,U=k+O/2,N=L?O:y*At,K=3*N/4;if(A=st?L||T?O/2:K-N/2:K+N/2,(L||T)&&Z(r,D,P,M,B,U,0,I,z,C,E,T,a,f),(S||L||T)&&(V(i,D,P,M,B,U,A,f),d&&(p&&!S&&(Gt=Mt.clone(r.getLast())),h))){var R=Ct();_(r,function(){Z(r,D,P,M,B,U,K,R,t.w(N),!1,R,!1,a,f),p&&(Yt=r.getLast())})}if(S){var F=M(b)+1,Y=M(k)+1;x?r.image(D-F,P-Y,D+F,P+Y,u+x,a,i.ci?"ci":void 0):tt(r,t,e,a,D,P,F,w.t,w.c||wt.colours.black,ot),d&&p&&(Gt=Mt.clone(r.getLast()))}$(t,r,e,D,P,z,M,b,k,i,c,l,f,L,T,S,h,y,a,u)}}function $(e,n,r,a,o,u,s,c,l,f,d,h,v,g,m,y,p,x,w,M){var b,k=a,L=o,T=It(f),S=!1,C=d("fb"),I=d("fbc"),O=d("fc"),E=d("ff"),z=Math.floor((d("fs")||bt)*x),A=s(z),B=s(3*x+z/2),N=O?O:wt.colours.black,K=I?I:wt.colours.textback;p&&(N=t(),K=Ct());var R=o+s(l)+B,F=D(f),_=P(F,r,A,C,E),H=z+3,j=s(H),Y=H*F.length;F.length>0&&(k-=_[0]/2);var G=!1;if(h?f.tc&&(G=!0):y||(G=!0),G)if(!T||g||m||y)R=o-Math.round((F.length-1)*j/2);else{var W=s(Et*x);k=a+W,a+=Math.floor(_[0]/2+W),R=o,o+=Math.round((F.length-1)*j/2),f._c=W}var q=a;if(("e"===v||"w"===v)&&(g||m)){var Z=s(8*x);q+="e"===v?Z:-Z}F.length>0&&(L=R),g&&(y||h&&!f.tc)&&(R+=u-s(3*x));for(var V=0;V<F.length;V++){var X=U(r,e,n,F[V],q,R,A,w,!0,N,K,C,f,!1,!0,99,_[V],p,z,E||at);S=S||X,R+=j}var $=!i(f)||!S;if(T)if(y||g||m){var Q=3,tt=y?11:3;if(!h&&!y&&"circle"===v){var it=2;Q+=it,tt+=it}h&&(Q++,tt++);var ot=Math.floor(Q*x),ut=Math.floor(tt*x);if(f.g.length)for(b=0;b<f.g.length;b++){var st,ct=f.g[b],lt=null,ft=!1;switch(ct.p){case"ne":lt=c-ot,st=-l+ut;break;case"nw":lt=-c+ot,st=-l+ut,ft=!0;break;case"sw":lt=-c+ot,st=l-ut,ft=!0;break;case"se":lt=c-ot,st=l-ut}null!==lt&&J(n,e,r,w+Lt+ct.p,f.x,f.y,lt,st,x,ct,M,ft,!0)}}else{var dt=e.dim(Dt*x);$?k+=Math.floor((f.g.length-1)*dt/2):k-=e.dim(Et*x);var ht=k;if($&&p){for(b=f.g.length-1;b>=0;b--)n.circle(k,L,Math.floor(.6*dt),wt.colours.white,-1,Ct(),!0,w),k-=dt;k=ht}for(b=f.g.length-1;b>=0;b--)et(n,e,r,w+Lt+b,k,L,x,f.g[b],M),k-=dt}if(h||nt(n,e,r,w,a,o,x,f.bg,d),f.bu){var vt=0;h||y||g||m?vt=l:Y>0?vt=Y/2+4:It(f)&&(vt=13*x),rt(n,e,r,w,a,o,vt,x,f.bg,f.bu,M)}}function Q(e,t){var n=0,r=0;if(i(e)){var a=Math.floor((e.fs?e.fs:bt)*(e.e?e.e:1)),o=D(e),u=P(o,t,a,e.fb,e.ff);n=z(u),r=a*(o.length+1),e.u||(n/=10)}return{width:n,height:r}}function J(e,t,n,r,i,a,o,u,s,c,l,f,d){var h=t.x(i)+t.dim(o),v=t.y(a)+t.dim(u);et(e,t,n,r,h,v,s,c,l,f,d)}function et(e,t,n,r,i,a,o,u,s,c,l){if(u){var f=u.a?Ht:1,d=t.dim(9*o*f),h="b"in u?u.b:wt.colours.keyline,v=h?t.w(2*o):-1,g=!!(u.u||u.fi&&u.fi.t);if(u.c){if(u.t){var m=u.hasOwnProperty("fb")?u.fb:!0,y=u.fc||wt.colours.white,p=u.ff||at,x=o*kt[1],w=t.dim(x)*f,M=(u.t+"").substring(0,25),b=wt.measureText(n,M,w,m,p).width;if(u.w&&l&&b>2*d){var k,L,T,S=d;c?(k=i-(b-S)-d,L=i+d,T=i-(b-S)/2):(k=i-d,L=i+(b-S)+d,T=i+(b-S)/2),e.round(k,a-d,L,a+d,d,h,v,u.c,!0,r),U(n,t,e,M,T,a,w,r,!1,y,wt.colours.white,m,null,!0,!1,b,b,!1,x,p,0)}else e.circle(i,a,d,h,v,u.c,!0,r),M=(u.t+"").substring(0,4),x=o*kt[M.length-1],A(n,t,e,M,i,a,t.dim(x),r,!1,y,wt.colours.white,m,null,!0,!1,1.7*d,!1,x,p)}else if(e.circle(i,a,d,h,v,u.c,!0,r),g){var C=Math.floor(d/1.414);u.u?e.image(i-C,a-C,i+C,a+C,s+u.u,r):tt(e,t,n,r,i,a,C,u.fi.t,u.fi.c||wt.colours.black,ot)}}else g&&(u.u?e.image(i-d,a-d,i+d,a+d,s+u.u,r):tt(e,t,n,r,i,a,d,u.fi.t,u.fi.c||wt.colours.black,ot));jt=jt||u.a}}function tt(e,t,n,r,i,a,o,u,s,c){var l=Math.floor(wt.measureText(n,u,2*o,!1,c).width/2);e.rect(i-o,a-o,i+o,a+o,wt.colours.transparent,-1,wt.colours.transparent,!0,r),e.text(i-l,a+o,u,s,2*o,!1,r,c)}function nt(e,t,n,r,i,a,o,u,s){var c=e.layer();e.layer(u?wt.layers.BGHALOS:wt.layers.HALOS);for(var l=0;l<_t.length;l++){var f=_t[l],d=s(f);if(d){var h=r+Lt+f,v=t.sdim(d.r*o),g=t.sdim(d.w*o);g/2>=v?e.circle(i,a,v+g/2,wt.colours.white,-1,d.c,!0,h):e.circle(i,a,v,d.c,g,wt.colours.white,!1,h)}}e.layer(c)}function rt(e,t,n,r,i,a,o,u,s,c,l){if(c.t){var f=e.layer();e.layer(s?wt.layers.BGBUBBLES:wt.layers.BUBBLES);var d=c.p?""+c.p:"ne",h="w"===d.substring(1,2),v="s"===d.substring(0,1),g=r+Lt+"bu",m=Number(c.fs?c.fs:bt),y=c.b?c.b:wt.colours.keyline,p=c.c?c.c:wt.colours.white,x=c.fc?c.fc:wt.colours.black,w=t.dim(m),M=D(c),b=t.dim(m+3),k=b*M.length,L=P(M,n,m,c.fb,c.ff),T=z(L),S=13,C=6,I=2*u,O=9,E=13,A=10;o+=E;var U=k+t.dim(2*C),N=t.dim(2),R=Math.max(Math.floor(N/2),1),F=Math.max(t.dim(3),1),_=c.g?17:0;h&&(i-=t.dim(T+2*I+2*S+_)),v&&(a+=t.dim((m+3)*M.length+2*o+2*C));var H=i+t.dim(I)+.5,j=i+t.dim(I+2*S+T+_)+.5,Y=a-t.dim(o)-U+.5,G=a-t.dim(o)+.5;e.round(H,Y,j,G,t.dim(8),y,N,p,!0,g),et(e,t,n,g,i+t.dim(_),(Y+G)/2,1,c.g,l);
var W,q=Y-.5+t.dim(C)+b,Z=H+t.dim(S+_)-.5;if(B(w))for(W=0;W<M.length;W++)e.text(Z,q,M[W],x,w,c.fb,g,c.ff||at),q+=b;else{var V=K(x,.4),X=t.dim(m);for(W=0;W<M.length;W++)e.rect(Z,q-X,Z+t.dim(L[W]),q,V,-1,V,!0,g),q+=b}h&&(H=j,O=-O,A=-A,R=-R),v&&(G=Y,E=-E,F=-F),t.dim(Math.abs(A))>3&&(e.triangle(H+t.dim(O),G,H+t.dim(O+A),G,H+t.dim(O),G+t.dim(E),y,N,p,!0,g),e.triangle(H+t.dim(O)+R,G-F,H+t.dim(O+A)+R,G-F,H+t.dim(O)+R,G+t.dim(E)-F,y,-1,p,!0,g)),e.layer(f)}}var it,at,ot,ut,st,ct,lt,ft,dt,ht,vt,gt,mt,yt,pt,xt={},wt=KeyLines.Rendering,Mt=KeyLines.Util,bt=xt.fontSize=14,kt=[12,9,7,7],Lt=Mt.idSep(),Tt=0,St=!1;xt.setDashSupport=function(e){St=!!e};var Ct=xt.editColour=function(){return ut||wt.colours.edit};xt.setOptions=function(e){it=e.arrows,Mt.isNumber(e.labelOffset)&&(Tt=e.labelOffset),ut=e.selectionColour,ft=e.fanLength,at=e.fontFamily,ot=e.iconFontFamily,ct=e.linkEnds.avoidLabels,st="loose"!==e.linkEnds.spacing,lt=e.selectionFontColour,dt=e.selectedNode,ht=Mt.isNormalObject(e.selectedNode),vt=e.selectedLink,gt=Mt.isNormalObject(e.selectedLink),mt=e.allowOversizedText};var It=xt.itemHasGlyph=function(e){return e.hasOwnProperty("g")&&Mt.isArray(e.g)&&e.g.length>0},Ot=xt.shapeTest=function(e){return isFinite(e.w)&&isFinite(e.h)},Et=13,Dt=21,Pt=Math.PI/7;xt.labelPosition=function(e,t){if(!e||e.hi)return null;for(var n=e._edit,r=["x1","x2","y1","y2","fs"],i=0;i<r.length;i++)n[r[i]]=t.unscale(n[r[i]]);return n};var zt={},At=4,Bt=27,Ut=50,Nt=Ut-Bt,Kt=Math.sqrt(Bt*Bt+Nt*Nt)/Bt,Rt=1-Math.sin(Math.atan2(Bt,Nt)/2),Ft={box:!0,circle:!0,e:!1,w:!1};xt.nodeSize=function(e,t,n){if(e.w&&e.h)return Mt.len(e.w,e.h)/2;if(e.du)return 10;var r=Bt*(e.e?e.e:1),i=Q(e,t);if(n){var a=r+i.height/2,o=i.width/2;return Mt.len(o,a)}return r+i.height/2};var _t=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"];xt.contains=function(e,t){function n(e,t){e&&a.push(t)}var r,i,a=[];if(e=Mt.defaults(e,{sh:"box",x:0,y:0}),Ot(e))if("circle"===e.sh){var o=Math.min(e.w,e.h)/2;for(i in t)r=t[i],Ot(r)?"circle"===r.sh?n(wt.insideCircle(e.x,e.y,o,r.x,r.y,Math.min(r.w,r.h)/2),r.id):n(wt.circleContains(e.x,e.y,o,r.x-r.w/2,r.y-r.h/2,r.x+r.w/2,r.y+r.h/2),r.id):n(wt.insideCircle(e.x,e.y,o,r.x,r.y),r.id)}else{var u={x1:e.x-e.w/2,y1:e.y-e.h/2,x2:e.x+e.w/2,y2:e.y+e.h/2};for(i in t)if(r=t[i],Ot(r))if("circle"===r.sh){var s=Math.min(r.w,r.h)/2;n(wt.rectContains(u,r.x-s,r.y-s,r.x+s,r.y+s),r.id)}else n(wt.rectContains(u,r.x-r.w/2,r.y-r.h/2,r.x+r.w/2,r.y+r.h/2),r.id);else n(wt.inside(u,r.x,r.y),r.id)}return a};var Ht,jt,Yt,Gt;return xt.reset=function(){jt=!1,Yt=null,Gt=null},xt.getResizePrimitive=function(){return Gt},xt.animated=function(){return jt},xt.generate=function(t,n,r,i,u,s,c,l,f,d,h){var v,g,m,y;Ht=e.atanEasing((new Date).getTime()%1e3/1e3),c&&c.reset();for(v in t)g=t[v],(!l||l(g))&&(y=a(g),r.layer(y),X(i,u,s[g.u],r,g,v,c,f,d));for(v in n)m=n[v],(!l||l(m))&&(y=o(m),r.layer(y),C(i,u,r,m,v,t[m.id1],t[m.id2],c,f,d));r.layer(wt.layers.HANDLES),Yt&&1===h.length&&wt.getHandles(r,i,Yt,1,Yt.id,Ct(),Lt)},xt}}(),!function(){var e=KeyLines.Overlays={};e.createOverlays=function(e,t,n){function r(e,t){return m[e]=t?!0:!1,e}function i(){return n&&n.api.isShown()}function a(){return n&&n.internalUse.isMapLoaded()}function o(){y=c.colours.ci,p=c.colours.cia}function u(e){g[e]&&g[e].apply(null,arguments)}function s(e,t,n,r,i,a,o){e.rect(t.scale(n),t.scale(r),t.scale(i),t.scale(a),c.colours.white,-1,c.colours.white,!0,o)}var c=KeyLines.Rendering,l=KeyLines.Util,f={},d={},h={},v=[],g={},m={};f.appendImageList=function(e){for(var t in m)e[t]=1};var y,p;o(),f.colorize=function(e,t,n){var r,i={},a="rgb(0,174, 234)";if(n){var u=c.colorize(e,m,t,a,n);r=u.colour,i=u.images,y=c.rgbtostring(r[0],r[1],r[2]),p=c.rgbatostring(r[0],r[1],r[2],.5)}else o();for(var s in e){var l=i[s]?i[s]:e[s].im;e[s].co=l}},f.setup=function(){x(),e.bind("click",u)},f.createDragger=function(e,t,n){return e in d?d[e](t,n):null};var x=f.reset=function(){d={},h={},v=[],g={},m={},e.unbind("click",u)};f.getCursor=function(e){return e in h?h[e]:"auto"},f.generate=function(e,t,n,r,i,a,o,u){for(var s=0;s<v.length;s++)v[s].generate(e,t,n,r,i,a,o,u)},f.getWatermarkSize=function(e,t){for(var n=0;n<v.length;n++){var r=v[n];if(r.watermarkSize)return r.watermarkSize(e,t)}return null},f.addLogo=function(e){var t=15,n="_logo",i={generate:function(r,i,a,o,u,s){r.layer(c.layers.OVERLAYS);var l=o[e].im;s||r.image(a.scale(a.width()-(l.width+t)),a.scale(t),a.scale(a.width()-t),a.scale(t+l.height),e,n)}};v.push(i),r(e)},f.addTextWatermark=function(e,t,n,i,a,o,u,s){var l="_textWatermark",f={watermarkSize:function(r,i){var a,o;if(e&&i){var u=i[e].im;a=u.width,o=u.height}else t&&(a=c.measureText(r,t,n,s).width,o=n);return a?{width:a+10,height:o+10}:null},generate:function(r,f,d,h,v,g){if(r.layer(c.layers.UNDERLAYS),!g){var m,y;if(e){var p=h[e].im;return m=d.scale((d.width()-p.width)/2),y=d.scale((d.height()-p.height)/2),r.image(m,y,m+d.scale(p.width),y+d.scale(p.height),e,l),void 0}if(t){var x=d.scale(n),w=c.measureText(f,t,n,s).width;m=d.scale((d.width()-w)/2),y=d.scale((d.height()+n)/2);var M=Math.floor(x/4),b=Math.floor(x/8);"top"===u&&(y=x+b),"bottom"===u&&(y=d.scale(d.height())+1),o&&r.rect(m-M,y-x-b,m+w+M+b,y,o,-1,o,!0,l),r.text(m,y,t,i,x,a,l,s)}}}};v.push(f),e&&r(e)},f.addNavigation=function(t,o,u,l,f,m){function y(){return t.options().handMode}function p(e,n){var r=e-b[T].im.height/2,i=w(r);t.setZoom(i,n)}function x(e){var t;return t=a()?n.internalUse.zoom():(Math.log(e)-Math.log(l.getMinZoom()))/(Math.log(l.getMaxZoom())-Math.log(l.getMinZoom())),Math.floor(D+(1-t)*(P-D))}function w(e){var t,r=1-(e-D)/(P-D);return t=i()?n.internalUse.getMaxZoom()*r:Math.exp(r*(Math.log(l.getMaxZoom())-Math.log(l.getMinZoom()))+Math.log(l.getMinZoom()))}function M(){return l.height()<300}var b,k=r(m+"Background.png",!0),L=r(m+"BackgroundShort.png",!0),T=r(m+"Slider.png"),S=r(m+"Hand.png"),C=r(m+"Arrow.png"),I=7,O=17,E=28,D=135,P=232;g._zoomIn=function(){t.zoomIn(!0)},g._zoomOut=function(){t.zoomOut(!0)},g._panLeft=function(){t.pan("left",!0)},g._panRight=function(){t.pan("right",!0)},g._panUp=function(){t.pan("up",!0)},g._panDown=function(){t.pan("down",!0)},g._fitToWindow=function(){t.fitToModel(!0)},g._toggleMode=function(){var e=t.options();e.handMode=!e.handMode,t.options(e)},g._scale=function(e,t,n){p(n,!0)},h._zoomIn=h._zoomOut=h._panLeft=h._panRight=h._panUp=h._panDown=h._fitToWindow=h._toggleMode=h._scale="pointer",h._slider='url("'+m+'openhand.cur"), pointer',d._slider=function(){var r=l.zoom();return M()?null:e.trigger("dragstart","slider")?void 0:(i()&&n.internalUse.enableDragging(!1),{getCursor:function(){return"move"},dragMove:function(e,t){t=l.unscale(t),p(t,!1)},endDrag:function(a){var o=e.trigger("dragend","slider");a=a&&!o,a||t.setZoom(r,!1),i()&&n.internalUse.enableDragging(t.options().handMode),e.trigger("dragcomplete","slider")}})};var z={generate:function(e,t,n,r,i,a,o){e.layer(c.layers.OVERLAYS);var u=M()?L:k,l=r[u].im;if(!o){if(b=r,a){var f=18;s(e,n,32,104+f,54,115+f,"_zoomIn");var d=M()?125:223;s(e,n,32,d+f,54,d+17+f,"_zoomOut"),s(e,n,16,42,32,58,"_panLeft"),s(e,n,53,42,68,58,"_panRight"),s(e,n,32,25,48,41,"_panUp"),s(e,n,32,63,48,76,"_panDown"),s(e,n,32,48,48,58,"_fitToWindow"),M()||s(e,n,36,119+f,50,220+f,"_scale"),s(e,n,27,85,49,107,"_toggleMode")}else e.image(n.scale(I),n.scale(O),n.scale(I+l.width),n.scale(O+l.height),u,"_background","co"),e.image(n.scale(26),n.scale(81),n.scale(54),n.scale(113),y()?S:C,"_toggleMode");if(!M()){var h=x(n.zoom());e.image(n.scale(E),n.scale(h),n.scale(E+r[T].im.width),n.scale(h+r[T].im.height),T,"_slider")}}},createDragger:function(){}};h[k]="wait",v.push(z)};var w,M,b;return f.addOverview=function(n,i,a,o,u,s){function l(e){var t={x1:a.newToOldX(a.scale(-e)),x2:a.newToOldX(a.scale(a.width()+e)),y1:a.newToOldY(a.scale(-e)),y2:a.newToOldY(a.scale(a.height()+e))};return{x1:E.oldToNewX(t.x1),x2:E.oldToNewX(t.x2),y1:E.oldToNewY(t.y1),y2:E.oldToNewY(t.y2)}}function f(){U+=D.x,N+=D.y,e.trigger("redraw")}function m(){R=setInterval(f,50)}function x(){R&&(clearInterval(R),R=null)}function k(e){var t=Math.max(e.width(),e.height())/2;E.reset(!1,!0);var n=l(t);E.fitExtents(n,!1,!1,void 0,void 0,void 0,!0);var r=e.getMaxItemZoom();1/0!==r&&E.setMaxItemZoom(r/8),z&&E.panBy(U,N,!1,!0)}var L=r(u+"ArrowUp.png",!0),T=r(u+"ArrowDown.png",!0);s.overview.size=s.overview.size||100,w=s.overview.size,b=s.overview.shown,M=o(w,w);var S=M.getContext("2d"),C=!1,I=!1,O=(new Date).getTime(),E=t.createView(e,w,w);g._overviewIcon=function(){b=s.overview.shown=!s.overview.shown,e.trigger("overview",b?"open":"close")},h._overviewIcon="pointer";var D,P=null,z=!1,A=0,B=0,U=0,N=0,K=2;h._overviewBox='url("'+u+'openhand.cur"), pointer';var R;d._overviewBox=function(t,r){if(!e.trigger("dragstart","overview")){z=!0;var i=2;A=0,B=0,U=0,N=0;var o=-P.x1+i,u=w-P.x2-i,s=-P.y1+i,c=w-P.y2-i;return{getCursor:function(){return"move"},dragMove:function(e,n){x(),A=e-t,B=n-r,D={x:0,y:0};var i=!1;o>A&&(A=o,D.x=K,i=!0),A>u&&(A=u,D.x=-K,i=!0),s>B&&(B=s,D.y=K,i=!0),B>c&&(B=c,D.y=-K,i=!0),i&&m()},endDrag:function(t){z=!1,x();var r=e.trigger("dragend","overview");if(t&&!r){var i=-(A-U)*a.zoom()/E.zoom(),o=-(B-N)*a.zoom()/E.zoom();n.panBy(i,o,!0)}e.trigger("dragcomplete","overview")}}}};var F=c.instructionPool(),_={generate:function(t,r,a,o,u,f,d,h){if(t.layer(c.layers.OVERVIEW),!d){if(b&&(t.rect(a.scale(a.width()-w-2),a.scale(a.height()-w-2),a.scale(a.width()+1),a.scale(a.height()+1),c.colours.white,Math.max(1,a.scale(3)),c.colours.white,f,"_overviewBorder1"),t.rect(a.scale(a.width()-w)-.5,a.scale(a.height()-w)-.5,a.scale(a.width()+1),a.scale(a.height()+1),c.colours.lightgrey,Math.max(1,a.scale(1)),c.colours.white,!1,"_overviewBorder2"),i)){if(f)P||k(a);else{var v=(new Date).getTime();C&&!z&&O+1e3>v&&I?e.trigger("redraw"):(O=(new Date).getTime(),C=!0,S.clearRect(0,0,w,w),S.fillStyle=c.colours.white,S.fillRect(0,0,w,w),n.drawBackground(S),k(a),F.reset(),i.generate(F,S,E,o,null,null,h),c.draw(S,F,o,c.overviewLayers),I=(new Date).getTime()-O>30)}P||(P=l(0)),t.layer(c.layers.OVERVIEW),z||t.rect(a.scale(a.width()-w+P.x1),a.scale(a.height()-w+P.y1),a.scale(a.width()-w+P.x2),a.scale(a.height()-w+P.y2),y,Math.max(1,a.scale(2)),p,!0,"_overviewBox"),z&&t.rect(a.scale(a.width()-w+P.x1+A),a.scale(a.height()-w+P.y1+B),a.scale(a.width()-w+P.x2+A),a.scale(a.height()-w+P.y2+B),y,Math.max(1,a.scale(2)),c.colours.white,!1,"_overviewBoxDragging")}var g=b?T:L,m=o[g].im;s.overview.icon&&(f?t.rect(a.scale(a.width()-2*m.width),a.scale(a.height()-2*m.height),a.scale(a.width()+1),a.scale(a.height()+1),c.colours.lightgrey,-1,c.colours.white,!0,"_overviewIcon"):(t.rect(a.scale(a.width()-m.width)-.5,a.scale(a.height()-m.height)-.5,a.scale(a.width()+1),a.scale(a.height()+1),c.colours.lightgrey,Math.max(1,a.scale(1)),c.colours.white,!0,"_overviewIconRect"),t.image(a.scale(a.width()-m.width),a.scale(a.height()-m.height),a.scale(a.width()),a.scale(a.height()),g,"_overviewIcon","co")))}}};v.push(_)},f.remove=function(e,t,n){var r=42,i={generate:function(i,a,o,u,s,l){if(i.layer(c.layers.OVERLAYS),!l){var f=c.measureText(a,e,r).width,d=o.scale((o.width()-f)/2),h=o.scale((o.height()+r)/2);i.text(d+2,h+2,e,n,o.scale(r),!0),i.text(d,h,e,t,o.scale(r),!0)}}};v.push(i)},f.drawOverviewContent=function(e,t){if(b&&M){var n=t.scale(w);e.isFlash?e.drawImageDirect(M,0,0,w,w,t.scale(t.width()-w),t.scale(t.height()-w),n,n):e.drawImage(M,0,0,n,n,t.scale(t.width()-w),t.scale(t.height()-w),n,n)}},f.addBanding=function(e){var t=6,n=3,r=3,i=6,a={generate:function(a,o,u,s,f,d){if(!d){var h=l.merge({top:!0},e.bands);if(h&&h.bands){var v,g,m,y,p,x,w;a.layer(c.layers.BANDS);var M=1/0;for(v=0;v<h.bands.length;v++)p=h.bands[v],p.t&&(g=u.dim(p.w/2),m=p.ff||e.fontFamily,y=p.fs||20,x=.75*y,w=c.measureText(o,p.t,y,p.fb,m).width/2,w+x>g&&(y=Math.floor(y*g/(w+x))),M>y&&(M=y));for(1/0!==M&&(x=.75*M),v=0;v<h.bands.length;v++){p=h.bands[v];var b=u.x(p.x),k=u.x(p.x-p.w/2),L=u.x(p.x+p.w/2),T=u.scale(-1),S=u.scale(u.height()+1);g=u.dim(p.w/2);var C=p.c||"#f7f7f7";if(a.rect(k,T,L,S,"white",-1,C,!0,""),p.t&&M>3){a.layer(c.layers.BANDLABELS),m=p.ff||e.fontFamily,w=c.measureText(o,p.t,M,p.fb,m).width/2;var I=p.fc||c.colours.lightgrey,O=u.scale(M);if(h.top){var E=t+O;a.rect(k,T,L,E+n,"white",-1,C,!0,""),a.text(b-w,E,p.t,I,O,p.fb,"",m)}if(h.bottom){var D=u.height()-r,P=D-(O+i);a.rect(k,P,L,S,"white",-1,C,!0,""),a.text(b-w,D,p.t,I,O,p.fb,"",m)}a.layer(c.layers.BANDS)}}}}}};v.push(a)},f}}(),!function(){var e="undefined"!=typeof L&&L.version;"undefined"!=typeof window&&(window.L_PREFER_CANVAS=!0);var t=KeyLines.Map={};t.create=function(t,n,r){function i(){throw new Error("The Map library has not been loaded")}function a(){throw new Error("Flash version does not support maps")}function o(e){return Ft?a:Yt?e:i}function u(e){Yt&&!Ft&&(e.map=N())}function s(e,t){var n=St.latLngToContainerPoint([e,t]);return{x:n.x,y:n.y}}function c(e,t){var n=St.containerPointToLatLng([e,t]);return{lat:n.lat,lng:n.lng}}function l(e,t){var n=St._container,r=n.parentNode;n.style.height=t+"px",n.style.width=e+"px",r.style.height=t+"px",r.style.width=e+"px",setTimeout(nt,0)}function f(e){t.privateEach({type:"node"},function(t){t.hi||e({id:t.id,x:t.x,y:t.y})})}function d(){var e=[];return f(function(t){e.push(t)}),e}function h(){var e={};return f(function(t){e[t.id]=t}),e}function v(){Ht="restore"===Kt.transition?h():null}function g(e){if("restore"===Kt.transition&&Ht){var n=Dt.dictValues(Ht);Ht=null,t.setProperties(n,!1,e)}else t.allowDraw(!1),t.layout("standard",{animate:!1},function(){t.allowDraw(!0),Dt.invoke(e)})}function m(e,t){if(e){for(var n in e)Kt[n]=e[n];"tiles"in e&&St?B(t):Dt.invoke(t)}return Dt.clone(Kt)}function y(e){function r(){z(),I(C(),!1),Mt(function(){b(Kt.animate,i)})}function i(){Bt=!0,Ut=!1,n.trigger("map","showend"),Dt.invoke(e)}if(St||Ut)return Dt.invoke(e);Ut=!0,n.trigger("map","showstart"),p(),t.options(At),Pt={};var a={};t.privateEach({type:"node"},function(e){e.hi||Lt(e)||(Pt[e.id]=!0,a[e.id]=!0)}),t.privateEach({type:"link"},function(e){e.hi||!a[e.id1]&&!a[e.id2]||(Pt[e.id]=!0)}),v();var o=Dt.dictKeys(Pt);o.length>0?t.hide(o,{time:Kt.time,animate:Kt.animate},r):r()}function p(){var e=t.options();zt={};for(var n in At)zt[n]=e[n]}function x(){t.options(zt),zt={}}function w(){Ot.style.top=null,Ot.style.left=null,Ot.parentNode.style.position=null}function M(e,n,r){e?t.privateAnimateBackgroundOpacity(n,{time:Kt.time},r):(t.privateSetBackgroundOpacity(n),Dt.invoke(r))}function b(e,t){w(),U(),M(e,0,t)}function k(e,t){M(e,1,t)}function T(t,n,r,i,a,o){function u(e){if(p.push(e),p.length>=y){for(var r=i(d.x,d.y),u=r.getContext("2d"),s=0;s<p.length;s++){var c=p[s];u.drawImage(c.img,Math.floor(c.pos.x),Math.floor(c.pos.y),c.size,c.size)}var l=i(t,n),f=l.getContext("2d"),h=r.width,v=r.height;h/v!==t/n&&(v=h/(t/n)),f.drawImage(r,0,0,h,v,0,0,t,n),f.drawImage(a,0,0);var g;try{g=l.toDataURL()}catch(m){throw new Error("[toDataURL] There is a problem to export the chart with tainted map tiles.")}Dt.invoke(o,g)}}function s(e,t,n,r){var i=new Image;i.crossOrigin="",i.onload=function(){return r({img:i,pos:t,size:n})},i.onerror=function(){return r({img:x,pos:t,size:n})},i.src=e}if(!Bt||!St||"exact"!==r.fit)return Dt.invoke(o,a.toDataURL());if(e)throw new Error("[toDataURL] The mapping library has to be loaded after KeyLines to make toDataURL work");var c=St.getPixelBounds(),l=St.getPixelOrigin(),f=St.getZoom(),d=St.getSize(),h=It.options.tileSize;if(f>It.options.maxZoom||f<It.options.minZoom)return Dt.invoke(o,a.toDataURL());for(var v=L.bounds(c.min.divideBy(h)._floor(),c.max.divideBy(h)._floor()),g=v.max.y-v.min.y+1+(v.min.y>0?0:v.min.y),m=v.max.x-v.min.x+1+(v.min.x>0?0:v.min.x),y=g*m,p=[],x=i(1,1),w=v.min.y;w<=v.max.y;w++)for(var M=v.min.x;M<=v.max.x;M++){var b=new L.Point(M,w);b.z=f;var k=It._getTilePos(b).subtract(c.min).add(l);b.y>=0&&b.x>=0&&s(It.getTileUrl(b),k,h,u)}}function S(e){function r(){Ut=!1,St=null,n.trigger("map","hideend"),Dt.invoke(e)}function i(e,n,i,a){var o=Dt.dictKeys(Pt);t.viewOptions(e,{animate:!1},function(){t.hide(o,{animate:!1},function(){t.setProperties(n,!1,function(){t.allowDraw(!0),t.viewOptions(i,{animate:!0,time:Kt.time}),t.animateProperties(a,{time:Kt.time},function(){o.length>0?t.show(o,!1,{animate:!0,time:Kt.time},r):r()})})})})}function a(){k(Kt.animate,function(){D(),x();var e,n;Kt.animate&&(e=t.viewOptions(),n=d()),t.show(Dt.dictKeys(Pt),!1,{animate:!1},function(){Bt=!1,g(function(){t.zoom("fit",{animate:!1},function(){if(Kt.animate){var a=t.viewOptions(),o=d();i(e,n,a,o)}else r()})})})})}if(!St||Ut)return Dt.invoke(e);Ut=!0,n.trigger("map","hidestart");var o=C();o.length&&St.getZoom()!==St.getBoundsZoom(L.latLngBounds(o))?(St.once("zoomend",a),I(o,Kt.animate)):a()}function C(){var e=[];return t.privateEach({type:"node"},function(t){Lt(t)&&!t.hi&&e.push(L.latLng(t.pos.lat,t.pos.lng))}),e}function I(e,t){e.length?St.fitBounds(L.latLngBounds(e),{animate:!!t,padding:[5,5]}):St.setView(L.latLng(0,0),2,{animate:t})}function O(e){if(!e)return-1;for(var t=0,n=e;n=n.previousSibling;)++t;return t}function E(e,t){var n=Et>0?e.childNodes[Et+1]:e.firstChild;e.insertBefore(t,n||null)}function D(){var e=St._container,t=e.parentNode,n=t.parentNode;St.removeControl(Ct),St.remove(),n.removeChild(t),E(n,Ot),Ot.style.position="",Ot.style["margin-top"]=null,Ot.style["margin-left"]=null}function P(e){Ot.style.position="absolute",Ot.style.top=0,Ot.style.left=0,Ot.style["margin-top"]=0,Ot.style["margin-left"]=0,Ot.style.zIndex=2;var t=document.createElement("div");t.style.position="relative",t.id=e+"-container";var n=document.createElement("div");n.id=e,n.style.width=t.style.width=Ot.clientWidth+"px",n.style.height=t.style.height=Ot.clientHeight+"px",n.style.position="absolute",n.style.top=Ot.top,n.style.left=Ot.left;var r=Ot.parentNode;r.removeChild(Ot),t.appendChild(n),t.appendChild(Ot),E(r,t)}function z(e){P(_t),St=new L.Map(_t,{zoomAnimationThreshold:20,zoomControl:!1}),A(e)}function A(e){var t="",n={noWrap:!0};"string"!=typeof Kt.tiles?(t=(Kt.tiles||Rt.tiles).url,n=L.extend(n,Kt.tiles)):t=Kt.tiles,It=new L.TileLayer(t,n),e&&It.once("load",e),St.addLayer(It)}function B(e){St.removeLayer(It),A(e)}function U(e){Ct=Tt(e),St.addControl(Ct)}function N(){var e={show:Bt};if(Bt){var t=St.getCenter();e.lat=t.lat,e.lng=t.lng,e.zoom=St.getZoom(),e.bounds=St.getBounds().toBBoxString(),e.hiddenOnMap=Dt.clone(Pt),e.restoreXY=Dt.clone(Ht)}return e}function K(e,n){var r=!0;Yt&&!Ft&&(e=e||{},e.show?(Pt=Dt.clone(e.hiddenOnMap)||[],Ht=Dt.clone(e.restoreXY)||null,Bt||(Bt=!0,p(),r=!1,z(function(){t.options(At),b(!1,n)})),St.setView([e.lat,e.lng],e.zoom,{reset:!0}),wt()):!e.show&&Bt&&k(!1,function(){Bt=!1,D(),x(),St=null})),r&&Dt.invoke(n)}function R(e){e&&(jt.options=Dt.defaults(e,Xt),St&&j())}function F(e){jt={options:Dt.clone(Xt),zooming:null,zoomLevel:null,zoomAnimating:null},R(e)}function _(){return Ot.parentNode.removeChild(Ot),Ot.style.top=0,Ot.style.left=0,Y(),Ot}function H(){G(!1),dt(!1),Ot.removeAttribute("class")}function j(){St.off("zoomanim",q),jt.options.animZoom&&St.on("zoomanim",q)}function Y(){t.options({handMode:!0,hover:5}),G(!0),dt(!0)}function G(e){var t=e?"on":"off",n={resize:tt,dragend:V,drag:V,move:X};L.Browser.mobile||L.Browser.pointer&&L.Browser.touch?n.click=function(e){J(e),et(e)}:n.mousedown=J,St[t](n),jt.zooming=!1,L.DomEvent.getWheelDelta=function(e){var t;return t=void 0!==e.wheelDelta?e.wheelDelta:-e.detail,t>0?.025:0>t?-.025:0},jt.zoomLevel=St._zoom,St[t]("zoomstart",W),(!e||jt.options.animZoom)&&St[t]("zoomanim",q),St[t]("zoomend",Z)}function W(){jt.zooming=!0}function q(e){rt(e)}function Z(){jt.zooming=!1,jt.options.animZoom&&jt.options.zoomAnimating||wt()}function V(){mt(!0)}function X(){jt.zooming||wt()}function $(e,t){St.panBy(e,t)}function Q(e,n,r,i){var a=null,o=100,u={animate:!!n,duration:Dt.isNumber(r)?r/1e3:.25};if(Dt.isFunction(i)&&St.once("moveend",i),"selection"===e){var s=[],c=t.getItem(t.selection());if(c.length){for(var l,f=0;f<c.length;f++)l=c[f],"node"===l.type&&Lt(l)&&!l.hi&&s.push(L.latLng(l.pos.lat,l.pos.lng));St.panInsideBounds(L.latLngBounds(s),u)}}else{switch(e){case"up":a=[0,-o];break;case"down":a=[0,o];break;case"left":a=[-o,0];break;case"right":a=[o,0]}a&&St.panBy(a,u)}}function J(e){var n=e.originalEvent,r=KeyLines.coords(n);t.mousedown(n.button,r.x,r.y,n.ctrlKey,n.shiftKey),n.stopPropagation()}function et(e){var n=e.originalEvent,r=KeyLines.coords(n);t.mouseup(n.button,r.x,r.y,n.ctrlKey,n.shiftKey),n.stopPropagation()}function tt(){Nt=!0,wt()}function nt(){Nt||(St.invalidateSize(!0),tt()),Nt=!1}function rt(e){if(!jt.zoomAnimating){jt.zoomAnimating=!0;var n=[];t.privateEach({type:"node"},function(r){if(Lt(r)){var i=St._latLngToNewLayerPoint(L.latLng(r.pos.lat,r.pos.lng),e.zoom,e.center),a=St.layerPointToContainerPoint(i),o=t.worldCoordinates(a.x,a.y);n.push({id:r.id,x:o.x,y:o.y})}}),t.animateProperties(n,{time:150,queue:!1},function(){jt.zoomAnimating=!1,jt.zooming||wt()})}}function it(){var e=St.getZoom();e=Math.min(Vt,Math.max(Zt,e));var t=Wt+(qt-Wt)*(e-Zt)/(Vt-Zt);return t}function at(e,t,n,r){Dt.isFunction(r)&&St.once("moveend",r);var i=Math.round(e);St.setZoom(i,{animate:t})}function ot(){return St.getZoom()}function ut(){return!!St}function st(){return Ut}function ct(){return St.getMaxZoom()}function lt(e,n,r,i){var a={animate:!!n,duration:Dt.isNumber(r)?r/1e3:.25};switch(Dt.isFunction(i)&&St.once("moveend",i),e){case"in":St.zoomIn(1,a);break;case"out":St.zoomOut(1,a);break;case"fit":case"fitToModel":I(C(),!!n);break;case"selection":case"fitToSelection":for(var o,u=[],s=t.getItem(t.selection()),c=0;c<s.length;c++)o=s[c],Lt(o)&&!o.hi&&u.push(L.latLng(o.pos.lat,o.pos.lng));u.length&&I(u,!!n);break;case"height":case"fitModelHeight":var l=-1/0,f=-1/0,d=1/0,h=1/0;t.privateEach({type:"node"},function(e){Lt(e)&&!e.hi&&(e.pos.lat>l&&(l=e.pos.lat,f=e.pos.lng),e.pos.lat<d&&(d=e.pos.lat,h=e.pos.lng))}),isFinite(l)&&isFinite(f)&&isFinite(d)&&isFinite(h)&&I([[l,f],[d,h]],!!n)}return ot()/ct()}function ft(e){St.dragging.enabled()!==!!e&&(e?St.dragging.enable():St.dragging.disable())}function dt(e){var n=e?t.bind:t.unbind;n("dblclick",ht),n("dragstart",gt),n("keydown",vt)}function ht(){return!0}function vt(e){return e>36&&41>e}function gt(e){return"move"===e}function mt(e,n){var r=t.viewOptions(),i=St.getPixelBounds().min,a=St.getPixelOrigin();r.offsetX=a.x-i.x,r.offsetY=a.y-i.y;var o=it();r.zoom!==o&&(r.zoom=o);var u={animate:e,time:e?100:-1};t.viewOptions(r,u,n)}function yt(e){var n=St.latLngToContainerPoint([e.pos.lat,e.pos.lng]);return t.worldCoordinates(n.x,n.y)}function pt(){var e=[];return t.privateEach({type:"node"},function(t){if(Lt(t)){var n=yt(t);n.id=t.id,e.push(n)}}),e}function xt(e){var n,r,i,a;for(e=Dt.ensureArray(e),r=0;r<e.length;r++)n=e[r],n.hasOwnProperty("pos")&&(i={pos:Dt.merge(t.getItem(n.id).pos,n.pos)},a=yt(i),n.x=a.x,n.y=a.y)}function wt(e){mt(!1,function(){t.setProperties(pt(),!1,e)})}function Mt(e){if(Kt.animate){var n=t.viewOptions(),r=it();n.zoom===r?t.animateProperties(pt(),{time:Kt.time},e):t.viewOptions({zoom:r},{animate:!1},function(){var i=pt();t.viewOptions(n,{animate:!1},function(){function n(){0===--a&&Dt.invoke(e)}var a=2;t.viewOptions({zoom:r},{animate:!0,time:Kt.time},n),t.animateProperties(i,{animate:!0,time:Kt.time},n)})})}else wt(e)}function bt(e){if("node"===e.type)if(Ht&&delete Ht[e.id],delete Pt[e.id],Lt(e)){var t=e.x||0,n=e.y||0;Ht&&(Ht[e.id]={id:e.id,x:t,y:n});var r=yt(e);e.x=r.x,e.y=r.y}else e.hi||(e.hi=!0,Pt[e.id]=!0)}function kt(e){for(var n=[],r=0;r<e.length;r++){var i=e[r];if("node"===i.type){var a=t.getItem(i.id);if(a){var o={};Pt[i.id]?o.hi=!1:"hi"in a&&(o.hi=a.hi),Ht&&Ht[i.id]&&(o.x=Ht[i.id].x,o.y=Ht[i.id].y),a.pos&&(o.pos=a.pos),i=Dt.merge(o,i)}bt(i)}n.push(i)}return n}function Lt(e){return e.pos&&e.pos.lat&&e.pos.lng}function Tt(){var e=L.Control.extend({options:{position:"topleft"},setOptions:R,initialize:F,onAdd:_,onRemove:H});return new e(Kt)}var St,Ct,It,Ot,Et,Dt=KeyLines.Util,Pt={},zt={},At={watermark:!1,overview:!1,gestures:!1},Bt=!1,Ut=!1,Nt=!1,Kt={animate:!0,time:800,tiles:{url:"https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',subdomains:"abcd",minZoom:0,maxZoom:20},transition:"restore"},Rt=Dt.clone(Kt),Ft="undefined"==typeof document,_t=r+"-map";Ft||(Ot=document.getElementById(r),Et=O(Ot));var Ht,jt,Yt="undefined"!=typeof L&&L.version,Gt={api:{show:o(y),hide:o(S),viewCoordinates:o(s),mapCoordinates:o(c),isShown:function(){return Bt},leafletMap:function(){return St||null},options:o(m)},internalUse:{appendMap:u,convertPos:xt,loadUp:K,setSize:l,enableDragging:ft,pan:Q,panBy:$,zoom:lt,setZoom:at,getMaxZoom:ct,getZoom:ot,toDataURL:T,isMapLoaded:ut,preMerge:kt,preSetItem:bt,isTransitioning:st}},Wt=.75,qt=1.25,Zt=4,Vt=15,Xt={animZoom:!0,scaleOnZoom:!0};return Gt}}(),!function(){var e=KeyLines.TimeBar.Model={};e.createModel=function(e,t){function n(){e.trigger("redraw")}function r(e,t,r,i){U.t1=e,U.t2=t,N.t1=r,N.t2=i,C&&(a(),n()),et=!0}function i(e){var n=W[e.units]*e.by,r=n/I;return r>=t.histogram.minwidth}function a(){I=(N.t2-N.t1)/(C.x2-C.x1);var e=c(I);for(H.major=z[e].major,H.minor=z[e].minor;e>0&&i(z[e-1].minor);)e--;H.histogram=z[e].minor}function o(){G=null;for(var e=0;e<Y.length;e++)j[e]=null,Y[e]=null;j.length=0,Y.length=0}function u(e){G=e;var n,r;for(n=0;n<e.length;n++){var i=e[n].index||0;if(i<t.selection.maxNumber&&e[n].id){var a=E.ensureArray(e[n].id);if(a.length){Y[i]=E.makeIdMap(a),j[i]=[];var o=0;for(r=0;r<A.length;r++)j[i][r]=o,A[r].id in Y[i]&&(o+=A[r].v);j[i][r]=o,s(i,e[n].c)}else!a.length&&j[i]&&(j[i]=null,Y[i]=null)}}}function s(e,n){var r={colour0:"rgb(114, 179, 0)",colour1:"rgb(255, 153, 0)",colour2:"rgb(178, 38, 9)"},i=r["colour"+e];n&&D.validatergb(n)&&(i=n),t.selection["colour"+e]=i}function c(e){for(var t=0;z[t].max<e;)t++;return t}function l(e){for(var t=0,n=A.length;n>t;){var r=t+n>>>1;A[r].t<e?t=r+1:n=r}return t}function f(e,t){for(var n=l(e),r=l(t),i={},a=n;r>a;a++)i[A[a].id]||(i[A[a].id]=1);return E.flattenMap(i)}function d(e,t,n){for(var r=l(e),i=l(t),a=r;i>a;a++){var o=A[a].id;K[o]=(K[o]||0)+n}}function h(){var e=U.t1,t=U.t2,n=R.t1,r=R.t2;n>e?d(e,Math.min(n,t),1):e>n&&d(n,Math.min(e,r),-1),t>r?d(Math.max(e,r),t,1):r>t&&d(Math.max(n,t),r,-1),R.t1=e,R.t2=t}function v(){var e=$(),n=e?2*(e.t2-e.t1):F.max,r=F.min;return t.options.minRange&&(r=Math.max(r,t.options.minRange)),n=Math.max(n,Math.floor(4*r)),r=Math.min(r,Math.floor(n/4)),{max:n,min:r}}function g(){var e=0,n=T,r=t.options.showControlBar?t.controlbar.height:0,i=t.options.scale.showMinor?t.bars.minor.height:0,a=t.options.scale.showMajor?t.bars.major.height:0,o=S-r,u=o-a,s=u-i,c=s-t.histogram.dy,l=c-t.histogram.topdy,f=l*t.selection.reducingFactor;C={bars:{major:{y1:u,y2:o},minor:{y1:s,y2:u}},histogram:{ybase:c,maxbarh:l,maxselh:f},x1:e,y1:s,x2:n,y2:o,width:T,height:S}}function m(){var e,n,r,i=t.selection.maxNumber,a=H.histogram,o=P.clear(N.t1,a.units,a.by),u=l(o),s=0,c=0,f=0;for(n=0;i>n;n++)J.hasSel[n]=!!j[n],J.selvalues[n]=J.selvalues[n]||[];do{r=o>N.t2,J.x[s]=Z(o),o=P.add(o,a.units,a.by),e=l(o);var d=B[e]-B[u];for(J.value[s]=d,d>c&&!r&&(c=d),n=0;i>n;n++){var h=j[n];if(h){var v=h[e]-h[u];J.selvalues[n][s]=v,v>f&&!r&&(f=v)}}s++,u=e}while(!r);J.count=s-1,J.maxvalue=c,J.maxselvalue=f,et=!1}function y(e){var t=[];e=E.ensureArray(e);for(var n=0;n<e.length;n++){var r=e[n];if(r.id&&r.dt)for(var i=r.id+"",a=E.ensureArray(r.dt),o=E.ensureArray(r.v),u=0;u<a.length;u++){var s=q(a[u]);if(!E.isNumber(s))throw new Error("load: invalid date in dt property");var c=o[u]||1;if(!E.isNumber(c))throw new Error("load: invalid value in v property - must be numeric");t.push({id:i,t:s,v:c})}}return t}function p(){B=[0],K={},et=!0;for(var t=0;t<A.length;t++){var r=A[t];r.t>=U.t1&&r.t<U.t2&&(K[r.id]=(K[r.id]||0)+1),B[t+1]=B[t]+r.v}R.t1=U.t1,R.t2=U.t2,e.trigger("datachange"),n()}function x(e){E.numberSort(e,"t")}function w(e,t){return e.id===t.id?e.v-t.v:e.id>t.id?1:-1}function M(e,t,n){t.sort(w),n.sort(w);for(var r=0,i=0;r<t.length&&i<n.length;){var a=w(t[r],n[i]);0>a?(e.push(t[r]),r++):a>0?(e.push(n[i]),i++):(e.push(t[r]),r++,i++)}for(;r<t.length;)e.push(t[r]),r++;for(;i<n.length;)e.push(n[i]),i++}function b(e,t){for(var n=[],r=0,i=0;r<e.length&&i<t.length;){var a=e[r].t,o=t[i].t;if(o>a)n.push(e[r]),r++;else if(a>o)n.push(t[i]),i++;else{var u=r,s=i;do r++;while(r<e.length&&e[r].t===o);do i++;while(i<t.length&&t[i].t===o);r===u+1&&i===s+1?(n.push(e[u]),(e[u].id!==t[s].id||e[u].v!==t[s].v)&&n.push(t[s])):M(n,e.slice(u,r),t.slice(s,i))}}for(;r<e.length;)n.push(e[r]),r++;for(;i<t.length;)n.push(t[i]),i++;return n}function k(e,t){var n=Math.floor((e.t2-e.t1)*t);return{t1:e.t1-n,t2:e.t2+n}}function L(){var e=U.t1,t=U.t2;rt(U.t1,U.t2),(e!==U.t1||t!==U.t2)&&it()}var T,S,C,I,O={},E=KeyLines.Util,D=KeyLines.Rendering,P=KeyLines.DateTime,z=t.rates,A=[],B=[],U={t1:0,t2:0},N={t1:0,t2:0},K={},R={t1:0,t2:0},F={max:315576e7,min:3e3},_=250,H={},j=[],Y=[],G=null,W=[1,1e3,6e4,36e5,864e5,6048e5,2592e6,31536e6],q=O.extractUTC=function(e){var t;return e instanceof Date?t=P.UTCify(e):"number"==typeof e&&(t=e),t},Z=O.ttox=function(e){return C.x1+(e-N.t1)/I},V=O.xtot=function(e){return N.t1+(e-C.x1)*I},X=O.getClickedBar=function(e){return e>=C.bars.major.y1?"major":e>=C.bars.minor.y1?"minor":"histogram"};O.findRange=function(e,t){var n,r=X(t),i=V(e);return Q(r,function(e,t){return t>i?(n={t1:e,t2:t,bar:r},!0):void 0}),n};var $=O.dataRange=function(){if(A.length>0){var e=A[0].t,t=A[A.length-1].t+1;return{t1:e,t2:t}}},Q=O.eachTick=function(e,t){var n,r=H[e],i=P.clear(N.t1,r.units,r.by),a=!1;do n=P.add(i,r.units,r.by),a=t(i,n,Z(i),Z(n),r.f),i=n;while(!a&&i<=N.t2)},J={count:0,x:[],value:[],hasSel:[],selvalues:[],maxvalue:0,maxselvalue:0},et=!0;O.getHistogram=function(){return et&&m(),J},O.getBounds=function(){return C
},O.getInnerRange=function(){return U},O.getOuterRange=function(){return N},O.getTimeRate=function(){return I},O.nextPage=function(e){var t=U.t1,n=U.t2,r="forward"===e?1:-1,i=P.units.month;if(t===P.clear(t,i,1)&&n===P.clear(n,i,1)){var a=new Date(t),o=new Date(n),u=12*(o.getUTCFullYear()-a.getUTCFullYear())+o.getUTCMonth()-a.getUTCMonth();t=P.add(t,i,r*u),n=P.add(n,i,r*u)}else{var s=r*(n-t);t+=s,n+=s}return{t1:t,t2:n}},O.getItems=function(){return A},O.setInnerRangeSide=function(e,t){U[e]=t},O.getSideLimits=function(e){var n,r;if("t1"===e?(n=N.t1,r=U.t2):(n=U.t1,r=N.t2),"fixed"===t.options.sliders){var i=r-n,a=Math.floor(.1*i);n+=a,r-=a}var o=v();"t1"===e?(n=Math.max(n,U.t2-o.max),r=Math.min(r,U.t2-o.min)):(n=Math.max(n,U.t1+o.min),r=Math.min(r,U.t1+o.max));var u=$();return u&&("t1"===e?r=Math.min(r,u.t2):n=Math.max(n,u.t1)),{min:n,max:r}};var tt=O.hasItems=function(){return A.length>0},nt=O.limitInnerRange=function(e,t,n){var r,i=$(),a=n?(e+t)/2:(U.t1+U.t2)/2,o=v(),u=t-e;return u>o.max?(e=Math.ceil(a-o.max/2),t=Math.floor(a+o.max/2)):u<o.min&&(e=Math.floor(a-o.min/2),t=Math.ceil(a+o.min/2)),i&&(t<i.t1?(r=i.t1-t,e+=r,t+=r):e>i.t2&&(r=e-i.t2,e-=r,t-=r)),{t1:e,t2:t}};O.inMainBarOrHistogram=function(e,t){return e>=C.x1&&e<=C.x2&&t>=0&&t<=C.y2},O.load=function(e,t){var n=(e||{}).items,r=y(n);x(r),A=r,o(),p(),E.invoke(t)},O.merge=function(e,t){var n=y(e);n.length>0&&(x(n),A=0===A.length?n:n[0].t>A[A.length-1].t?A.concat(n):n[n.length-1].t<A[0].t?n.concat(A):b(A,n),G&&u(G),p()),E.invoke(t)},O.offsetRanges=function(e,t){var n=U.t1,r=U.t2;return rt(n+(t?0:e),r+e),n!==U.t1||r!==U.t2},O.selection=function(e){e=E.isNullOrUndefined(e)?e:E.ensureArray(e),e&&(e.length?u(e):o()),et=!0,n();for(var t=[],r=0;r<Y.length;r++)t[r]=Y[r]?E.flattenMap(Y[r]):null;return t};var rt=O.setInner=function(e,n){var i,a=nt(e,n);if("none"===t.options.sliders)i=a;else if("free"===t.options.sliders)if(tt()){var o=$(),u=v();o.t2-o.t1<u.min&&(o.t1=o.t1-u.min/2,o.t2=o.t2+u.min/2),i=k(o,t.freeSideFactor)}else i=N;else i=k(a,t.fixedSideFactor);r(a.t1,a.t2,i.t1,i.t2)};O.setOuter=function(e,t){r(U.t1,U.t2,e,t)},O.updateOptions=function(){L(),g()},O.setSize=function(e,t){T=e,S=t,g()};var it=O.triggerTimeBarChanged=E.ratelimit(function(){e.trigger("change")},_);return O.getIdcounts=function(){return(R.t1!==U.t1||R.t2!==U.t2)&&h(),K},O.getRangeForIds=function(e){e=E.ensureArray(e);var t,n,r=1/0,i=-1/0,a={};for(t=0;t<e.length;t++)a[e[t]]=!0;for(t=0;t<A.length;t++)n=A[t],a[n.id]&&(n.t<r&&(r=n.t),n.t>i&&(i=n.t));return 1/0!==r?{t1:r,t2:i}:void 0},O.getIds=function(e,t){if(E.isNullOrUndefined(e)||E.isNullOrUndefined(t))throw new Error("getIds error: both dt1 and dt2 dates must be passed.");var n=q(e),r=q(t);return f(n,r)},O}}(),!function(){var e=KeyLines.TimeBar.API=KeyLines.TimeBar.API||{};e.appendExtras=function(e){var t,n=KeyLines.Util;e.bind("change",function(){t=null}),e.bind("datachange",function(){t=null}),e.inRange=function(r){if(n.isNullOrUndefined(r))return!1;t=t||e.getIdcounts();var i=(n.isNormalObject(r)?r.id:r)+"";return!!t[i]}}}(),!function(){var e=KeyLines.TimeBar.API=KeyLines.TimeBar.API||{};e.createAPI=function(){var e=KeyLines.Common,t=KeyLines.Util,n={},r=KeyLines.Events.createEventBus(),i=KeyLines.TimeBar.Config.create(),a=KeyLines.TimeBar.Model.createModel(r,i),o=KeyLines.TimeBar.Generator.create(),u=KeyLines.TimeBar.Controller.createController(r,a,o,i);n.clear=function(){return a.load({items:[]})},n.getIds=function(e,t){return a.getIds(e,t)},n.load=function(e,t){return a.load(e,t)},n.options=function(e,t){return u.options(e,t)},n.pan=function(e,t,n){return u.pan(e,t,n)},n.pause=function(){return u.pause()},n.play=function(e){return u.play(e)},n.range=function(e,t,n,r){return 0!==arguments.length?u.range(e,t,n,r):u.range()},n.merge=function(e,n){return a.merge(t.getItemsArray(e),n)},n.selection=function(e){return a.selection(e)},n.zoom=function(e,n,r){return e=e||"in",n=t.defaults(n,{animate:!0,time:200,pad:0}),u.zoom(e,n,r)},n.privateInit=u.privateInit,n.privateSetSize=u.privateSetSize,n.getIdcounts=a.getIdcounts,n.privateAPIDefinitions=function(){return{getIdcounts:!0}},e.appendActions(n,u),t.merge(n,r);var s=KeyLines.Common.frameManager(u.draw,u.animate);return t.merge(n,s),n.bind("redraw",s.redraw),n.getItems=a.getItems,n}}(),!function(){var e=KeyLines.TimeBar.Config={};e.create=function(){function e(e,t){return a.format(e,t,c.options.locale)}function t(t){var n="dmy"===c.options.locale.order?"d MMM yyyy":"MMM d, yyyy";return e(t,n)}function n(t){var n=c.options.locale.h12?"h:mm tt":"HH:mm";return e(t,n)}function r(t){var n=c.options.locale.h12?"h:mm:ss tt":"HH:mm:ss";return e(t,n)}function i(e,t){if("histogram"===e){if(!o.isNormalObject(t))return!1;if(t.colour&&!KeyLines.Rendering.validatergb(t.colour))return!1;if(t.highlightColour&&!KeyLines.Rendering.validatergb(t.highlightColour))return!1}return o.contains(s.colours,e)?KeyLines.Rendering.validatergb(t):!0}var a=KeyLines.DateTime,o=KeyLines.Util,u=a.units,s={colours:["backColour","fontColour","sliderColour","sliderLineColour"]},c={displayTime:function(t,n){return o.isFunction(n)?n(t):e(t,n)},options:{scale:{highlightColour:"#F2F2F2",showMajor:!0,showMinor:!0},backColour:"#FFFFFF",fontColour:KeyLines.Rendering.colours.grey,showControlBar:!0,showPlay:!0,showExtend:!1,sliderColour:"rgba(255, 255, 255, 0.6)",sliderLineColour:"#bbb",sliders:"fixed",minRange:3e3,showSliders:!0,histogram:{colour:"#d0d0d0",highlightColour:"#a9a9a9"},heightChange:{animate:!0,time:200},locale:o.defaults(a.defaultLocale,{order:"mdy",h12:!0}),playSpeed:60},getOptions:function(){return o.clone(c.options)},setOptions:function(e){if(o.isNormalObject(e))for(var t in e)c.options.hasOwnProperty(t)&&(c.options[t]=o.isNormalObject(c.options[t])&&i(t,e[t])?o.defaults(e[t],c.options[t]):e[t])},hoverTime:50,defaultAnimationTime:200,sliderReleaseTime:200,doubleClickZoomTime:500,doubleClickZoomTimeFree:250,defaultPlaySpeed:60,bars:{major:{height:19,textbase:3,fontsize:13},minor:{height:17,textbase:0,fontsize:12}},grip:{lines:2,space:3,length:14},controlbar:{height:30,space:4,colour:"#ddd"},fixedSideFactor:.5,freeSideFactor:.2,histogram:{dy:2,topdy:16,bardx:1,minwidth:11},selection:{maxNumber:3,reducingFactor:.75,dotsize:3.5},rates:[{max:12,major:{units:u.sec,by:5,f:t},minor:{units:u.sec,by:1,f:r}},{max:24,major:{units:u.sec,by:10,f:t},minor:{units:u.sec,by:2,f:r}},{max:60,major:{units:u.sec,by:15,f:t},minor:{units:u.sec,by:5,f:r}},{max:120,major:{units:u.sec,by:30,f:t},minor:{units:u.sec,by:10,f:r}},{max:360,major:{units:u.min,by:1,f:t},minor:{units:u.sec,by:30,f:r}},{max:1e3,major:{units:u.min,by:5,f:t},minor:{units:u.min,by:1,f:n}},{max:5e3,major:{units:u.min,by:15,f:t},minor:{units:u.min,by:5,f:n}},{max:15e3,major:{units:u.hour,by:1,f:t},minor:{units:u.min,by:15,f:n}},{max:6e4,major:{units:u.hour,by:6,f:t},minor:{units:u.hour,by:1,f:n}},{max:12e4,major:{units:u.day,by:1,f:t,adjust:432e5},minor:{units:u.hour,by:2,f:n}},{max:18e4,major:{units:u.day,by:1,f:t,adjust:432e5},minor:{units:u.hour,by:3,f:n}},{max:36e4,major:{units:u.day,by:1,f:t},minor:{units:u.hour,by:6,f:n}},{max:72e4,major:{units:u.day,by:1,f:t},minor:{units:u.hour,by:12,f:"ttt"}},{max:5e6,major:{units:u.week,by:1,f:function(t){var n,r,i=new Date(t),o=new Date(a.add(t,u.day,6)),s="dmy"===c.options.locale.order;return i.getUTCFullYear()===o.getUTCFullYear()?i.getUTCMonth()===o.getUTCMonth()?(n=s?"d - ":"MMM d - ",r=s?"d MMM yyyy":"d, yyyy"):(n=s?"d MMM - ":"MMM d - ",r=s?"d MMM yyyy":"MMM d, yyyy"):(n=s?"d MMM yyyy - ":"MMM d, yyyy - ",r=s?"d MMM yyyy":"MMM d, yyyy"),e(i,n)+e(o,r)}},minor:{units:u.day,by:1,f:"d"}},{max:15e6,major:{units:u.month,by:1,f:"MMMM yyyy"},minor:{units:u.week,by:1,f:function(t){var n=a.add(t,u.day,6);return e(t,"d - ")+e(n,"d")}}},{max:3e7,major:{units:u.month,by:3,f:"Q  yyyy"},minor:{units:u.month,by:1,f:"MMMM"}},{max:75e6,major:{units:u.month,by:3,f:"Q  yyyy"},minor:{units:u.month,by:1,f:"MMM"}},{max:1e8,major:{units:u.month,by:3,f:"Q  yyyy"},minor:{units:u.month,by:1,f:"MMMMM"}},{max:2e8,major:{units:u.month,by:6,f:"QQ  yyyy"},minor:{units:u.month,by:1,f:"MMMMM"}},{max:36e7,major:{units:u.year,by:1,f:"yyyy"},minor:{units:u.month,by:3,f:"Q"}},{max:6e8,major:{units:u.year,by:1,f:"yyyy"},minor:{units:u.month,by:6,f:"QQ"}},{max:15e8,major:{units:u.year,by:10,f:"yyyy"},minor:{units:u.year,by:1,f:"'yy"}},{max:25e8,major:{units:u.year,by:10,f:"yyyy"},minor:{units:u.year,by:2,f:"'yy"}},{max:75e8,major:{units:u.year,by:10,f:"yyyy"},minor:{units:u.year,by:5,f:"'yy"}},{max:15e9,major:{units:u.year,by:50,f:"yyyy"},minor:{units:u.year,by:10,f:"'yy"}},{max:25e9,major:{units:u.year,by:50,f:"yyyy"},minor:{units:u.year,by:25,f:"'yy"}},{max:35e9,major:{units:u.year,by:100,f:"yyyy"},minor:{units:u.year,by:25,f:"'yy"}},{max:8e10,major:{units:u.year,by:100,f:"yyyy"},minor:{units:u.year,by:50,f:"'yy"}},{max:16e10,major:{units:u.year,by:200,f:"yyyy"},minor:{units:u.year,by:100,f:""}},{max:4e11,major:{units:u.year,by:500,f:"yyyy"},minor:{units:u.year,by:100,f:""}},{max:1/0,major:{units:u.year,by:500,f:""},minor:{units:u.year,by:100,f:""}}]};return c}}(),!function(){var e=KeyLines.Layouts=KeyLines.Layouts||{};e.createLens=function(t){function n(e,t){function n(e,t,n,r,i){return{isLeaf:!0,children:[],points:[],x1:e,y1:t,x2:n,y2:r,depth:i}}function r(e){return e.depth>=t}function i(e,t){var r,i,a,o,u=.5*(e.x1+e.x2),s=.5*(e.y1+e.y2);0===t||1===t?(a=e.y1,o=s):(a=s,o=e.y2),0===t||2===t?(r=e.x1,i=u):(r=u,i=e.x2),e.isLeaf=!1,e.children[t]=n(r,a,i,o,e.depth+1)}function a(e,t){var n;for(t(e),n=0;4>n;n++)e.children[n]&&a(e.children[n],t)}function o(e,t){if(t.x<e.x1||t.y<e.y1||t.x>e.x2||t.y>e.y2)throw new Error("Error: the point is out of range.");if(r(e))e.points.push(t);else{e.points.push(t);var n,a=.5*(e.x1+e.x2),u=.5*(e.y1+e.y2);t.x<a&&t.y<u&&(n=0),t.x>=a&&t.y<u&&(n=1),t.x<a&&t.y>=u&&(n=2),t.x>=a&&t.y>=u&&(n=3),e.children[n]||i(e,n),o(e.children[n],t)}}var u,s=[],c=[];for(u=0;u<e.length;u++)s.push(e[u].x),c.push(e[u].y);var l=Math.min.apply(0,s),f=Math.max.apply(0,s),d=Math.min.apply(0,c),h=Math.max.apply(0,c),v=f-l,g=h-d;v>g?h=d+v:f=l+g;var m=n(l,d,f,h,0);for(m.addPoint=function(e){o(m,e)},m.visit=function(e){a(m,e)},u=0;u<e.length;u++)m.addPoint(e[u]);return m}function r(){function e(e){function t(t){if(t.isLeaf){var i=e.x-.5*(t.x1+t.x2),a=e.y-.5*(t.y1+t.y2),o=Math.sqrt(i*i+a*a),u=(t.x2-t.x1)/o,s=t.points;if(u>E){var c;for(c=0;c<s.length;c++)if(e.id!==s[c].id){var l=e.x-s[c].x,f=e.y-s[c].y,d=Math.max(.001,Math.sqrt(l*l+f*f));n+=l/d,r+=f/d}}else n+=s.length*i/o,r+=s.length*a/o}}var n=0,r=0;i.visit(t),k.push(n),L.push(r)}var t,r=[];for(t in T)r.push({id:t,x:C[x[t]],y:I[x[t]]});var i=n(r,O);k.length=0,L.length=0,p.iterator(r,e),l(k),l(L)}function i(e,t,n){var r,i=t,a=s(e,u(c(t,n),-1)),l=p.clone(a),f=o(a,a);for(r=0;20>r&&f/h>.01;r++){var d=c(l,n),v=f/o(d,l);i=s(i,u(l,v));var g=s(a,u(d,-v)),m=o(g,g)/f;a=g,f=o(a,a),l=s(g,u(l,m))}return i}function a(){var e;for(M.length=0,b.length=0,e=0;h>e;e++){M[e]=[],b[e]={},b[e][e]=!0;for(var t=0;h>t;t++)M[e][t]=0}for(e=0;e<S.length;e++){var n=x[S[e].id1],r=x[S[e].id2];b[n][r]=!0,b[r][n]=!0,M[n][r]-=1,M[r][n]-=1,M[n][n]+=1,M[r][r]+=1}}function o(e,t){var n,r=0;for(n=0;n<e.length;n++)r+=e[n]*t[n];return r}function u(e,t){var n,r=[];for(n=0;n<e.length;n++)r[n]=t*e[n];return r}function s(e,t){var n,r=[];for(n=0;n<e.length;n++)r[n]=e[n]+t[n];return r}function c(e,t){var n,r,i=[];for(n=0;h>n;n++){var a=0;for(r in b[n])a+=M[n][r]*e[r];i.push(a)}i=u(i,t);var a=0;for(n=0;h>n;n++)a+=e[n];var o=[];for(n=0;h>n;n++)o.push(h*e[n]-a);return s(i,o)}function l(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t];for(n/=e.length,t=0;t<e.length;t++)e[t]-=n}function f(e,t,n){var a;for(a=0;t>a;a++)D+=1/(v+g+1),e.trigger("progress","layout",D),r(C,I),C=i(k,C,n),I=i(L,I,n),l(C),l(I)}function d(e){var n,r=0,i=0;for(n in T)T[n].hasOwnProperty("size")?(r+=T[n].size*T[n].size,i+=T[n].size*T[n].size):(r+=1,i+=1);r=Math.sqrt(r/h),i/=h;var a=i/(r*r)-1;w=100*Math.sqrt(h)*(r/60),40>h&&(w=1.5*w),w*=1+a,y=h/50,m=500*y,v=8,g=8;var o=t(e.tightness);o=2*(o-8),y*=Math.exp(o)}var h,v,g,m,y,p=KeyLines.Util,x={},w=500,M=[],b=[],k=[],L=[],T={},S=[],C=[],I=[],O=3,E=.5,D=0;e.lens=function(e,t,n,r,i){D=0,e.trigger("progress","layout",0);var o;T=t.v,S=t.e,h=t.vcount;var u=t.extents,s=[];if(2>h)return r(e,T,u,s,n,i);d(n),C.length=0,I.length=0;var c=0;for(o in T)C.push(w*Math.random()),I.push(w*Math.random()),x[o]=c,c++;a(),f(e,v,m),f(e,g,y);for(o in T)T[o].x=w*C[x[o]],T[o].y=w*I[x[o]];r(e,T,u,s,n,i)}}}(),!function(){var e=KeyLines.Events={};e.createEventBus=function(){function e(e,t){var n=(new Date).toString()+" Function bound to '"+e+"' threw error: "+t.toString();"undefined"!=typeof console&&console.log(n),a.push(n),a.length>i&&a.shift()}function t(e,t,n,r,i,a){function o(e){return((f*e+l)*e+c)*e}function u(e,t){var n=s(e,t);return((v*n+h)*n+d)*n}function s(e,t){var n,r,i,a,u,s;for(i=e,s=0;8>s;s++){if(a=o(i)-e,Math.abs(a)<t)return i;if(u=(3*f*i+2*l)*i+c,Math.abs(u)<1e-6)break;i-=a/u}if(n=0,r=1,i=e,n>i)return n;if(i>r)return r;for(;r>n;){if(a=o(i),Math.abs(a-e)<t)return i;e>a?n=i:r=i,i=(r-n)/2+n}return i}var c=3*t,l=3*(r-t)-c,f=1-c-l,d=3*n,h=3*(i-n)-d,v=1-d-h;return u(e,1/(200*a))}var n,r={};r.bind=function(e,t,r){n=n||{},n[e]=n[e]||[],n[e].push([t,r])},r.unbind=function(e,t){if(n)if(e)if(t){if(n[e]){for(var r=[],i=0;i<n[e].length;i++)t!==n[e][i][0]&&r.push(n[e][i]);n[e]=r}}else n[e]=[];else n={}},r.trigger=function(t){var r=!1;if(n)for(var i,a=2;a--;){var o=a?t:"all",u=[],s=a?1:0;for(i=s;i<arguments.length;i++)u.push(arguments[i]);if(n[o])for(i=0;i<n[o].length;i++){var c=n[o][i];try{r=c[0].apply(c[1]||this,u)||r}catch(l){e(t,l)}}}return r},r.getErrors=function(){return a};var i=10,a=[];r.linearEasing=function(e){return 0>e?0:e>1?1:e},r.cubicEasing=function(e){return 0>e?0:e>1?1:t(e,.25,.01,.25,1,1)};var o=1;return r.atanEasing=function(e){return Math.atan(o*(e-.5))/(2*Math.atan(.5*o))+.5},r}}(),!function(){var e=KeyLines.Graph={};e.create=function(e){function t(e){if(e.direction=e.direction||"any",!/^(any|from|to)$/.test(e.direction))throw new TypeError("opts direction property should be either 'from', 'to' or 'any'")}function n(e){if(e.normalization=e.normalization||"any",!/^(chart|component|unnormalized)$/.test(e.normalization))throw new TypeError("opts normalization property should be either 'component', 'chart' or 'unnormalized'")}function r(e){return y(e,function(t,n,r,i){if(E(r,i,n,e)<=0)throw new Error("Link Weight must be Positive")}),{direction:e.direction,value:e.value,weights:u(e)}}function i(e){return/^(component|chart)$/.test(e.normalization)?e.normalization:"unnormalized"}function a(e){return t(e)||r(e)}function o(e){e.all=!!e.all}function u(e){return!!e.weights}function s(e){var t=0;return p(e,function(){t++}),t}var c=KeyLines.Util,l={},f={},d={},h=e;l.privateSetProperties=function(e,t){f=e,d=t};var v={},g=[],m={},y=function(e,t){var n=e&&e.all;for(var r in d){r=c.rawId(r);var i=d[r];(n||!i.hi)&&t(i,r,i.id1,i.id2)}},p=function(e,t){var n=e&&e.all;for(var r in f){r=c.rawId(r);var i=f[r];(n||!i.hi)&&t(i,r)}},x=function(e,t,n,r){function i(){var t=[];return p(e,function(e){t.push(e)}),t}var a=i(),o=a.length,u=-1,s=(new Date).getTime(),c=s,l=700,f=function(){return u++,u>=o?(d(1),r(),void 0):(n(a[u],g),void 0)},d=function(e){h&&h.trigger("progress",t,e)},v=function(){return s=(new Date).getTime(),s-c>l?(c=(new Date).getTime(),!0):!1},g=function(){v()?(d(u/o),setTimeout(f,0)):f()};d(0),g()},w=function(e,t){return t>e?e:t},M=function(e,t){return t>e?t:e},b=l.sortedAdjacency=function(e){var t={};return y(e,function(e,n,r,i){var a=w(r,i),o=M(r,i);t[a]||(t[a]={}),t[a][o]||(t[a][o]=[]),t[a][o].push(e.id)}),{adj:t,find:function(e,n){var r=w(e,n),i=M(e,n);return t[r]?t[r][i]:void 0}}},k=l.connections=function(e){var t=[],n=b(e).adj;for(var r in n){r=c.rawId(r);for(var i in n[r])i=c.rawId(i),t.push(n[r][i])}return t};l.eigenCentrality=function(e){function t(t){function n(e,t){var n=1;return t.value&&e.d&&(n=Number(e.d[t.value])),n}function r(e){var t,n,r=[];for(t=0;t<c.length;t++){for(var i=0,n=0;n<l[t].length;n++)i+=f[t][l[t][n]]*e[l[t][n]];i+=d*e[t],r.push(i)}return r}function i(){var e,t=1/a(h);for(e=0;e<c.length;e++)h[e]=h[e]*t}function a(e){var t,n=0;for(t=0;t<e.length;t++)n+=Math.abs(e[t]);return n}var o,u,s={},c=[],l=[],f=[],d=0,h=[],v=0;if(p(e,function(e,n){t[n]&&(c.push(n),s[n]=c.length-1,l.push([]),f.push({}))}),u=Math.max(100,5*Math.sqrt(c.length)),y(e,function(r,i,a,o){if(t[a]&&t[o]){var u=s[a],c=s[o];f[u][c]||(l[u].push(c),l[c].push(u),f[c][u]=0,f[u][c]=0);var h=n(r,e);f[u][c]+=h,f[c][u]+=h,d+=h,v++}}),0===c.length)return{};if(1===c.length)return h={},h[c[0]]=1,h;if(2===c.length)return h={},h[c[0]]=.5,h[c[1]]=.5,h;for(d/=v,u=Math.max(100,5*Math.sqrt(c.length)),o=0;o<c.length;o++)h.push(Math.random());for(o=0;u>o;o++)h=r(h),0===o%10&&i();i();var g={};for(o=0;o<c.length;o++)g[c[o]]=h[o];return g}e=c.defaults(e,{all:!1,value:void 0}),e.direction="any",o(e),r(e);var n,i,a={},u=L(e);for(n=0;n<u.length;n++){var s={};for(i=0;i<u[n].nodes.length;i++)s[u[n].nodes[i]]=!0;var l=t(s);for(i in l)a[i]=l[i]*u[n].nodes.length}return a},l.pageRank=function(e){function t(e,t){var n=1;return t.value&&e.d&&(n=Number(e.d[t.value])),n}function n(e){var t,n,r=[],i=0,a=0;for(t=0;t<l.length;t++)i+=e[t];for(t=0;t<l.length;t++){var o=0;for(n=0;n<f[t].length;n++){var u=f[t][n];o+=d[t][u]*e[u]/v[u]}0===v[t]&&(a+=m*e[t]),o=m*o,o+=(1-m)*i/l.length,r.push(o)}for(a/=l.length,t=0;t<g.length;t++)r[t]+=a;return r}function r(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t];return n}var i;e=c.defaults(e,{all:!1,value:void 0,directed:!0}),o(e),a(e);var u,s={},l=[],f=[],d=[],h=0,v=[],g=[],m=.85;for(p(e,function(e){l.push(e.id),s[e.id]=l.length-1,f.push([]),d.push({}),v.push(0)}),u=Math.max(100,5*Math.sqrt(l.length)),y(e,function(n,r,i,a){var o=s[i],u=s[a],c=t(n,e);(!e.directed||n.a2||!n.a1&&!n.a2)&&(d[u][o]||(d[u][o]=0,f[u].push(o)),d[u][o]+=c,v[o]+=c),(!e.directed||n.a1||!n.a1&&!n.a2)&&(d[o][u]||(d[o][u]=0,f[o].push(u)),d[o][u]+=c,v[u]+=c),h++}),i=0;i<l.length;i++)g.push(Math.random());var x=1/r(g);for(i=0;i<l.length;i++)g[i]=g[i]*x;for(i=0;u>i;i++)g=n(g);for(x=1/r(g),i=0;i<l.length;i++)g[i]=g[i]*x;var w={};for(i=0;i<l.length;i++)w[l[i]]=g[i];return w},l.neighbours=function(e,t){var n=[],r={},i=c.makeIdMap(e);t=c.defaults(t,{all:!1,direction:"any"}),o(t);for(var a in i)if(a=c.rawId(a),!f[a]&&!d[a])throw new Error("neighbours error: ids must be present in the graph");return y(t,function(e,a,o,u){i[o]&&O(o,u,a,t)&&(n.push(a),r[u]=1),i[u]&&O(u,o,a,t)&&(n.push(a),r[o]=1),i[a]&&(O(u,o,a,t)&&(r[u]=1),O(o,u,a,t)&&(r[o]=1))}),{nodes:c.flattenMap(r),links:n}},l.clusters=function(e){function t(e,t){var n=1;return t.value&&e.d&&(n=Number(e.d[t.value])),n}function n(e){d=Number(e),d=isNaN(d)?5:d,d=Math.max(0,d),d=Math.min(10,d),d=d*d*d/125}function r(){var e,t,n=[];for(e=0;e<S.length;e++){var r=[];for(t=0;t<M[S[e]].length;t++)r.push(m[M[S[e]][t]]);n.push(r)}return n}function i(e,t,n){var r,i=k[t],a=k[e],o=h[n],u=(-o+i-a)*o*d;for(u/=2*w,r=0;r<v[n].length;r++){var s=v[n][r];b[s]===t?u-=g[n][s]:b[s]===e&&(u+=g[n][s])}return u/w}function a(e,t){var n,r;if(t!==e&&0!==M[e].length&&0!==M[t].length){var i=k[e],a=k[t],o=0;for(o-=d*i*a/w,n=0;n<M[e].length;n++){var s=M[e][n];for(r=0;r<v[s].length;r++)b[v[s][r]]===t&&(o+=g[s][v[s][r]])}if(o/=w,o>0){var c=M[e].length;for(n=0;c>n;n++)u(M[e][0],t)}}}function u(e,t){var n,r=b[e];b[e]=t;var i=[];for(n=0;n<M[r].length;n++)M[r][n]!==e&&i.push(M[r][n]);0===M[t].length&&(S.push(t),L.splice(c.indexOf(L,t),1)),M[r]=i,M[t].push(e),k[t]+=h[e],k[r]-=h[e],0===M[r].length&&(L.push(r),S.splice(c.indexOf(S,r),1))}function s(e){var t,n=M[e].length;if(1!==n&&L.length){var r=[];for(t=0;n>t;t++)r.push(M[e][t]);for(t=0;n>t&&L.length;t++)u(r[t],L[0])}}var l;e=c.defaults(e,{all:!1,factor:5}),o(e),T(e);var f,d,h=[],v=[],g=[],m=[],x={},w=0,M=[],b=[],k=[],L=[],S=[];if(p(e,function(e){m.push(e.id),v.push([]),g.push([]),x[e.id]=m.length-1,M.push([m.length-1]),b.push(m.length-1),S.push(m.length-1),h.push(0),k.push(0)}),y(e,function(n,r,i,a){var o=t(n,e);w+=o;var u=x[i],s=x[a];g[u][s]||(g[u][s]=0,g[s][u]=0),g[u][s]+=o,g[s][u]+=o,h[u]+=o,h[s]+=o,k[u]+=o,k[s]+=o,v[u].push(s),v[s].push(u)}),f=Math.max(1e4,50*m.length),0===m.length)return[];for(0===w&&(f=0),n(e.factor),l=0;f>l;l++){if(Math.random()>.95){var C=S[Math.floor(Math.random()*S.length)],I=S[Math.floor(Math.random()*S.length)];a(C,I)}if(.5*f>l&&Math.random()>.98){var O=S[Math.floor(Math.random()*S.length)];s(O)}var E=Math.floor(m.length*Math.random()),D=v[E][Math.floor(Math.random()*v[E].length)],P=b[D],z=b[E];if(P!==z){var A=i(P,z,E);A>=0&&u(E,P)}}return r()};var L=l.components=function(e){var t,n,r=[],i=0,a=[];e=c.defaults(e,{all:!1}),o(e),T(e);for(t in v)if(!v[t].hasOwnProperty("c")){for(r.push(t+"");r.length>0;){var u=r.shift();if(!v[u].hasOwnProperty("c"))for(v[u].c=i,n=0;n<g.length;n++)g[n].hasOwnProperty("c")||(g[n].id1===u?(g[n].c=i,r.push(g[n].id2)):g[n].id2===u&&(g[n].c=i,r.push(g[n].id1)))}a.push({nodes:[],links:[]}),i++}for(t in v)a[v[t].c].nodes.push(t+"");for(n=0;n<g.length;n++)a[g[n].c].links=a[g[n].c].links.concat(g[n].ids);return a},T=l.reset=function(e){var t,n=k(e),r=0;v={},g=[],p(e,function(e,t){r++,v[t]={x:e.x,y:e.y},m[t]={}});for(var i=0;i<n.length;i++)t=d[n[i][0]],g.push({id:t.id,id1:t.id1,id2:t.id2,ids:n[i]}),t.id1!==t.id2&&(m[t.id1][t.id2]=m[t.id2][t.id1]=n[i])},S=l.distances=function(e,t){if(!f[e])throw new Error("distances error: id(s) must be present in the graph");t=t||{},a(t),o(t);var n=z(e,t),r={};for(var i in n.distance){var u=n.distance[i];isFinite(u)&&(r[i]=u)}return r},C=function(e,t,n){var r,i=m[e][t],a=1/0,o=D(n);if(i)for(var u=0;u<i.length;u++){var s=o(e,t,i[u],n);isNaN(s)||(a>s&&(r=[],a=s),s===a&&1/0!==a&&r.push(i[u]))}return{value:a,links:r}},I=function(e,t){return d[e].a2&&d[e].id2===t||d[e].a1&&d[e].id1===t},O=function(e,t,n,r){return"any"!==r.direction?"from"===r.direction&&I(n,t)||"to"===r.direction&&I(n,e):!0},E=function(e,t,n,r){var i=0/0;return O(e,t,n,r)&&(r.value?d[n].d&&(i=Number(d[n].d[r.value])):i=1),i},D=function(e){return u(e)?P:E},P=function(e,t,n,r){var i=E(e,t,n,r);return isNaN(i)?i:1/i},z=function(e,t){function n(){for(var e,t=1/0,n=0;n<o.length;n++){var r=i[o[n]];t>=r&&(e=n,t=r)}return e}function r(e,t,n){a[e]||(a[e]=[]),a[e].push({id:t,links:n})}var i={},a={},o=[];for(T(t),p(t,function(e,t){i[t]=1/0,a[t]=void 0,o.push(t)}),i[e]=0;o.length>0;){var u=n(),s=o[u];if(1/0===i[s])break;o.splice(u,1);for(var l in m[s]){l=c.rawId(l);var f=C(s,l,t),d=i[s]+f.value;d<i[l]?(i[l]=d,a[l]=[{id:s,links:f.links}]):d===i[l]&&r(l,s,f.links)}}return{distance:i,previous:a}};l.shortestPaths=function(e,t,n){function r(e){for(var t=[],n=0;n<e.length;n++)u[e[n].id]&&(t=t.concat(u[e[n].id]));return t}if(!f[e]||!f[t])throw new Error("shortestPaths error: ids must be present in the graph");n=c.defaults(n,{all:!1}),a(n),o(n);var i=z(e,n),u=i.previous;if(1/0===i.distance[t])return{onePath:[],one:[],items:[],distance:1/0};for(var s=[],l=[],d=t;u[d];)s.unshift(d),l.unshift(d),l.unshift(u[d][0].links[0]),d=u[d][0].id;s.unshift(d),l.unshift(d);var h={};h[t]=1;var v=[];v.push({id:t});for(var g=r(v);g.length>0;){for(var m=0;m<g.length;m++){h[g[m].id]=1;for(var y=0;y<g[m].links.length;y++)h[g[m].links[y]]=1}g=r(g)}return{onePath:l,one:s,items:c.flattenMap(h),distance:i.distance[t]}};var A=l.degrees=function(e){e=c.defaults(e,{multi:!0,all:!1}),a(e),o(e),T(e);var t={};return p(e,function(n,r){t[r]=0;for(var i in m[r]){i=c.rawId(i);for(var a=0;a<m[r][i].length;a++){var o=E(r,i,m[r][i][a],e);if(!isNaN(o)&&(t[r]+=o,!e.multi))break}}}),t};return l.betweenness=function(e,t){function r(e,t){return R[e]-R[t]}function s(e){return e.sort(r),e.shift()}function l(e,t){e.sort(r),c.contains(e,t)||e.push(t)}function f(e,t){var n=C(e,t,O).value;return isFinite(n)?n:M()||isFinite(n)?1/0:1}function d(e){return e.length>0}function h(){A.length=0,B.length=0,p(e,function(e,t){for(var n=0;n<Y.length;n++)g(Y[n].dict,t,Y[n].value)})}function v(e,t,n){p(e,function(e,r){g(t,r,n)})}function g(e,t,n){c.isArray(n)&&d(n)&&e[t]?e[t].length=0:e[t]=c.clone(n)}function y(){var t,n,r,i=L(e),a={};for(t=0;t<i.length;t++)for(r=i[t],n=0;n<r.nodes.length;n++)a[r.nodes[n]]=r.nodes.length;return a}function w(){return!c.isNullOrUndefined(e.value)}function M(){return!!e.directed}function b(){return e.endpoints}e=c.defaults(e,{value:void 0,directed:!1,normalization:"component",endpoints:!1,weights:!1,all:!1}),n(e),o(e);var k=w()||M()?"dijkstra":"regular",S=b()?"endpoints":"regular",I=i(e),O={direction:M()?"from":"any",value:e.value,weights:u(e),all:e.all};a(e);var E,D,P,z={},A=[],B=[],U={},N={},K={},R={};e.normalization;var F,_,H,j=0,Y=[{dict:N,value:0},{dict:R,value:1/0},{dict:U,value:[]},{dict:K,value:0}],G={regular:function(e){for(N[e]=1,R[e]=0,A.push(e);d(A);){E=A.shift(),B.push(E);for(var t in m[E])t=c.rawId(t),isFinite(R[t])||(R[t]=R[E]+1,A.push(t)),R[t]===R[E]+1&&(N[t]+=N[E],U[t].push(E))}},dijkstra:function(e){for(N[e]=1,R[e]=0,A.push(e);d(A);){E=s(A),B.push(E);for(var t in m[E])t=c.rawId(t),R[t]>R[E]+f(E,t)&&(R[t]=R[E]+f(E,t),l(A,t),N[t]=0,U[t]=[]),R[t]===R[E]+f(E,t)&&(N[t]+=N[E],U[t].push(E))}}},W={regular:function(e){for(;d(B);){for(D=B.pop(),_=(1+K[D])/N[D],F=0;F<U[D].length;F++)E=U[D][F],K[E]+=N[E]*_;D!==e&&(z[D]+=K[D])}},endpoints:function(e){for(z[e]+=B.length-1;d(B);){for(D=B.pop(),_=(1+K[D])/N[D],F=0;F<U[D].length;F++)E=U[D][F],K[E]+=N[E]*_;D!==e&&(z[D]+=K[D]+1)}}},q={chart:function(){if(j>2){P=1/((j-1)*(j-2));for(var e in z)e=c.rawId(e),z[e]*=P}},component:function(){H=y();for(var e in z)e=c.rawId(e),H[e]>2&&(P=1/((H[e]-1)*(H[e]-2)),z[e]*=P)},unnormalized:function(){if(!M()){P=.5;for(var e in z)e=c.rawId(e),z[e]*=P}}},Z=function(){$(),c.invoke(t,z)},V=G[k]||G.regular,X=W[S]||W.regular,$=q[I]||q.chart;T(e),p(e,function(){j++}),v(e,z,0);var Q=function(e,t){h(),V(e.id),X(e.id),t()};x(e,"betweenness",Q,Z)},l.closeness=function(e,t){function r(e,t){var n=0;for(var r in t)r=c.rawId(r),n+=isFinite(t[r])?1:0;return n}function u(e){for(var t in e)if(t=c.rawId(t),e.hasOwnProperty(t))return!1;return!0}function l(e){return!c.isNullOrUndefined(e)}function f(e){return!d[e].a1&&!d[e].a2}function h(e){var t={},n=0,r={},i={};for(i[e]=1;!u(i);){r=i,i={};for(var a in r)if(a=c.rawId(a),!l(t[a])){t[a]=n;for(var o in m[a])o=c.rawId(o),i[o]=1}n+=1}return t}function v(){return"any"!==e.direction}function g(){if(e.mode=e.mode||"auto",!e.mode.match(/^(connected|disconnected|auto)$/))throw new TypeError("Option mode property should be either 'connected', 'disconnected' or 'auto'")}function y(){return g(),"auto"===e.mode?b():e.mode}function p(){return!c.isNullOrUndefined(e.value)}function w(){return i(e).match(/chart/)}function M(){return i(e).match(/component/)}function b(){var t="disconnected",n=L(e);if(1===n.length&&(t="connected",v()))for(var r=0;r<n[0].links.length;r++)if(f(n[0].links[r]))return"disconnected";return t}e=c.defaults(e,{direction:"any",value:void 0,normalization:"component",mode:"auto",weights:!1,all:!1});var k=a(e);n(e),o(e),k.all=e.all;var C,I,O,E,D,P=p()||v()?"dijkstra":"regular",z=0,A={},B=y(),U={regular:function(e){return h(e)},dijkstra:function(e,t){return S(e,t)}},N={connected:function(e,t){var n=0;for(var r in t)r=c.rawId(r),n+=isFinite(t[r])?t[r]:0;return n?1/n:0},disconnected:function(e,t){var n=0;for(var r in t)r=c.rawId(r),n+=e!==r?1/t[r]:0;return n}},K=function(){c.invoke(t,A)};I=U[P]||U.regular,O=N[B],T(e),z=s(e),A={};var R=function(e,t){E=I(e.id,k),C=r(e.id,E),A[e.id]=O(e.id,E),z>1&&(D=w()?Math.pow(C-1,2)/(z-1):M()?C-1:1,A[e.id]*=D),t()};x(e,"closeness",R,K)},l.kCores=function(e){function t(e){var t=0;for(var n in e)n=c.rawId(n),t=Math.max(t,e[n]);return t}var n=function(){var t,n,r,i,a,o,u,s,l,f,d,h={},v={},g=[],y=[];n=0,h=A({multi:!1,all:e.all});for(var x in h)x=c.rawId(x),n=Math.max(n,h[x]);for(d=c.flattenMap(h).length,t=0;n+1>t;t++)y[t]=0;for(p(e,function(e,t){y[h[t]]++}),a=1,t=0;n+1>t;t++)o=y[t],y[t]=a,a+=o;for(p(e,function(e,t){v[t]=y[h[t]],g[v[t]]=t,y[h[t]]++}),t=n;t>1;t--)y[t]=y[t-1];for(y[0]=1,i=0;d>i;i++){r=g[i];for(var w in m[r])w=c.rawId(w),h[w]>h[r]&&(s=h[w],l=v[w],f=y[s],u=g[f],w!==u&&(v[w]=f,g[l]=u,v[u]=l,g[f]=w),y[s]++,h[w]--)}return h};e=c.defaults(e,{all:!1}),o(e),T(e);var r=n();return{maximumK:t(r),values:r}},l}}(),!function(){var e=KeyLines.Layouts=KeyLines.Layouts||{};e.create=function(){function t(e){var t=J.create();return t.privateSetProperties({},e),t.connections({all:!1})}function n(e,t,n,i,a,o,u,s,c){var l=a[u];if(!(l in n)){if(!(l in i))throw"link has end which is not in nodes list";var f=i[l];if(f.hi)throw"link has end which is hidden";n[l]=r(e,t,f,l,s,c)}return l}function r(e,t,n,r,i,a){return{x:n.x,y:n.y,size:e.nodeSize(n,t,a),fixed:i?r in i:!1,lc:0}}function i(e,t){return e.fixed&&!t.fixed?-1:t.fixed&&!e.fixed?1:0}function a(e,i,a,o,u,s){for(var c=t(o),l={},f=[],d=0;d<c.length;d++){var h=c[d][0],v=o[h],g=n(e,i,l,a,v,h,"id1",u,s),m=n(e,i,l,a,v,h,"id2",u,s);null!==g&&null!==m&&(f.push({id1:g,id2:m,id:h}),l[g].lc+=1,l[m].lc+=1)}var y;for(y in a)if(y+="",!a[y].hi&&!l[y]){var p=r(e,i,a[y],y,u,s);l[y]=p}var x=0;for(y in l)x++;return{v:l,e:f,vcount:x}}function o(e,t){var n,r,i,a,o=0,s=[];for(n in e)if(n+="",!e[n].hasOwnProperty("c")){var c=o++;for(s.push(n+"");s.length>0;){var l=s.shift();if(!e[l].hasOwnProperty("c"))for(e[l].c=c,r=0;r<t.length;r++)i=t[r].id1+"",a=t[r].id2+"",i===l&&(t[r].c=c,s.push(a)),a===l&&(t[r].c=c,s.push(i))}}for(var f=new Array(o),d=0;d<f.length;d++)f[d]={verts:{},edges:[]};for(n in e)n+="",f[e[n].c].verts[n]=e[n];for(r=0;r<t.length;r++)f[t[r].c].edges.push(t[r]);for(var h=0;h<f.length;h++)f[h].extents=u(f[h].verts);return f}function u(e){var t,n,r,i,a=0;for(var o in e){var u=e[o+""];t=t?Math.min(t,u.x-u.size):u.x-u.size,n=n?Math.min(n,u.y-u.size):u.y-u.size,r=r?Math.max(r,u.x+u.size):u.x+u.size,i=i?Math.max(i,u.y+u.size):u.y+u.size,a++}return{x1:t,y1:n,x2:r,y2:i,c:a}}function s(e,t){for(var n,r={},i=0;i<t.length;i++)n=t[i].id+"",r[n]=t[i];for(var a in e)n=a+"",e[n].id=n;var o=J.create();return o.privateSetProperties(e,r),o
}function c(e,t,n){for(var r,i,a,o,u=s(e,t),c=0;c<n.length;c++){var l=u.distances(n[c]);for(var f in l)f+="",e[f].hasOwnProperty("level")||(e[f].level=1/0),e[f].level=Math.min(e[f].level,l[f])}for(var d=0;d<t.length;d++)r=t[d].id1+"",i=t[d].id2+"",a=e[r],o=e[i],a.hasOwnProperty("level")&&o.hasOwnProperty("level")&&(t[d].level=Math.max(a.level,o.level))}function l(e,t){function n(e,t,n,i){r[e]=r[e]||[],r[e][t]=r[e][t]||{},r[e][t][n]=r[e][t][n]||[],r[e][t][n].push(i)}var r={};for(var i in e)i+="",e[i].hasOwnProperty("level")&&n(e[i].c,e[i].level,"vertices",i);for(var a=0;a<t.length;a++)t[a].hasOwnProperty("level")&&n(t[a].c,t[a].level,"edges",t[a]);return r}function f(e,t){for(var n=[],r=0;r<e.length;r++)t[e[r]]&&n.push(e[r]);return n}function d(e){var t=Number(e);return t=isNaN(t)?5:t,t=Math.max(0,t),t=Math.min(10,t)}function h(e){return 10*(5-d(e))}function v(e){var t=26,n=0,r=0;for(var i in e)i+="",e[i].hasOwnProperty("level")&&(t=Math.max(t,e[i].size),n+=e[i].size,r+=1);return n/r}function g(e,t,n,r,i){function a(){var e,t,n,r=0,i=0;for(t in S)for(var a=S[t].length-1;a>=0;a--)for(var o=S[t][a].vertices,s=[],c=0;c<o.length;c++){n=o[c]+"";var l=m(S,y,n);if(y[n].children=[],y[n].subChildrenCount=0,0===l.length)r++;else{var f=[];for(e=0;e<l.length;e++)Q.indexOf(s,l[e])<0&&f.push(l[e]);if(f.length>0)for(y[n].children=f,y[n].subChildrenCount=u(f),e=0;e<f.length;e++)s.push(f[e]),y[f[e]].parent=n}i++}}function u(e){for(var t=0,n=0;n<e.length;n++){var r=y[e[n]].subChildrenCount;t+=0===r?1:r}return t}function s(e,t,n){n||(e.x=t);var r=t-e.subChildrenCount*I/2,i=e.children;if(i)for(var a=0;a<i.length;a++){var o=y[i[a]],u=o.subChildrenCount;0===u&&(u=1);var c=r+u*I;s(o,(c+r)/2,!1),r=c}}function d(e,t){for(var n,r=0;r<S[e].length;r++)for(var i=S[e][r].vertices,a=0;a<i.length;a++){n=i[a]+"";var o=y[n];o.y=t.miny+2*r*(C+12)}}function g(e,t){for(var n,r={up:function(e){e.y=-e.y,e.x=-e.x},down:function(){},right:function(e){var t=e.y;e.y=-e.x,e.x=t},left:function(e){var t=e.y;e.y=e.x,e.x=-t}},i=r[t]||r.down,a=0;a<S[e].length;a++)for(var o=S[e][a].vertices,u=0;u<o.length;u++)n=o[u]+"",i(y[n])}var y=t.v,p=t.e,x=o(y,p),w=t.extents;n=Q.defaults(n,{top:[],orientation:"down",stable:!0});var M=i?1:h(n.tightness);x.length;var L=n.top;L=f(L,y);var T=n.tidy;c(y,p,L);var S=l(y,p),C=v(y),I=2*C+24+M;a();var O,E={},P={};for(O in S){var z=Number(O);E[z]=D(x[z].verts),P[z]={children:S[O][0].vertices,subChildrenCount:u(S[O][0].vertices)}}for(O in S)s(P[O],E[O].x,!0),d(O,E[O]);for(O in S)i||g(O,n.orientation);i&&i(y,S,x,E,C,n.tightness);var A=[];T?b(e,y,x,0,1,w,A,n,r):k(e,y,w,A,n,r)}function m(e,t,n){var r,i,a,o,u=t[n].c,s=t[n].level+1,c=e[u][s],l={},f=[];if(c){for(a=0;a<c.edges.length;a++){var d=c.edges[a];r=d.id1+"",i=d.id2+"",r===n&&(l[i]=1),i===n&&(l[r]=1)}var h=c.vertices;for(o=0;o<h.length;o++)r=h[o]+"",l[r]&&f.push(r)}return f}function y(e,t,n,r,i,a){function o(e,t){return(e.r+t.r)/(e.a-t.a)}function u(e,t,n){var r=t>0?e+n:e+n/2;return r>0?r:e}function s(e,t,n,r){if(r&&1===e.length)return 0;var i=t,a=i;for(c=1;c<e.length;c++)a=Math.max(o(d[e[c]],d[e[c-1]]),a);return u(a,a-i,n)}var c,l,f,d;a=h(a);for(var v in t){var g=D(n[Number(v)].verts),m=0,y=m,p=4*i,x=p,w=2*i+24;for(l=0;l<t[v].length;l++){var M,b=t[v][l].vertices;d=[];var k=Math.min(2,l||1);for(c=0;c<b.length;c++){f=b[c]+"",M=e[f];var L=M.x-g.minx,T=l>0?l:l+1,S=g.maxx-g.minx+k*w/T;if(L*=2*Math.PI/S,0>L||L>2*Math.PI)throw new Error("[Radial] Theta angle should be in the range [0; 2*PI]");d[f]={a:L,r:M.size}}for(y=m,0===l?b.length>1&&(m+=p/2):m+=p,m=s(b,m,a,1>l),m-y>x&&(x=m-y+1,p=Math.max(p,x/2),0===l&&b.length<3&&(m/=2)),c=0;c<b.length;c++)M=e[b[c]+""],M.x=r[Number(v)].x+m*Math.cos(d[M.id].a),M.y=r[Number(v)].y+m*Math.sin(d[M.id].a)}}}function p(e,t){var n=e.extents.c,r=Math.max(e.extents.x2-e.extents.x1,e.extents.y2-e.extents.y1),i=120*Math.sqrt(n),a=Math.max(r,i)/2,o=0;n>1&&(o=Math.min(Math.pow(n,2.5),100));var u=o*n*Math.log(n),s=1/x(t);return{repulsionFactor:40*Math.max(1,Math.pow(s,2)),coeff:1,naturalDistance:20*s,iterations:o,chunk:20,temperature:a,temp:a,estTime:u}}function x(e){var t=d(e.tightness);return Math.pow(2,2*(t-5)/5)}function w(e,t,n,r){function i(t){var n=l[t],r=x[t];C(e,n,r,r.start,r.stop,function(){O(n.verts),t++,t<l.length?setTimeout(function(){i(t)},0):a()})}function a(){h?b(e,u,l,y,1,f,d,n,r):k(e,u,f,d,n,r)}var u=t.v,s=t.vcount,c=t.e,l=o(u,c),f=t.extents,d=n.fixed||[],h=n.tidy;E(u);var v=l.length,g=s/(s+v),m=0,y=h?g:1;e.trigger("progress","layout",0);for(var x=[],w=0,M=0;M<l.length;M++){var L=p(l[M],n);w+=L.estTime,x.push(L)}var T=0;for(M=0;M<l.length;M++){x[M].start=T;var S=T+(y-m)*x[M].estTime/w;x[M].stop=S,T=S}l.length>0?i(0):k(e,u,f,d,n,r)}function M(e){for(var t in e)if(t+="",e[t].fixed)return!0;return!1}function b(e,t,n,r,i,a,o,u,s){for(var c={},l=[],f={},d=1/0,h=1/0,v=0;v<n.length;v++){var g=P(n[v].verts);c[v]=g;var m=o.length>0&&M(n[v].verts);l.push({x:g.x,y:g.y,width:g.width,height:g.height,id:v,fixed:m}),f[v]={x:g.x,y:g.y},d=Math.min(d,f[v].x),h=Math.min(h,f[v].y)}u=Q.defaults(u,{strategy:"rect",ratio:4/3});var y=tt(l,{strategy:u.strategy,step:30,max:2,sort:!1,ratio:u.ratio,tightness:u.tightness}).comps;d="rect"===u.strategy?d:0,h="rect"===u.strategy?h:0;for(var p={},x=0;x<y.length;x++)p[y[x].id]=y[x],p[y[x].id].x+=d,p[y[x].id].y+=h;for(var w in t){var b=t[w+""],L=p[b.c].x-f[b.c].x,T=p[b.c].y-f[b.c].y;b.x+=L,b.y+=T}k(e,t,a,o,u,s)}function k(e,t,n,r,i,a){var o=u(t);0===r.length&&(o=I(t,n,o)),isNaN(o.x1)&&(o=null),e.trigger("progress","layout",1),a({vertices:t,extents:o},i)}function L(e,t,n){var r=e[t.id1],i=e[t.id2];if(!r.fixed||!i.fixed){var a=2*Math.random()*Math.PI,o=(r.x+i.x)/2,u=(r.y+i.y)/2,s=1.3*z(r,i,n)/2;r.x=o+s*Math.cos(a),r.y=u+s*Math.sin(a),a+=Math.PI,i.x=o+s*Math.cos(a),i.y=u+s*Math.sin(a)}}function T(e,t,n,r){var i={temperature:10,i:0},a={verts:t.v,edges:t.e},o=p(t,{tightness:5});o.chunk=o.iterations=5,i.temperature=Math.pow(o.temperature,.72),S(i,a,o);var s=u(a.verts);isNaN(s.x1)&&(s=null),e.trigger("progress","layout",1),r({vertices:a.verts,extents:s},n,!1)}function S(e,t,n){for(var r=Math.min(e.i+n.chunk,n.iterations);e.i<r;){var i=t.verts,a=t.edges,o=0;for(var u in i)u+="",i[u].dx=i[u].dy=0,o++;if(1===o)return e.i=r,void 0;if(2===o)return L(i,a[0],n.naturalDistance),e.i=r,void 0;U(i,n.repulsionFactor);for(var s=0;s<a.length;s++)A(a[s],i,n.naturalDistance,n.coeff);var c=e.temperature*(1-e.i/n.iterations);for(var l in i)l+="",B(i[l],c);e.i++}}function C(e,t,n,r,i,a){function o(){return r+(i-r)*l.i/n.iterations}function u(){return l.i>=n.iterations}function s(){S(l,t,n)}function c(){s(),u()?a():(e.trigger("progress","layout",o()),setTimeout(c,0))}var l={i:0,temperature:n.temperature};c()}function I(e,t,n){var r=(n.x1+n.x2)/2-(t.x1+t.x2)/2,i=(n.y1+n.y2)/2-(t.y1+t.y2)/2;for(var a in e)a+="",e[a].x-=r,e[a].y-=i;return{x1:n.x1-r,y1:n.y1-i,x2:n.x2-r,y2:n.y2-i}}function O(e){var t,n,r,i,a=0,o=0,u=0,s=!1,c=0,l=0;for(i in e)i+="",a+=e[i].x,o+=e[i].y,u+=1,s|=e[i].fixed;if(!(3>u||s)){a/=u,o/=u;for(i in e)i+="",t=Math.sqrt((e[i].x-a)*(e[i].x-a)+(e[i].y-o)*(e[i].y-o)),t>l&&(l=t,c=Math.atan2(e[i].y-o,e[i].x-a));c=-c;for(i in e)n=a+(e[i].x-a)*Math.cos(c)-(e[i].y-o)*Math.sin(c),r=o+(e[i].x-a)*Math.sin(c)+(e[i].y-o)*Math.cos(c),e[i].x=n,e[i].y=r}}function E(e){var t=30;for(var n in e)n+="",e[n].fixed||(e[n].x+=t*(Math.random()-.5),e[n].y+=t*(Math.random()-.5))}function D(e){var t,n=0,r=0,i=0,a=1/0,o=1/0,u=-1/0,s=-1/0;for(t in e)t+="",n+=1,r+=e[t].x,i+=e[t].y,o=Math.min(o,e[t].x),a=Math.min(a,e[t].y),u=Math.max(u,e[t].x),s=Math.max(s,e[t].y);r/=n,i/=n;var c=0,l=!1;for(t in e){t+="";var f=e[t].x-r,d=e[t].y-i,h=Math.sqrt(f*f+d*d);c=Math.max(h+1.5*e[t].size,c),l=l||e[t].fixed}return{x:r,y:i,sum:n,size:c,fixed:l,miny:a,minx:o,maxy:s,maxx:u}}function P(e,t){Q.isNullOrUndefined(t)&&(t={});var n,r=20,i=1/0,a=1/0,o=-1/0,u=-1/0;for(n in e)n+="",n in t||(a=Math.min(a,e[n].x-e[n].size),i=Math.min(i,e[n].y-e[n].size),o=Math.max(o,e[n].x+e[n].size),u=Math.max(u,e[n].y+e[n].size));return a-=r,i-=r,o+=r,u+=r,{x:a,y:i,width:o-a,height:u-i}}function z(e,t,n){return e.size+t.size+n*(1+((e.lc?e.lc:1)+(t.lc?t.lc:1))/6)}function A(e,t,n,r){var i=t[e.id1],a=t[e.id2],o=i.x-a.x,u=i.y-a.y,s=z(i,a,n),c=Q.len(o,u);if(c>.02){var l=r*(c-s)/c,f=o*l,d=u*l;i.dx-=f,i.dy-=d,a.dx+=f,a.dy+=d}}function B(e,t){if(!e.fixed){var n=Q.len(e.dx,e.dy),r=e.dx/n*Math.min(n,t),i=e.dy/n*Math.min(n,t);e.x+=r,e.y+=i}}function U(e,t){function n(e,t,n,r){return{leaf:!0,nodes:{},point:null,x1:e,y1:t,x2:n,y2:r}}function r(e,t){var r=e.x1,a=e.y1,o=e.x2,u=e.y2,s=.5*(r+o),c=.5*(a+u),l=t.x>=s,f=t.y>=c,d=(f<<1)+l;e.leaf=!1,l?r=s:o=s,f?a=c:u=c,e=e.nodes[d]||(e.nodes[d]=n(r,a,o,u)),i(e,t)}function i(e,t){if(e.leaf){var n=e.point;n?Math.abs(n.x-t.x)+Math.abs(n.y-t.y)<.01?r(e,t):(e.point=null,r(e,n),r(e,t)):e.point=t}else r(e,t)}function a(e,t){if(!e(t))for(var n=t.nodes,r=0;4>r;r++)n[r]&&a(e,n[r])}function o(e){var t=0,n=0;if(e.charge=0,e.size=0,!e.leaf)for(var r=e.nodes,i=0;4>i;i++){var a=r[i];a&&(o(a),e.charge+=a.charge,e.size+=a.size,t+=a.charge*a.cx,n+=a.charge*a.cy)}if(e.point){var u=c(e.point);e.charge+=e.pointCharge=u,e.size+=e.point.size,t+=u*e.point.x,n+=u*e.point.y}e.cx=e.charge?t/e.charge:0,e.cy=e.charge?n/e.charge:0}function u(e){if(e.point!==x){var t=e.cx-x.x,n=e.cy-x.y,r=1/Q.len(t,n);if((e.x2-e.x1)*r<w)return s(x,e,e.charge,r,t,n),b++,!0;e.point&&(s(x,e.point,e.pointCharge,r,t,n),M++)}return!e.charge}function s(e,t,n,r,i,a){r>k&&(r=k),l(e,n,i,a,r)}function c(e){return e.size*(1+(e.lc?e.lc:1)/3)}function l(e,n,r,i,a){if(!(.001>a)){var o=t*c(e)*n*a*a*a;e.dx-=r*o,e.dy-=i*o}}function f(){for(var t in e)t+="",x=e[t],a(u,L)}var d,h,v,g,m=D(e);d=m.minx,v=m.miny,h=m.maxx,g=m.maxy;var y=h-d,p=g-v;y>p?g=v+y:h=d+p;var x,w=.5,M=0,b=0,k=1e5,L=n(d,v,h,g);for(var T in e)T+="",i(L,e[T]);return o(L),f(),L}function N(e,t,n,r,i,a){e[t]=r?n[t]:{x:i,y:a}}function K(e,t,n,r){var i=1.25-(d(n.tightness)-5)/10,a=F(t.v,t.e),o=R(a,t.v,i);w(e,o,n,function(e,n,i){var o={};for(var u in e.vertices)if(u+="",a.rev[u])for(var s=e.vertices[u].fixed,c=0;c<a.rev[u].length;c++){var l=a.rev[u][c],f=e.vertices[u].x,d=e.vertices[u].y;e.vertices[u].jit.positions&&(f+=e.vertices[u].jit.positions[l].x,d+=e.vertices[u].jit.positions[l].y),N(o,l,t.v,s,f,d)}else N(o,u,t.v,t.v[u].fixed,e.vertices[u].x,e.vertices[u].y);var h={vertices:o,extents:e.extents};r(h,n,i)})}function R(e,t,n){var r={},i=[],a=0;for(var o in e.rev){o+="";var s={};s.x=s.y=s.size=0;for(var c=e.rev[o].length,l=!1,f=0;c>f;f++){var d=t[e.rev[o][f]];s.x+=d.x,s.y+=d.y,s.size+=d.size}s.x=s.x/c,s.y=s.y/c;var h=G(t,e.rev[o],s.size/c,n);r[o]={x:s.x,y:s.y,size:h.radius,fixed:l,jit:h,lc:0},a++;for(var v=e.rev[o][0],g={},m=e.index[v],y=0;y<m.length;y++){var p=m[y];g[e.ids[p]]=1}for(var x in g)x+="",x>o&&i.push({id1:o,id2:x})}for(var w,M,b=0;b<i.length;b++)w=i[b].id1+"",M=i[b].id2+"",r[w].lc++,r[M].lc++;for(var k in t)if(k+="",!e.ids[k]){var L=t[k];r[k]={x:L.x,y:L.y,size:L.size,lc:0,fixed:L.fixed,jit:{radius:L.size,position:{x:0,y:0}}},a++}return{v:r,e:i,vcount:a,extents:u(r)}}function F(e,t){var n=j(t);return Y(n)}function _(e,t,n){e[n]||(e[n]=[]),e[n].push(t)}function H(e,t){_(e,t.id1,t.id2),_(e,t.id2,t.id1)}function j(e){for(var t={},n=0;n<e.length;n++)H(t,e[n]);return t}function Y(e){var t,n={},r={};for(var i in e){i+="",e[i].sort(),t="";for(var a=0;a<e[i].length;a++)t+=e[i][a];n[t]||(n[t]=[]),n[t].push(i),r[i]=t}return{rev:n,ids:r,index:e}}function G(e,t,n,r){var i,a={},o=0,u=t.length-1;do i=W(e,t,n,u,a,r),o=Math.max(i.radius,o),u=i.index;while(u>=0);var s;switch(t.length){case 4:s=2;break;case 3:s=2.5;break;case 2:s=3;break;case 1:s=1;break;default:s=2}return{positions:a,radius:o*s}}function W(e,t,n,r,i,a){if(0===r)return i[t[0]]={x:0,y:0},{radius:n,index:-1};var o=(r+1)*n,u=n,s=Math.sqrt(o/(Math.PI*u)),c=s*u,l=Math.floor(2*Math.PI*c/n);l=Math.min(l,r+1);var f=2*Math.PI/l,d=0;switch(l){case 2:d=Math.PI/2,c=.75*c;break;case 3:d=Math.PI/3,c=.85*c;break;case 4:d=0,c=.85*c;break;case 5:d=0,c=.9*c;break;default:d=0}c*=a;for(var h=0;l>h;)i[t[r-h]]={x:c*Math.cos(d),y:c*Math.sin(d)},d+=f,h++;return r-=l,{radius:c,index:r}}function q(e,t,n,r){var i,a=0,o={};for(i=0;i<t.length;i++)a+=e[t[i]].size;if(1===t.length)o[t[0]]={x:0,y:0};else{var u=Math.PI/4;2===t.length&&(u=Math.PI/2),4===t.length&&(u=0),t.length<4&&(a=1.5*a);var s=2*Math.PI/t.length,c=r*a/4;for(i=0;i<t.length;i++)o[t[i]]={x:c*Math.cos(u),y:c*Math.sin(u)},u+=s}return{positions:o,radius:a}}function Z(e,t,n){var r,i=V();t.canvas||(t.canvas=X());for(var a=t.canvas.setDimensions(t.width,t.height),o=0,u=0,s=0;s<e.length;s++){var c=e[s];if(r=a.addRect(c.width,c.height),!r.placed){i.width=0,i.height=0,i.comps.length=0,i.lowestHeightFlushedRightItem=0;break}c.x=r.offsetX,c.y=r.offsetY,i.comps.push(c),c.y+c.height>i.height&&(i.height=c.y+c.height),c.x+c.width>i.width&&(i.width=c.x+c.width);var l=c.width+c.x;(l>u||l===u&&c.height>o)&&(i.lowestHeightFlushedRightItem=r.lfhd,o=c.height,u=l)}return n.cellsGenerated=a.cells,n.addAttempts=a.addAttempts,t.lowestFreeHeightDeficit=a.lfhDeficitSinceLastRedim(),i}function V(){var e={width:0,height:0,area:function(){return e.width*e.height},comps:[],lowestHeightFlushedRightItem:0,ratio:function(){return 0===e.width?1/0:e.width/e.height}};return e}function X(){function e(e,t){var n=l.height-e;return t-n}function t(e,t,n){if(n.leftOverW>0){l.cells+=s.rows();var r=e+n.nRequiredCellsH-1;s.insertCol(r,n.leftOverW)}if(n.leftOverH>0){l.cells+=s.cols();var i=t+n.nRequiredCellsV-1;s.insertRow(i,n.leftOverH)}for(var a=e+n.nRequiredCellsH-1;a>=e;a--)for(var o=t+n.nRequiredCellsV-1;o>=t;o--)s.setItem(a,o,!0)}function n(e,t,n,r){r.nRequiredCellsH=0,r.nRequiredCellsV=0,r.leftOverW=0,r.leftOverH=0;for(var i,a=0,o=0,u=t;o<n.height;){for(i=e,a=0;a<n.width;){if(s.item(i,u))return!1;a+=s.colWidth(i),i++}o+=s.rowHeight(u),u++}return r.nRequiredCellsH=i-e,r.nRequiredCellsV=u-t,r.leftOverW=a-n.width,r.leftOverH=o-n.height,!0}function r(e,t,n){var r=0,i=0,a=0,o=0,u=0;for(a=0;e>a;a++)r+=s.colWidth(a);for(a=0;t>a;a++)i+=s.rowHeight(a);if(o=n.x-r,u=n.y-i,0>o||0>u)return!1;if(o>0){l.cells+=s.rows();var c=s.colWidth(e)-o;s.insertCol(e,c)}if(u>0){l.cells+=s.cols();var f=s.rowHeight(t)-u;s.insertRow(t,f)}return!0}function i(e,t){return l.width=e,l.height=t,l.area=o(),s.init(e,t,!1),l}function a(i,a,o){var u={offsetX:0,offsetY:0,width:i,height:a,placed:!1},f=0,d=0,h=0,v=0,g={};if(o){for(;f<s.cols()&&h<o.x;)h+=s.colWidth(f),f++;for(;d<s.rows()&&v<o.y;)v+=s.rowHeight(d),d++;r(f-1,d-1,o),h-=s.colWidth(f),v-=s.rowHeight(d)}l.addAttempts++;for(var m=rt;;){for(g={};d<s.rows()&&s.item(f,d);)v+=s.rowHeight(d),d++;if(d<s.rows()&&e(v,u.height)<=0){if(n(f,d,u,g)){t(f,d,g),u.offsetX=h,u.offsetY=v,u.placed=!0;break}v+=s.rowHeight(d),d++}var y=e(v,u.height);if(y>0&&(v=0,d=0,h+=s.colWidth(f),f++,l.lfhDeficitSinceLastRedim()>y&&(c=y)),l.width-h<u.width){u.placed=!1;break}}return m=c,{offsetX:u.offsetX,offsetY:u.offsetY,lfhd:m,placed:u.placed}}function o(){return l.width*l.height}var u=0,s=$(),c=rt,l={matrix:s,cells:u,addAttempts:0,addRect:a,lfhDeficitSinceLastRedim:function(){return c},setDimensions:i};return l}function $(){function e(){(a.length>0||o.length>0)&&(a.length=o.length=u.length=0)}function t(t,n,r){if(0>=t)throw"[Matrix] Column size cannot be 0 or similar";if(0>=n)throw"[Matrix] Row size cannot be 0 or similar";return s=1,c=1,e(),a.push({index:0,size:t}),o.push({index:0,size:n}),u[0]=[],u[0][0]=r,l}function n(e,t){for(var n=o[e].index,r=0;c>r;r++)u[r][s]=u[r][n];return s-1>e&&o.splice(e+1,0,{index:s,size:t}),o[e+1]={index:s,size:t},o[e].size-=t,s++,l}function r(e,t){var n=(u[0].length,a[e].index);return u[c]=Q.clone(u[n]),c-1>e&&a.splice(e+1,0,{index:c,size:t}),a[e+1]={index:c,size:t},a[e].size-=t,c++,l}function i(){var e,t,n,r="\n     ",i=0,u=0;for(i=0;c>i;i++)e=0===Math.floor(a[i].size/100)%10?" ":""+Math.floor(a[i].size/100)%10,t=0===Math.floor(a[i].size/10)%10&&" "===e?" ":""+Math.floor(a[i].size/10)%10,n=0===Math.floor(a[i].size)%10&&" "===e&&" "===t?" ":""+Math.floor(a[i].size)%10,r+=a[i].size>999?" "+a[i].size+" ":" "+e+t+n+" ";for(r+="\n",i=0;s>i;i++){for(e=0===Math.floor(o[i].size/100)%10?" ":""+Math.floor(o[i].size/100)%10,t=0===Math.floor(o[i].size/10)%10&&" "===e?" ":""+Math.floor(o[i].size/10)%10,n=0===Math.floor(o[i].size)%10&&" "===e&&" "===t?" ":""+Math.floor(o[i].size)%10,r+=o[i].size>999?" "+o[i].size+": ":" "+e+t+n+": ",u=0;c>u;u++)r+=l.item(u,i)?"  X  ":"  .  ";r+="\n"}return r}var a=[],o=[],u=[],s=0,c=0,l={init:t,cols:function(){return c},rows:function(){return s},item:function(e,t){return u[a[e].index][o[t].index]},setItem:function(e,t,n){u[a[e].index][o[t].index]=n},insertRow:n,insertCol:r,colWidth:function(e){return a[e].size},rowHeight:function(e){return o[e].size},inspect:i};return l}var Q=KeyLines.Util,J=KeyLines.Graph;e.createLens(d);var et={};et.extractStructure=function(e,t,n,r,i,o){var s=null;if(i){s={};for(var c=0;c<i.length;c++)s[i[c]]=1}var l=a(e,t,n,r,s,o);return l.extents=u(l.v),l},et.layout=function(t,n,r,i,a){n.trigger("prechange","layout");var o="^(standard|hierarchy";o+="|radial|structural|tweak|lens",o+=")$";var u=new RegExp(o);if(!u.test(t))throw new Error("The layout name is not valid.");"standard"===t&&w(n,r,i,a),"hierarchy"===t&&g(n,r,i,a),"structural"===t&&K(n,r,i,a),"radial"===t&&g(n,r,i,a,y),"tweak"===t&&T(n,r,i,a),"lens"===t&&e.lens(n,r,i,k,a)},et.arrange=function(e,t,n,r,i,a){function u(e,t){var n,r=[];for(n=0;n<t.length;n++)e[t[n]]&&r.push(t[n]);return r}function s(e,t,n,r){var i;for(i=0;i<e.length;i++)if(e[i].id===t){e[i].x=n-e[i].width/2,e[i].y=r-e[i].height/2;break}return e}function c(e,t,n,r){var a={},o=[],u={};for(f=0;f<e.length;f++)u=P(e[f].verts,t),isFinite(u.width)&&(o.push({x:u.x,y:u.y,width:u.width,height:u.height,id:f}),a[f]={x:u.x,y:u.y});u=P(t),o.push({x:u.x,y:u.y,width:u.width,height:u.height,id:y}),a[y]={x:u.x,y:u.y};var s=w(o,{ratio:i.ratio,centre:n,absolute:r,specialId:y});return{packed:s,original:a}}function l(e,t,n){var r,i;for(var a in e){var o=e[a+""];o.arranged?(r=n[y].x-t[y].x,i=n[y].y-t[y].y):(r=n[o.c].x-t[o.c].x,i=n[o.c].y-t[o.c].y),o.x+=r,o.y+=i}}var f,d,v,g={tidy:function(e,t){return nt(e,{step:30,max:2,sort:!1,ratio:t.ratio}).comps},average:function(e,t){return s(e,t.specialId,t.centre.x,t.centre.y)},absolute:function(e,t){return s(e,t.specialId,t.absolute.x,t.absolute.y)}},m={grid:function(e,t,n,r){var i=2*n+24+r,a=0,o=0,u=Math.floor(Math.sqrt(e.length)),s=Math.ceil(e.length/u),c={};for(f=0;u>f;f++){for(d=0;s>d;d++){var l=s*f+d;e[l]&&(c[e[l]]={x:a,y:o}),a+=i}a=0,o+=i}return c},circle:function(e,t,n,r){var i=1.25-(5-r)/50;return q(t,e,n,i).positions},radial:function(e,t,n,r){var i=1.25-(5-r)/50;return G(t,e,n,i).positions}},y="#arranged#";i=Q.defaults(i,{tightness:5,position:"average",x:0,y:0}),t.trigger("prechange","arrange");var p=r.v,x=h(i.tightness),w=g[i.position]||g.average,M=m[e]||m.grid,b={x:Number(i.x)||0,y:Number(i.y)||0},L={x:0,y:0};if(n=Q.ensureArray(n),n=u(p,n),!n.length)return a();for(v=0,f=0;f<n.length;f++)v+=p[n[f]].size,L.x+=p[n[f]].x,L.y+=p[n[f]].y;v/=n.length,L.x/=n.length,L.y/=n.length;var T=M(n,p,v,x),S={};for(var C in T)C+="",p[C].x=T[C].x,p[C].y=T[C].y,S[C]=p[C],S[C].arranged=1;var I=o(p,r.e),O=c(I,S,L,b),E=O.packed,D=O.original,z={};for(f=0;f<E.length;f++)z[E[f].id]=E[f];l(p,D,z);var A=[],B=r.extents;k(t,p,B,A,i,a)};var tt=function(e,t){function n(){return 2*Math.random()-1+(2*Math.random()-1)+(2*Math.random()-1)}function r(e,t,n){return(t-e)*n+e}function a(e,t,n){return(e-n)/(t-n)}function o(e){var n=function(){for(var t=0,n=-1/0,r=0;r<e.length;r++)t+=e[r].width*e[r].height,n=Math.max(n,e[r].width);return{area:t,maxWidth:n}},r=1.1,i=1.03,a=10,o=n(),u=Math.sqrt(o.area*r/t.ratio)*i,s=u*t.ratio;return s<o.maxWidth+a&&(s=o.maxWidth+a),{x:0,y:0,width:s,height:u}}function u(e,t,n,i,o,u){var s=a(t,n,i);return s=Math.pow(s,e),r(u,o,s)}function s(e,t){if(!t)return!1;var n=e.x<g.x+g.width,r=e.x+e.width>g.x,i=e.y<g.y+g.height,a=e.y+e.height>g.y;return n||r&&i||a}function c(e,t){function n(e,t){var n=e.y<t.y+t.height,r=e.y+e.height>t.y;return n&&r}function r(e,t){var n=e.x<t.x+t.width,r=e.x+e.width>t.x;return n&&r}if(t.length<1)return!1;var i,a;for(i=0;i<t.length;i++)if(a=t[i],r(e,a)&&n(e,a))return!0;return!1}var l,f,d,h={spiral:function(e){var t=u(.6,e,100,0,p,1),n=u(1,e,600,0,.3,.5),r=n*e,i=Math.cos(r)*t,a=Math.sin(r)*t;return{x:i,y:a}},controlled:function(e,t){for(var n;!s(t,n);)n=h.random(e);return n},rect:function(e){return nt(e,t)},random:function(e){var t=.5*e;return{x:n()*t,y:n()*t}}},v=0,g=o(e),m=[],y=h[t.strategy]||h.rect,p=0;for(l=0;l<e.length;l++)f=e[l],p+=f.width;if(p/=2*e.length,"rect"===t.strategy)return y(e);for(e.sort(i),l=0;l<e.length;l++){for(f=e[l],f.x=f.fixed?f.x:0,f.y=f.fixed?f.y:0;c(f,m)&&!f.fixed;)d=y(v,f),f.x=d.x,f.y=d.y,v++;m.push(f)}return{comps:m,stats:{cellsGenerated:v,addAttempts:v}}},nt=et.pack=function(e,t){function n(){for(var t=0,n=0;n<e.length;n++)t+=e[n].width*e[n].height;return t}function r(e,t){var n=i(e,t);return n?n:t.height-e.height}function a(e){for(var t=0,n=0;n<e.length;n++)t<e[n].width&&(t=e[n].width);return t}function o(e){for(var n=Q.clone(e),r=0;r<n.length;r++){var i=n[r].width%t.step,a=n[r].height%t.step;0!==i&&(n[r].width=n[r].width+(t.step-i)),0!==a&&(n[r].height=n[r].height+(t.step-a))}return n}function u(e){return d?e.ratio()>=t.ratio-.2&&e.ratio()<=t.ratio:!0}function s(e){for(var n=h(t.tightness),r=0;r<e.length;r++)e[r].width+=n,e[r].height+=n}function c(e){var n=1.1,r=1.03,i=10,a=Math.sqrt(e.area()*n/t.ratio)*r,o=a*t.ratio;return o<e.maxWidth+i&&(o=e.maxWidth+i),{width:o,height:a,lowestFreeHeightDeficit:0,ratio:function(){return m.width/m.height}}}t=Q.defaults(t,{ratio:4/3,max:10,sort:!0,step:10,tightness:5}),t.sort&&e.sort(r),s(e);var l,f=o(e),d=!0,v={candidatesFailure:0,candidatesOk:0,addAttempts:0,cellsGenerated:0,candidatesAccepted:0,totalTime:0};if(0===e.length)return l=V(),l.stats=v,l;for(var g={area:n,maxWidth:a(f),maxHeight:f[0].height},m=c(g,f);m.width>=g.maxWidth;){var y=Z(f,m,v);if(0===y.comps.length)v.candidatesFailure++,m.width*=1.03,m.height*=1.03;else{if(v.candidatesOk++,(!l||u(y))&&(v.candidatesAccepted++,l=y,l.efficiency=g.area()/y.area(),u(y)))break;if(v.candidatesOk>=t.max)break}}return l.stats=v,l},rt=16e6;return et}}(),!function(){function e(){function e(e){var t={};if(e)for(var n=0;n<e.length;n++)t[e[n]]=1;return t}var t,n,r={},i=[];for(var a in k)i.push(M());var o=r.layer=function(e){return"undefined"!=typeof e&&(n=e,t=i[n]),n};return o(k.NODES),r.reset=function(t){for(var n=e(t),r=0;r<i.length;r++)(!t||n[r])&&i[r].reset()},r.getLast=function(){return t.getLast()},r.each=function(t,n){for(var r=e(n),a=0;a<i.length;a++)(!n||r[a])&&i[a].each(t)},r.line=function(e,n,r,i,a,o,u,s,c){var l=t.getNext();l.p=x.primitives.line,l.x1=e,l.y1=n,l.x2=r,l.y2=i,l.c=a,l.w=o,l.id=u,l.dl=s,l.gl=c},r.line3=function(e,n,r,i,a,o,u,s,c,l,f,d,h){var v=t.getNext();v.p=x.primitives.line3,v.x1=e,v.y1=n,v.x2=r,v.y2=i,v.x3=a,v.y3=o,v.x4=u,v.y4=s,v.c=c,v.w=l,v.id=f,v.dl=d,v.gl=h},r.circle=function(e,n,r,i,a,o,u,s,c,l){var f=t.getNext();f.p=x.primitives.circle,f.x=e,f.y=n,f.r=r,f.bc=i,f.bw=a,f.fc=o,f.fi=u,f.id=s,f.dl=c,f.gl=l},r.arc=function(e,n,r,i,a,o,u,s,c,l,f){var d=t.getNext();d.p=x.primitives.arc,d.x=e,d.y=n,d.r=r,d.sa=i,d.ea=a,d.bc=o,d.bw=u,d.id=s,d.dl=c,d.gl=l,d.cl=f},r.text=function(e,n,r,i,a,o,u,s){var c=t.getNext();c.p=x.primitives.text,c.x=e,c.y=n,c.t=r,c.c=i,c.fs=a,c.bo=o,c.ff=s,c.id=u},r.image=function(e,n,r,i,a,o,u){var s=t.getNext();s.p=x.primitives.image,s.x1=e,s.y1=n,s.x2=r,s.y2=i,s.u=a,s.id=o,s.s=u},r.rect=function(e,n,r,i,a,o,u,s,c,l,f){var d=t.getNext();d.p=x.primitives.rect,d.x1=e,d.y1=n,d.x2=r,d.y2=i,d.bc=a,d.bw=o,d.fc=u,d.fi=s,d.id=c,d.dl=l,d.gl=f},r.round=function(e,n,r,i,a,o,u,s,c,l){var f=t.getNext();f.p=x.primitives.round,f.x1=e,f.y1=n,f.x2=r,f.y2=i,f.r=a,f.bc=o,f.bw=u,f.fc=s,f.fi=c,f.id=l},r.triangle=function(e,n,r,i,a,o,u,s,c,l,f){var d=t.getNext();d.p=x.primitives.triangle,d.x1=e,d.y1=n,d.x2=r,d.y2=i,d.x3=a,d.y3=o,d.bc=u,d.bw=s,d.fc=c,d.fi=l,d.id=f},r.pentagon=function(e,n,r,i,a,o,u,s,c,l,f,d,h,v,g,m,y){var p=t.getNext();p.p=x.primitives.pentagon,p.x1=e,p.y1=n,p.x2=r,p.y2=i,p.x3=a,p.y3=o,p.x4=u,p.y4=s,p.x5=c,p.y5=l,p.bc=f,p.bw=d,p.fc=h,p.fi=v,p.id=g,p.dl=m,p.gl=y},r.path=function(e,n,r,i,a){var o=t.getNext();o.p=x.primitives.path,o.cmds=e,o.pts=n,o.c=r,o.w=i,o.id=a},r.copyPrimitive=function(e){var n=t.getNext();for(var r in e)n[r]=e[r]},r}function t(e,t){return 1===t?e:H(e,t)}function n(e,t,n){switch(n.p){case x.primitives.circle:o(e,n.x,n.y,n.r,n.bc,n.bw,n.fc,n.fi,n.dl,n.gl);break;case x.primitives.arc:u(e,n.x,n.y,n.r,n.sa,n.ea,n.bc,n.bw,n.dl,n.gl,n.cl);break;case x.primitives.line:s(e,n.x1,n.y1,n.x2,n.y2,n.c,n.w,n.dl,n.gl);break;case x.primitives.line3:c(e,n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.x4,n.y4,n.c,n.w,n.dl,n.gl);break;case x.primitives.text:l(e,n.x,n.y,n.t,n.c,n.fs,n.bo,n.ff);break;case x.primitives.image:d(e,t[n.u],n.x1,n.y1,n.x2,n.y2,n.s);break;case x.primitives.rect:f(e,n.x1,n.y1,n.x2,n.y2,n.bc,n.bw,n.fc,n.fi,n.dl,n.gl);break;case x.primitives.round:h(e,n.x1,n.y1,n.x2,n.y2,n.r,n.bc,n.bw,n.fc,n.fi);break;case x.primitives.triangle:v(e,n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.bc,n.bw,n.fc,n.fi);break;case x.primitives.pentagon:g(e,n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.x4,n.y4,n.x5,n.y5,n.bc,n.bw,n.fc,n.fi,n.dl,n.gl);break;case x.primitives.path:a(e,n.cmds,n.pts,n.c,n.w)}}function r(e,t,n){"setLineDash"in e&&t?(e.lineCap=t>1?"butt":"round",N[0]=t,N[1]=n,e.setLineDash(N)):e.lineCap="butt"}function i(e){N[0]&&(N[0]=0,e.setLineDash(K))}function a(e,t,n,r,i){if(e.hasOwnProperty("doPath"))e.doPath(t,n,r,i);else{i>=0&&(e.lineWidth=null!==i&&1>i?1:i,e.strokeStyle=r,e.beginPath());for(var a=0,o=0;o<t.length;o++)switch(t[o]){case 1:e.moveTo(n[a++],n[a++]);break;case 2:e.lineTo(n[a++],n[a++]);break;case 3:e.quadraticCurveTo(n[a++],n[a++],n[a++],n[a++])}i>=0&&(e.stroke(),e.closePath())}}function o(e,t,n,a,o,u,s,c,l,f){e.fillStyle=c?s:S.transparent,u>=0?(r(e,l,f),e.lineWidth=null!==u&&1>u?1:u,e.strokeStyle=o):e.strokeStyle=S.transparent,e.beginPath(),e.arc(t,n,a,0,2*Math.PI,!0),e.closePath(),c&&e.fill(),u>=0&&(e.stroke(),i(e))}function u(e,t,n,a,o,u,s,c,l,f,d){d=!!d,e.lineWidth=null!==c&&1>c?1:c,e.strokeStyle=s,r(e,l,f),e.beginPath(),e.arc(t,n,a,o,u,d),e.stroke(),e.closePath(),i(e)}function s(e,t,n,a,o,u,s,c,l){e.lineWidth=null!==s&&1>s?1:s,e.strokeStyle=u,r(e,c,l),e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.stroke(),e.closePath(),i(e)}function c(e,t,n,a,o,u,s,c,l,f,d,h,v){var g=e.lineJoin;e.lineWidth=d,e.lineJoin="round",e.strokeStyle=f,r(e,h,v),e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.lineTo(u,s),e.lineTo(c,l),e.stroke(),e.closePath(),e.lineJoin=g,i(e)}function l(e,t,n,r,i,a,o,u){_(e,a,o,u),e.fillStyle=i,e.fillText(r,t,n)}function f(e,t,n,a,o,u,s,c,l,f,d){l&&(e.fillStyle=c,e.fillRect(t,n,a-t,o-n)),s>=0&&(r(e,f,d),e.lineWidth=null!==s&&1>s?1:s,e.strokeStyle=u,e.strokeRect(t,n,a-t,o-n),i(e))}function d(e,t,n,r,i,a,o){var u=t[o?o:"im"];e.drawImage(u,0,0,u.width,u.height,n,r,i-n,a-r)}function h(e,t,n,r,i,a,o,u,s,c){return e.drawRoundedRect?(e.drawRoundedRect(t,n,r,i,a,o,u,s,c),void 0):(e.beginPath(),e.moveTo(t+a,n),e.lineTo(r-a,n),e.arcTo(r,n,r,n+a,a),e.lineTo(r,i-a),e.arcTo(r,i,r-a,i,a),e.lineTo(t+a,i),e.arcTo(t,i,t,i-a,a),e.lineTo(t,n+a),e.arcTo(t,n,t+a,n,a),e.closePath(),c&&(e.fillStyle=s,e.fill()),u>=0&&(e.lineWidth=null!==u&&1>u?1:u,e.strokeStyle=o,e.stroke()),void 0)}function v(e,t,n,r,i,a,o,u,s,c,l){return e.drawTriangle?(e.drawTriangle(t,n,r,i,a,o,u,s,c,l),void 0):(e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.lineTo(a,o),e.lineTo(t,n),e.closePath(),l&&(e.fillStyle=c,e.fill()),s>=0&&(e.lineWidth=null!==s&&1>s?1:s,e.strokeStyle=u,e.stroke()),void 0)}function g(e,t,n,a,o,u,s,c,l,f,d,h,v,g,m,y,p){return e.drawPentagon?(e.drawPentagon(t,n,a,o,u,s,c,l,f,d,h,v,g,m),void 0):(e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.lineTo(u,s),e.lineTo(c,l),e.lineTo(f,d),e.lineTo(t,n),e.closePath(),m&&(e.fillStyle=g,e.fill()),v>=0&&(r(e,y,p),e.lineWidth=v,e.strokeStyle=h,e.stroke(),i(e)),void 0)}function m(e,t,n){e/=255,t/=255,n/=255;var r,i,a=Math.max(e,t,n),o=Math.min(e,t,n),u=(a+o)/2;if(a===o)r=i=0;else{var s=a-o;switch(i=u>.5?s/(2-a-o):s/(a+o),a){case e:r=(t-n)/s+(n>t?6:0);break;case t:r=(n-e)/s+2;break;case n:r=(e-t)/s+4}r/=6}return[r,i,u]}function y(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+6*(t-e)*(2/3-n):e}function p(e,t,n){var r,i,a;if(0===t)r=i=a=n;else{var o=.5>n?n*(1+t):n+t-n*t,u=2*n-o;r=y(u,o,e+1/3),i=y(u,o,e),a=y(u,o,e-1/3)}return[Math.ceil(255*r),Math.ceil(255*i),Math.ceil(255*a)]}var x=KeyLines.Rendering={},w=(new Date).getTime()/36751,M=function(){function e(){return t[n]||(t[n]={}),t[n++]}var t=[],n=0,r="out of range error";return{reset:function(){n=0},each:function(e){for(var r=0;n>r;r++)e(t[r])},getNext:e,getLast:function(){if(0>=n)throw r;return t[n-1]}}};x.pool=function(){return M()};for(var b=["BANDS","UNDERLAYS","BGHALOS","HALOS","BGSHAPESEL","BGSHAPES","SHAPESEL","SHAPES","HANDLES","BGNODESEL","BGLINKS","BGNODES","BGBUBBLES","NODESEL","LINKS","NODES","DRAGGERS","BUBBLES","BANDLABELS","OVERLAYS","TOUCHES","OVERVIEW","WAIT"],k=x.layers={},L=0;L<b.length;L++)k[b[L]]=L;x.bgLayers=[k.BGHALOS,k.BGSHAPESEL,k.BGSHAPES,k.BGNODESEL,k.BGLINKS,k.BGNODES,k.BGBUBBLES],x.overviewLayers=[k.BGHALOS,k.HALOS,k.BGSHAPESEL,k.BGSHAPES,k.BGNODESEL,k.BGLINKS,k.BGNODES,k.BGBUBBLES,k.SHAPESEL,k.SHAPES,k.NODESEL,k.LINKS,k.NODES,k.BUBBLES,k.OVERLAYS],x.topLayers=[k.HALOS,k.SHAPESEL,k.SHAPES,k.NODESEL,k.LINKS,k.NODES,k.HANDLES,k.DRAGGERS,k.BUBBLES,k.BANDLABELS,k.OVERLAYS],x.overlayLayers=[k.BANDS,k.BANDLABELS,k.OVERLAYS,k.UNDERLAYS],x.hitLayers=[k.SHAPES,k.LINKS,k.NODES,k.HANDLES,k.BUBBLES,k.OVERLAYS,k.OVERVIEW],x.selMap={},x.selMap[k.NODES]=k.NODESEL,x.selMap[k.BGNODES]=k.BGNODESEL,x.selMap[k.SHAPES]=k.SHAPESEL,x.selMap[k.BGSHAPES]=k.BGSHAPESEL,x.instructionPool=function(){return e()},x.primitives={circle:"C",arc:"A",line:"L",line3:"L3",text:"T",image:"I",rect:"R",round:"RR",triangle:"TR",pentagon:"PE",path:"P"};var T="rgb(128, 128, 128)",S=x.colours={aqua:"rgb(0, 255, 255)",black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",fuchsia:"rgb(255, 0, 255)",green:"rgb(0, 128, 0)",grey:T,gray:T,lime:"rgb(0, 255, 0)",maroon:"rgb(128, 0, 0)",navy:"rgb(0, 0, 128)",olive:"rgb(128, 128, 0)",purple:"rgb(128, 0, 128)",red:"rgb(255, 0, 0)",silver:"rgb(192, 192, 192)",teal:"rgb(0, 128, 128)",yellow:"rgb(255, 255, 0)",white:"rgb(255, 255, 255)",ci:"rgb(0, 174, 239)",cia:"rgba(0, 174, 239, 0.5)",keyline:"rgb(88, 89, 91)",midgrey:"rgb(145, 146, 149)",lightgrey:"rgb(208, 209, 211)",edit:"rgb(114, 179, 0)",attention:"rgb(220, 0, 0)",information:"rgb(0, 150, 255)",description:"rgb(255, 175, 0)",textback:"rgba(255,255,255,0.6)",transparent:"rgba(255,255,255,0.0)",touch:"rgba(255,0,0,0.6)"},C=new Date/12524,I=x.rgbtostring=function(e,t,n){return"rgb("+e+","+t+","+n+")"
},O=x.rgbatostring=function(e,t,n,r){return"rgba("+e+","+t+","+n+","+r+")"},E=/^(?:rgb)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?\)$/i,D=/^(?:rgba)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),\s?(0|1|0\.\d{0,20}|1\.0)\)$/i,P=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,z=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])$/i;x.validatergb=function(e){return!!A(e).length};var A=x.convertrgb=function(e){var t,n=[],r=S[e.toLowerCase()];e=r?r:e;var i=e.match(E);if(i||(i=e.match(D)),i)for(t=1;4>t;t++)n.push(parseInt(i[t],10));else{if(i=e.match(z),!i&&(i=e.match(P)))for(t=1;4>t;t++)i[t]=""+i[t]+i[t];if(i)for(t=1;4>t;t++)n.push(parseInt(i[t],16))}return n},B=x.opacity=function(e){var t=e.match(D);return t?parseFloat(t[4]):1};x.hsla=function(e){var t=A(e),n=m(t[0],t[1],t[2]);return n.push(B(e)),n},x.fromhsla=function(e){var t=p(e[0],e[1],e[2]);return O(t[0],t[1],t[2],e[3])},x.rgbtohex=function(e){for(var t=A(e),n="",r=0;r<t.length;r++){var i=t[r];n+=(16>i?"0":"")+i.toString(16)}return n};var U=x.randomColour=function(e){function t(){return Math.floor(255*Math.random())}var n=I(t(),t(),t());return e&&n in e?U(e):n},N=[0,0],K=[],R={};x.clearLastFont=function(){R={}};var F=x.defaultFamily="Ubuntu";x.browserMinimumFontSize=1;var _=x.setFont=function(e,t,n,r){if(n=!!n,r=r||F,e!==R.context||t!==R.fontSize||n!==R.bold||r!==R.family){R.context=e,R.fontSize=t,R.bold=n,R.family=r;var i=n?"bold":"normal",a="normal",o="px",u=a+" "+i+" "+t+o+" "+r;e.font=u,e.textAlign="left",e.textBaseline="bottom"}};x.setAlpha=function(e,t){for(var n=["c","fc","bc"],r=0;r<n.length;r++){var i=n[r];if(i in e){var a=A(e[i]);e[i]=O(a[0],a[1],a[2],t)}}};var H=x.alphaize=function(e,t){var n=A(e),r=B(e);return O(n[0],n[1],n[2],r*t)};x.setExtents=function(e,t,n,r,i){var a,o;switch(e.p){case x.primitives.circle:a=Math.abs((r-t)/2),o=Math.abs((i-n)/2),e.x=Math.floor(Math.min(t,r)+a),e.y=Math.floor(Math.min(n,i)+o),e.r=Math.floor(Math.min(a,o));break;case x.primitives.line:case x.primitives.rect:case x.primitives.round:e.x1=Math.min(t,r),e.x2=Math.max(t,r),e.y1=Math.min(n,i),e.y2=Math.max(n,i);break;case x.primitives.line3:break;case x.primitives.text:e.x=Math.min(t,r),e.y=Math.max(n,i);break;case x.primitives.image:e.x1=Math.min(t,r),e.y1=Math.min(n,i),e.x2=Math.max(t,r),e.y2=Math.max(n,i);break;case x.primitives.triangle:case x.primitives.pentagon:}};var j=x.extents=function(e,t){var n,r,i,a;switch(t.p){case x.primitives.circle:n=t.x-t.r,r=t.x+t.r,i=t.y-t.r,a=t.y+t.r;break;case x.primitives.line:case x.primitives.rect:case x.primitives.round:case x.primitives.image:n=Math.min(t.x1,t.x2),r=Math.max(t.x1,t.x2),i=Math.min(t.y1,t.y2),a=Math.max(t.y1,t.y2);break;case x.primitives.line3:n=Math.min(t.x1,t.x2,t.x3,t.x4),r=Math.max(t.x1,t.x2,t.x3,t.x4),i=Math.min(t.y1,t.y2,t.y3,t.y4),a=Math.max(t.y1,t.y2,t.y3,t.y4);break;case x.primitives.text:var o=X(e,t.t,t.fs,t.bo,t.ff);n=t.x,i=t.y-o.height,r=t.x+o.width,a=t.y;break;case x.primitives.triangle:n=Math.min(t.x1,t.x2,t.x3),r=Math.max(t.x1,t.x2,t.x3),i=Math.min(t.y1,t.y2,t.y3),a=Math.max(t.y1,t.y2,t.y3);break;case x.primitives.pentagon:n=Math.min(t.x1,t.x2,t.x3,t.x4,t.x5),r=Math.max(t.x1,t.x2,t.x3,t.x4,t.x5),i=Math.min(t.y1,t.y2,t.y3,t.y4,t.y5),a=Math.max(t.y1,t.y2,t.y3,t.y4,t.y5);break;case x.primitives.arc:var u=t.x+t.r*Math.cos(t.sa),s=t.y+t.r*Math.sin(t.sa),c=t.x+t.r*Math.cos(t.ea),l=t.y+t.r*Math.sin(t.ea);n=Math.min(u,c),r=Math.max(u,c),i=Math.min(s,l),a=Math.max(s,l);for(var f=(Math.floor(t.sa/(Math.PI/2))+1)*Math.PI/2;f<t.ea;){var d=t.x+t.r*Math.cos(f),h=t.y+t.r*Math.sin(f);n=Math.min(n,d),r=Math.max(r,d),i=Math.min(i,h),a=Math.max(a,h),f+=Math.PI/2}}return{x1:n,y1:i,x2:r,y2:a}},Y=x.join=function(e,t){return{x1:Math.min(e.x1,t.x1),y1:Math.min(e.y1,t.y1),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}};x.inside=function(e,t,n){return e.x1<=t&&t<=e.x2&&e.y1<=n&&n<=e.y2},x.insideCircle=function(e,t,n,r,i,a){a||(a=0);var o=Math.sqrt((e-r)*(e-r)+(t-i)*(t-i));return n>o+a},x.rectContains=function(e,t,n,r,i){return e.x1<t&&r<e.x2&&e.y1<n&&i<e.y2},x.circleContains=function(e,t,n,r,i,a,o){var u=(e-r)*(e-r)+(t-i)*(t-i),s=(e-r)*(e-r)+(t-o)*(t-o),c=(e-a)*(e-a)+(t-i)*(t-i),l=(e-a)*(e-a)+(t-o)*(t-o),f=n*n;return f>u&&f>s&&f>c&&f>l},x.intersects=function(e,t){return!(t.x1>e.x2||t.x2<e.x1||t.y1>e.y2||t.y2<e.y1)};var G=function(e){switch(e.length){case 0:return void 0;case 1:return e[0];default:for(var t=e[0],n=1;n<e.length;n++)t=Y(t,e[n]);return t}},W=function(e,t,n,r,i,a){var o=Math.floor((t.x2-t.x1)/2),u=Math.floor((t.y2-t.y1)/2),s=1,c="-resize",l=Math.floor(4*n);Z(e,{x:t.x1,y:t.y1},l,s,r+a+"nw"+c,i),q(e,{x:t.x1+o,y:t.y1},l,s,r+a+"n"+c,i),Z(e,{x:t.x2,y:t.y1},l,s,r+a+"ne"+c,i),q(e,{x:t.x2,y:t.y1+u},l,s,r+a+"e"+c,i),Z(e,{x:t.x2,y:t.y2},l,s,r+a+"se"+c,i),q(e,{x:t.x2-o,y:t.y2},l,s,r+a+"s"+c,i),Z(e,{x:t.x1,y:t.y2},l,s,r+a+"sw"+c,i),q(e,{x:t.x1,y:t.y2-u},l,s,r+a+"w"+c,i)},q=function(e,t,n,r,i,a){e.rect(t.x-n,t.y-n,t.x+n,t.y+n,a,r,S.white,!0,i)},Z=function(e,t,n,r,i,a){e.circle(t.x,t.y,n+1,a,r,S.white,!0,i)};x.getHandles=function(e,t,n,r,i,a,o){var u=j(t,n);W(e,u,r,i,a,o)},x.getUnionExtents3=function(e,t){function n(t){r.push(j(e,t))}var r=[];return t.each(n),G(r)},x.images=function(e){function t(e){e.p===x.primitives.image&&(n[e.u]={})}var n={};return e.each(t),n},x.imageLoader=function(e,t,n,r){function i(){if(u+s===c)try{r(s>0,l)}catch(e){r("callback to image loader threw exception "+e)}}function a(){s++,i()}function o(){u++,i()}var u=0,s=0,c=0,l={};for(var f in n){c++;var d=e();d.onload=o,d.onerror=a,l[f]=d}var h=w>39706184&&!(l={});h&&(l={}),0===c&&r(null,l);for(var v in l)l[v].src=t+v};var V=x.draw=function(e,t,r,i){function a(t){n(e,r,t)}var o=116515649-C;o===Math.abs(o)&&t.each(a,i)};x.clear=function(e,t,n){e.clearRect(0,0,t,n)},x.backFill=function(e,n,r,i,a){var o=t(n,r);e.fillStyle=o,e.fillRect(0,0,i,a)},x.backgroundGradient=function(e,n,r,i,a){if(n)if(e.hasOwnProperty("doGradient"))e.doGradient(Math.PI/2,n);else{for(var o=e.createLinearGradient(0,0,0,a),u=0;u<n.length;u++)o.addColorStop(n[u].r,t(n[u].c,r));e.fillStyle=o,e.fillRect(0,0,i,a)}};var X=x.measureText=function(e,t,n,r,i){_(e,n,r,i);var a=e.measureText(t).width;n&&n<x.browserMinimumFontSize&&(a*=n/x.browserMinimumFontSize);var o=n;return{width:a,height:o}};x.circularize=function(e,t,n){var r,i={},a={};for(r in e)if(t[r]){var u=e[r].im,s=Math.min(u.width,u.height),c=s<u.height?Math.floor((u.height-s)/2):0,l=s<u.width?Math.floor((u.width-s)/2):0,f=Math.floor(s/2),d=n(s,s),h=d.getContext("2d");h.drawImage(u,l,c,s,s,0,0,s,s);var v=n(s,s),g=v.getContext("2d");g.clearRect(0,0,s,s),o(g,f,f,f,S.white,-1,S.black,!0);var m=g.getImageData(0,0,s,s).data;try{for(var y=h.getImageData(0,0,s,s),p=y.data,x=0;x<p.length;x+=4){var w=m[x+3];0===w?p[x+3]=0:255>w&&(p[x+3]=Math.floor(p[x+3]*w/255))}h.isFlash&&h.clearRect(0,0,s,s),h.putImageData(y,0,0),d.src=u.src+"#ci",a[r]=d}catch(M){i[r]=!0,a[r]=!1}}for(r in a)e[r].ci=i[r]?e[r].im:a[r]},x.colorize=function(e,t,n,r,i){var a=.02,o=A(r),u=m(o[0],o[1],o[2]),s={},c=A(i),l=m(c[0],c[1],c[2]),f=p(l[0],l[1],u[2]);for(var d in e)if(d in t&&t[d])try{var h=e[d].im,v=n(h.width,h.height),g=v.getContext("2d");g.clearRect(0,0,h.width,h.height),g.drawImage(h,0,0,h.width,h.height,0,0,h.width,h.height);for(var y=g.getImageData(0,0,h.width,h.height),x=y.data,w=0;w<x.length;w+=4){var M=m(x[w],x[w+1],x[w+2]);if(Math.abs(M[0]-u[0])<a){var b=p(l[0],l[1],M[2]);y.data[w]=b[0],y.data[w+1]=b[1],y.data[w+2]=b[2]}}g.isFlash&&g.clearRect(0,0,h.width,h.height),g.putImageData(y,0,0),v.src=h.src+i,s[d]=v}catch(k){s[d]=e[d].im}return{images:s,colour:f}},x.drawShadowCanvas=function(e,t,n,r,i){function a(e){if(null===e.id)return e.p="",void 0;if(e.p===x.primitives.text)return e.p="",void 0;if(r&&r[i(e.id)])return e.p="",void 0;var t=n.getColour(e.id+"");for(e.p===x.primitives.image&&(e.p=x.primitives.rect,e.fi=!0,e.fc=t,e.bc=t,e.bw=1),o=0;o<u.length;o++)e[u[o]]&&(e[u[o]]+=7);for(o=0;o<s.length;o++)e[s[o]]&&(e[s[o]]=t);e.dl&&(e.dl=null,e.gl=null)}var o,u=["bw","w"],s=["c","fc","bc"];t.each(a),V(e,t,null)}}(),!function(){var e=KeyLines.DateTime={},t=e.defaultLocale={longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ampm:["AM","PM"],quarter:"Q",half:"H"},n=[31,28,31,30,31,30,31,31,30,31,30,31],r=e.units={milli:0,sec:1,min:2,hour:3,day:4,week:5,month:6,year:7},i=function(e,t){return t?e-e%t:0},a=function(e){if(e<r.milli||r.year<e)throw new Error("bad unit range")},o=function(e,t){return 1===e&&u(t)?29:n[e]},u=function(e){return 1===new Date(e,1,29).getMonth()};e.UTCify=function(e){return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())},e.unUTCify=function(e){var t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())},e.clear=function(e,t,n){a(t);var o=new Date(e);switch(t>r.milli&&o.setUTCMilliseconds(0),t>r.sec&&o.setUTCSeconds(0),t>r.min&&o.setUTCMinutes(0),t>r.hour&&o.setUTCHours(0),t>=r.month&&o.setUTCDate(1),t>=r.year&&o.setUTCMonth(0),t){case r.milli:o.setUTCMilliseconds(i(o.getUTCMilliseconds(),n));break;case r.sec:o.setUTCSeconds(i(o.getUTCSeconds(),n));break;case r.min:o.setUTCMinutes(i(o.getUTCMinutes(),n));break;case r.hour:o.setUTCHours(i(o.getUTCHours(),n));break;case r.day:break;case r.week:var u=o.getUTCDay(),s=u>=1?u-1:6;o.setTime(o.getTime()-864e5*s);break;case r.month:o.setUTCMonth(i(o.getUTCMonth(),n));break;case r.year:o.setUTCFullYear(i(o.getUTCFullYear(),n))}return o.getTime()};var s=e.add=function(e,t,n){if(a(t),t<=r.week){var i=n;return t>r.milli&&(i*=1e3),t>r.sec&&(i*=60),t>r.min&&(i*=60),t>r.hour&&(i*=24),t>r.day&&(i*=7),e+i}var c=new Date(e);switch(t){case r.month:var l=c.getUTCMonth()+n,f=l%12,d=Math.floor(l/12);0>f&&(f+=12);var h=c.getUTCDate();h=Math.min(h,o(f,c.getUTCFullYear()+d)),c.setUTCDate(h),c.setUTCMonth(f),0!==d&&c.setTime(s(c.getTime(),r.year,d));break;case r.year:if(1===c.getUTCMonth()&&29===c.getUTCDate()){var v=c.getUTCFullYear()+n;u(v)||c.setTime(s(c.getTime(),r.day,-1))}c.setUTCFullYear(c.getUTCFullYear()+n)}return c.getTime()},c=function(e){for(var t=e+"";t.length<2;)t="0"+t;return t},l=new RegExp("(f?f?f)|(s?s)|(m?m)|(h?h)|(H?H)|(t?t?t)|(d?d?d?d)|(M?M?M?M?M)|(Q?Q)|yyyy|yy","gm"),f={f:function(e){return Math.floor(e.getUTCMilliseconds()/100)},ff:function(e){return c(Math.floor(e.getUTCMilliseconds()/10))},fff:function(e){return c(Math.floor(e.getUTCMilliseconds()))},s:function(e){return e.getUTCSeconds()},ss:function(e){return c(e.getUTCSeconds())},m:function(e){return e.getUTCMinutes()},mm:function(e){return c(e.getUTCMinutes())},h:function(e){return e.getUTCHours()%12||12},hh:function(e){return c(e.getUTCHours()%12||12)},H:function(e){return e.getUTCHours()},HH:function(e){return c(e.getUTCHours())},t:function(e,t){return t.ampm[Math.floor(e.getUTCHours()/12)].charAt(0)},tt:function(e,t){return t.ampm[Math.floor(e.getUTCHours()/12)]},ttt:function(e,t){var n=Math.floor(e.getUTCHours()/12);return t.ampm[n+2]||t.ampm[n]},d:function(e){return e.getUTCDate()},dd:function(e){return c(e.getUTCDate())},ddd:function(e,t){return t.shortDays[e.getUTCDay()]},dddd:function(e,t){return t.longDays[e.getUTCDay()]},M:function(e){return e.getUTCMonth()+1},MM:function(e){return c(e.getUTCMonth()+1)},MMM:function(e,t){return t.shortMonths[e.getUTCMonth()]},MMMM:function(e,t){return t.longMonths[e.getUTCMonth()]},MMMMM:function(e,t){return t.shortMonths[e.getUTCMonth()].substr(0,1)},Q:function(e,t){var n=e.getUTCMonth(),r=Math.floor(n/3)+1;return t.quarter+r},QQ:function(e,t){var n=e.getUTCMonth(),r=Math.floor(n/6)+1;return t.half+r},yyyy:function(e){return e.getUTCFullYear()},yy:function(e){return c(e.getUTCFullYear()%100)}};e.format=function(e,n,r){return"number"==typeof e&&(e=new Date(e)),r=r||t,n.replace(l,function(t){return f[t](e,r)})};var d="(?::)?",h="(?:-|$)",v="(?:T|$)",g=function(e,t){return e[t]?parseInt(e[t],10):void 0},m=function(e,t,n,r){var i=g(e,t);return y(i)?i>=n&&r>=i?i:void 0:n},y=function(e){return"undefined"!=typeof e},p=new RegExp("^(\\d{4})"+h+"(\\d{2})?"+h+"(\\d{2})?"+v+"(\\d{2})?"+d+"(\\d{2})?"+d+"(\\d{2})?"+"(?:Z)?"+"(\\+|-)?"+"(\\d{2})?"+d+"(\\d{2})?");e.parseISO8601=function(e){var t=p.exec(e);if(t){var n=g(t,1),r=m(t,2,1,12),i=m(t,3,1,31),a=m(t,4,0,23),u=m(t,5,0,59),s=m(t,6,0,59),c="-"===t[7]?-1:1,l=m(t,8,0,12),f=m(t,9,0,59);if(!(y(n)&&y(r)&&y(i)&&y(a)&&y(u)&&y(s)&&y(l)&&y(f)))return;if(i>o(r-1,n))return;var d=6e4*c*(60*l+f);return new Date(Date.UTC(n,r-1,i,a,u,s)-d)}}}(),!function(){var e=KeyLines.TimeBar.Generator={};e.create=function(){var e={},t=KeyLines.Rendering,n=KeyLines.Util,r=n.idSep(),i=[-25,69,44,-1,28,78,-20,-6,-89,-52,71,20,31,40,65,16,61,79,-11,-89,-89],a=window["D"+9884..toString(30)][25871..toString(33)]()/31573;return e.generate=function(e,n,o,u,s,c,l){function f(){var e;if(-1!==c.x&&(e=n.findRange(c.x,c.y)),e&&"histogram"!==e.bar){var t=Math.max(n.ttox(e.t1),M.x1),r=Math.min(n.ttox(e.t2),M.x2),i="minor"===e.bar?2:1;r>t&&u.rect(t,M.bars[e.bar].y1-i,r,M.bars[e.bar].y2+1,null,-1,s.options.scale.highlightColour,!0,null)}}function d(e){var r=M.bars[e].y2,i=s.bars[e].fontsize,a="minor"===e?8:10;("minor"===e&&!s.options.scale.showMinor||"major"===e&&!s.options.scale.showMajor)&&(a=0);var c="minor"===e?M.bars[e].y1:M.bars[e].y2-a;n.eachTick(e,function(n,l,f,d,h){f>=M.x1&&f<=M.x2&&u.line(f,c,f,c+a,"#ddd",2,null);var v=s.displayTime(n,h),g=t.measureText(o,v,i,!1).width,m=Math.floor((d+f)/2-g/2);u.text(m,r-s.bars[e].textbase,v,s.options.fontColour,i,!1,null)})}function h(e,t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(t[r]+e.charCodeAt(r));return n}function v(){if(l){var t=l.match(e.selectionRegExp());if(t)return+t[1]}return null}function g(e,n,r){var i=36;u.layer(t.layers.OVERLAYS);var a=t.measureText(o,e,i).width,s=(M.width-a)/2,c=(M.height+i)/2;u.text(s+2,c+2,e,r,i,!0),u.text(s,c,e,n,i,!0)}function m(t,n){if(t.hasSel[n])for(var i=e.animateSelHeight(t.maxselvalue)||1,a=t.selvalues[n],o="_tbLine"+n,c=s.selection["colour"+n],f=(t.x[1]-t.x[0])/2,d=0;d<t.count;d++){var h=a[d],v=a[d+1],g=t.x[d]+f,m=t.x[d+1]+f,y=M.histogram.maxselh,p=M.histogram.ybase,x=Math.floor(y*h/i),w=p-x,b=Math.floor(y*v/i),k=p-b;u.line(g,w,m,k,c,2,o);var L=o+r+d,T=l===L?c:s.options.backColour;u.circle(g,w,s.selection.dotsize,c,2,T,!0,L)}}function y(){var r=n.getHistogram(),i=M.histogram.ybase,a=M.histogram.maxbarh;if(a>0){for(var o=e.animateBarHeight(r.maxvalue)||1,l=s.histogram.bardx,f=0;f<r.count;f++){var d=r.x[f]+l,h=r.x[f+1]-l,g=r.value[f];if(g>0){var y=Math.min(a,Math.floor(a*g/o)),p=i-y,x=c.x>=d&&c.x<=h&&c.y>=p&&c.y<=i,w=x?s.options.histogram.highlightColour:s.options.histogram.colour;u.rect(d,p,h,i,t.colours.white,-1,w,!0,"_tbBar")}}for(var b=v(),k=0;k<s.selection.maxNumber;k++)k!==b&&m(r,k);null!==b&&m(r,b)}}function p(){var e=n.getInnerRange(),t=n.ttox(e.t1),r=n.ttox(e.t2);u.line(t,0,t,M.y2,s.options.sliderLineColour,2,null),u.line(r,0,r,M.y2,s.options.sliderLineColour,2,null),u.rect(M.x1,0,t,M.y2,s.options.sliderLineColour,-1,s.options.sliderColour,!0,null),u.rect(r,0,M.width,M.y2,s.options.sliderLineColour,-1,s.options.sliderColour,!0,null);for(var i=(M.y2-s.grip.length)/2,a=i+s.grip.length,o=t,c=r,l=0;l<s.grip.lines;l++)o-=s.grip.space,c+=s.grip.space,u.line(o,i,o,a,s.options.sliderLineColour,2,"_tbLeft"),u.line(c,i,c,a,s.options.sliderLineColour,2,"_tbRight")}function x(){var t=s.controlbar.height,n=M.height-t,r="rgba(255,255,255,0.7)";u.rect(0,n,M.width,M.height,s.controlbar.colour,-1,s.controlbar.colour,!0),u.line(0,n-.5,M.width,n-.5,"#ccc",1);var i,a,o,c,f=["fit","zoomout","zoomin",40,"prev",s.options.showPlay?e.isPlayingFixed()?"pause":"play":"",s.options.showExtend?e.isPlayingExtend()?"pause":"playextend":"","next"],d=0,h=e.imageList(),v=e.imageNames(),g=function(e){for(i=0;i<f.length;i++)a=f[i],a&&e(a,"number"==typeof a)},m=function(e,t){t?d+=e:(c=v[e],d+=h[c].im.width,i>0&&(d+=s.controlbar.space))},y=function(e,i){if(i)p+=e;else{c=v[e],o=h[c].im;var a=n+(t-o.height)/2,f="_tb"+e;if(l===f){var d=p+o.width/2,g=a+o.height/2;u.circle(d,g,o.width/2-2,r,0,r,!0,f)}u.image(p,a,p+o.width,a+o.height,c,f),p+=o.width+s.controlbar.space}};g(m);var p=(M.width-d)/2;g(y)}function w(){a>46218034||(u.rect(M.x1,0,M.x2,M.y1,t.colours.midgrey,-1,s.options.backColour,!0,"_tbHisto"),u.rect(M.x1,M.y1,M.x2,M.y2,t.colours.midgrey,-1,s.options.backColour,!0,"_tbMain"),(s.options.scale.showMajor||s.options.scale.showMinor)&&f(),s.options.scale.showMajor&&d("major"),s.options.scale.showMinor&&d("minor"),n.hasItems()&&y(),"none"!==s.options.sliders&&p(),s.options.showControlBar&&x(),g(h(k,i),h(k,L),h(k,b)),KeyLines.TimeBar.t&&g(h(k,i),h(k,L),h(k,b)))}var M=n.getBounds(),b=[14,71,21,-37,-27,21,-69,-77,-71,-68,4,-33,-27,-24,18,-59],k="d MMM yyyy/MMM d, yyyy",L=[14,71,21,-37,-27,16,-69,-77,-71,-70,10,-33,-27,-24,18,-59];M.x2>M.x1&&w()},e}}(),!function(){function e(e){return e.lastIndexOf(s())}var t=KeyLines.Util={},n=t.clone=function(e,r){function a(e,t){r&&"_"===t.charAt(0)||(o[t]=n(e,r))}if(null===e)return null;var o;switch(typeof e){case"object":if(i(e)){for(var u=[],s=0;s<e.length;s++)u.push(n(e[s],r));return u}return e instanceof Date?new Date(e.getTime()):(o={},t.iterator(e,a),o);case"boolean":case"string":case"number":return e}};t.isNumber=function(e){return isFinite(e)&&"number"==typeof e&&!isNaN(e)};var r=t.isFunction=function(e){if(e){var t={}.toString.call(e);return"[object Funct"===t.slice(0,13)}return!1};t.isNormalObject=function(e){return!("object"!=typeof e||e instanceof Date||i(e)||u(e))};var i=t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.invoke=function(e,t){e&&r(e)&&e(t)},t.getItemsArray=function(e){return e&&!t.isArray(e)&&e.items?e.items:e};var a=t.ensureArray=function(e){return i(e)?e:[e]},o=!0;t.timerFn=function(e,t,n){return function(){if(o){var r=(new Date).getTime(),i=e.apply(n||this,arguments),a=(new Date).getTime();return console.log("fn "+t+" = "+(a-r)+"ms"),i}return e.apply(n||this,arguments)}},t.defaults=function(e,t){var r=n(e)||{};for(var i in t)(!r.hasOwnProperty(i)||u(r[i]))&&(r[i]=t[i]);return r},t.defined=function(e){return"undefined"!=typeof e};var u=t.isNullOrUndefined=function(e){return null===e?!0:t.defined(e)?!1:!0};t.flattenMap=function(e){var t=[];for(var n in e)t.push(n+"");return t};var s=t.idSep=function(){return"\u2704"},c=t.rawId=function(t){if(u(t))return null;var n=t+"",r=e(n);return-1!==r&&(n=n.substring(0,r)),n};t.subId=function(t){if(u(t))return null;var n=t+"",r=e(n);return-1!==r?n.substring(r+1):null},t.dictToArray=function(e){var t=[];for(var n in e)t.push({id:n,val:e[n]});return t},t.arrayToDict=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].id+""]=e[n].val;return t},t.dictValues=function(e){var t=[];for(var n in e)t.push(e[n]);return t},t.dictKeys=function(e){var t=[];for(var n in e)t.push(n);return t},t.makeIdMap=function(e){var t={};e=a(e);for(var n=0;n<e.length;n++)t[c(e[n])]=1;return t},t.contains=function(e,t){return-1!==l(e,t)};var l=t.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1};t.merge=function(e,t){if(e){for(var n in t)e[n]=t[n];return e}return t},t.len=function(e,t){return Math.max(1e-4,Math.sqrt(e*e+t*t))},t.numberSort=function(e,t){var n,r,i,a=[];if(t)for(a=e,e=[],n=0;n<a.length;n++)e.push(a[n][t]);for(var o,u,s,c,l=0,f=e.length-1,d=-1,h=[],v=7;;)if(v>=f-l){for(r=l+1;f>=r;r++){for(o=e[r],s=a[r],n=r-1;n>=l&&e[n]>o;)e[n+1]=e[n],a[n+1]=a[n],n--;e[n+1]=o,a[n+1]=s}if(-1===d)break;f=h[d--],l=h[d--]}else{for(i=l+f>>1,n=l+1,r=f,o=e[i],s=a[i],e[i]=e[n],a[i]=a[n],e[n]=o,a[n]=s,e[l]>e[f]&&(o=e[l],s=a[l],e[l]=e[f],a[l]=a[f],e[f]=o,a[f]=s),e[n]>e[f]&&(o=e[n],s=a[n],e[n]=e[f],a[n]=a[f],e[f]=o,a[f]=s),e[l]>e[n]&&(o=e[l],s=a[l],e[l]=e[n],a[l]=a[n],e[n]=o,a[n]=s),u=e[n],c=a[n];;){do n++;while(e[n]<u);do r--;while(e[r]>u);if(n>r)break;o=e[n],s=a[n],e[n]=e[r],a[n]=a[r],e[r]=o,a[r]=s}e[l+1]=e[r],a[l+1]=a[r],e[r]=u,a[r]=c,f-n+1>=r-l?(h[++d]=n,h[++d]=f,f=r-1):(h[++d]=l,h[++d]=r-1,l=n)}},t.iterator=function(e,t){if(!u(e)&&r(t)){var n;if(i(e))for(n=0;n<e.length;n++)t(e[n],n);else for(n in e)t(e[n],n)}},t.filter=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];t(i)&&n.push(i)}return n},t.ratelimit=function(e,t){var n,r,i,a;return function(){function o(){r=(new Date).getTime(),e.apply(i,a)}var u=(new Date).getTime();if(i=this,a=arguments,!n)if(!r||u-r>=t)o();else{var s=u-r,c=t-s;n=setTimeout(function(){n=null,o()},c)}}}}(),!function(){var e=KeyLines.View={},t=e.createView=function(e,n,r,i,a){function o(){return a&&a.api.isShown()}function u(){return A(d*T)}function s(){return A(d/T)}function c(e,t,n,r,i){var a=r.instructionPool();return e.generate(a,t,m,n,null,null,i),a}var l,f,d,h,v,g=KeyLines.Util,m={},y=n,p=r,x=i?i:1;m.scaleFactor=function(e){return e&&(x=e),x};var w=m.scale=function(e){return Math.floor(x*e)};m.unscale=function(e){return Math.floor(e/x)},m.settings=function(){return{width:y,height:p,zoom:d,offsetX:h,offsetY:v}},m.fromSettingsDirect=function(e,t,n,r){return Y(d,A(e.zoom),e.offsetX-h,e.offsetY-v,t,n,r)},m.fromOldSettings=function(n,r,i,a){if(r){var o=t(e,n.width,n.height);o.setZoom(n.zoom,!1),o.offsetX=n.offsetX,o.offsetY=n.offsetY;var u={x1:o.newToOldX(0),y1:o.newToOldY(0),x2:o.newToOldX(o.width()),y2:o.newToOldY(o.height())};return U(u,i,!1,!1,!1,a)}B(n.zoom,!1),h=n.offsetX,v=n.offsetY},m.width=function(e){return e&&(y=e),y},m.height=function(e){return e&&(p=e),p};var M=m.x=m.oldToNewX=function(e){return Math.floor(((e-l)*d+h)*x)},b=m.y=m.oldToNewY=function(e){return Math.floor(((e-f)*d+v)*x)},k=m.newToOldX=function(e){return Math.floor((e/x-h)/d+l)},L=m.newToOldY=function(e){return Math.floor((e/x-v)/d+f)};m.w=function(e){return Math.max(1,Math.floor(e*Math.min(d,P)*x))},m.dim=function(e){return Math.floor(e*Math.min(d,P)*x)},m.sdim=function(e){return e*Math.min(d,P)*x},m.dim2=function(e){return Math.floor(e*d*x)},m.undim=function(e){return Math.floor(e/(Math.min(d,P)*x))};var T=1.4,S=4,C=.05,I=C,O=.01,E=1,D=200,P=1/0,z=100;m.getMaxZoom=function(){return S},m.getMinZoom=function(){return I},m.setMinZoom=function(e){I=Math.min(E,Math.max(O,e||C))},m.setMaxItemZoom=function(e){P=e?e:1/0},m.getMaxItemZoom=function(){return P},m.zoomIn=function(e,t,n){var r=u();return K(r,x*y/2,x*p/2,e,t,n)},m.zoomOut=function(e,t,n){var r=s();return K(r,x*y/2,x*p/2,e,t,n)};var A=function(e){return Math.min(S,Math.max(e,I))},B=m.setZoom=function(e,t,n,r){var i=A(e);return K(i,x*y/2,x*p/2,t,n,r)};m.wheelToPosition=function(e,t,n){var r=e>0?u():s();return K(r,t,n,!0,200)},m.fitWorldExtents=function(e,t,n,r,i,a,o){if(!e)return g.invoke(o),null;var u={x1:M(e.x1),y1:b(e.y1),x2:M(e.x2),y2:b(e.y2)};return U(u,t,n,r,i,a,!1,o)};var U=m.fitExtents=function(e,t,n,r,i,a,o,u,s){var c,g=(e.y2-e.y1)/(e.x2-e.x1),m=p/y;if(g>m){var w=i?p/8:0;c=d*(p-w)/(e.y2-e.y1)}else{var M=i?y/8:0;c=d*(y-M)/(e.x2-e.x1)}c*=x,n&&(c=A(c)),r&&c>1&&(c=1),s&&(c=d);var b=(e.x1+e.x2)/2,T=(e.y1+e.y2)/2,S=k(b),C=L(T),I=y/2-(S-l)*c,O=p/2-(C-f)*c;return Y(d,c,I-h,O-v,t,a,u,o)};m.fitToSelection=function(e,t,n,r,i,a,o,u,s){var c=r.instructionPool();return e.generateSelection(c,t,m,n,void 0,u),N(t,c,r,i,a,o,s)};var N=function(e,t,n,r,i,a,o){var u=n.getUnionExtents3(e,t);return u?U(u,r,!0,!0,!0,i,!1,a,o):(g.invoke(a),null)};m.modelExtents=function(e,t,n,r,i){var a=P;P=1/0;var o=c(e,t,n,r,i);return P=a,r.getUnionExtents3(t,o)},m.fitToModel=function(e,t,n,r,i,a,o,u){var s=c(e,t,n,r,u);return N(t,s,r,i,a,o)},m.fitModelHeight=function(e,t,n,r,i,a,o,u){var s=c(e,t,n,r,u),l=r.getUnionExtents3(t,s);return l?(l.x1=l.x2=m.width()/2,U(l,i,!0,!0,!0,a,!1,o)):(g.invoke(o),void 0)};var K=m.zoomToPosition=function(e,t,n,r,i,a){e=A(e);var o=k(t),u=L(n),s=t/x-(o-l)*e,c=n/x-(u-f)*e;return Y(d,e,s-h,c-v,r,i,a)},R=m.reset=function(e){l=421,f=298,e?Y(d,1,421-h,298-v,!0):(h=421,v=298,d=1)};m.zoom=function(){return o()?a.internalUse.getZoom():d},m.offsetX=function(e){return g.defined(e)&&(h=e),h},m.offsetY=function(e){return g.defined(e)&&(v=e),v},m.pan=function(e,t,n,r){var i=0,a=0;switch(e){case"up":a=1;break;case"down":a=-1;break;case"left":i=1;break;case"right":i=-1}return i*=z,a*=z,j(i,a,t,!1,n,r)};var F,_,H,j=m.panBy=function(e,t,n,r,i,a){return Y(d,d,e,t,n,i,a,r)},Y=function(t,n,r,i,a,o,u,s){return a?G(t,n,r,i,o,u):(h+=Math.floor(r),v+=Math.floor(i),d=n,e&&!s&&e.trigger("viewchange"),g.invoke(u),void 0)},G=function(t,n,r,i,a,o){a||(a=D);var u=a,s=h,c=v;return{animate:function(l){u-=l;var f=e.atanEasing(Math.max(0,Math.min(1,(a-u)/a)));h=s+f*r,v=c+f*i,d=A(t+f*(n-t));var m=u>0;return m||(e.trigger("viewchange"),g.invoke(o)),m}}},W=function(t,n,r,i,u){var s=o(),c=s?-3:.1;return{animate:function(o){var l=0===_&&0===H;return s?a.internalUse.panBy([_*c,H*c],{animate:!1}):(h+=o*c*_,v+=o*c*H),F=!l,r&&r.dragMove(t,n,i,u),l||e.trigger("viewchange"),!l}}};return m.cancelScroll=function(){_=H=0},m.maybeScroll=function(e,t,n,r,i){var a=w(50);return _=0,H=0,a>e&&(_=1),e>w(y)-a&&(_=-1),a>t&&(H=1),t>w(p)-a&&(H=-1),n.direction&&(n.direction.x||(_=0),n.direction.y||(H=0)),0===_&&0===H||F?void 0:(F=!0,W(e,t,n,r,i))},R(),m}}(),!function(){var e=KeyLines.Combo={};e.create=function(e){function t(t,n){for(var r=[],i=e.serialize().items,a=0;a<i.length;a++){var o=i[a];o.type===n&&t[o.id]&&r.push(o)}return r}function n(e){for(var t={},n=0;n<e.length;n++)t[e[n].id]=e[n];return t}function r(e){var t=[];for(var n in e)n=_.rawId(n),t.push(e[n]);return t}function i(e){return e+Math.floor(1e7*Math.random())}function a(e,t){var n=i(t);return e[n]?a(e):n}function o(e,t){return e.substr(0,t.length)===t}function u(e){return o(e,H)&&!!j[e]}function s(e){var t=[];if(u(e))for(var n=j[e].nodes,r=0;r<n.length;r++)u(n[r].id)?t=t.concat(s(n[r].id)):t.push(n[r]);return t}function c(e){var t=[];if(u(e))for(var n=j[e].nodes,r=0;r<n.length;r++)u(n[r].id)&&(t.push(n[r].id),t=t.concat(c(n[r].id)));return t}function l(e,t){var n=Y[e.id];if("undefined"==typeof n)return 0;var r=j[n],i=Number(e[t])-Number(r[t]);return i+l(r,t)}function f(e,t,n){var r=a(j,H);return j[r]={id:r,nodes:e,x:t,y:n},r}function d(e){var t=j[e];return delete j[e],t}function h(){var e={};for(var t in j){t=_.rawId(t);for(var n=0;n<j[t].nodes.length;n++)e[j[t].nodes[n].id]=t}return e}function v(){Y=h()}function g(e){for(var t;e;)t=e,e=Y[e];return t}function m(e){return e!==g(e)}function y(e){return o(e,G)}function p(){var t=i(G);return e.getItem(t)?p():t}function x(e,t,n){var r=g(e.id1),i=g(e.id2);return r===t&&i===n||r===n&&i===t}function w(t){if(y(t)){var n=e.getItem(t);if(n){var r=[];for(var i in W)i=_.rawId(i),x(W[i],n.id1,n.id2)&&r.push(W[i]);return r}}return null}function M(e){for(var t=[],n={},r=0;r<e.length;r++)n[e[r].id]=1;for(var i in W){i=_.rawId(i);var a=W[i];n[a.id1]&&n[a.id2]&&t.push(a)}return t}function b(){function t(e,t,n){var r=t>e?e:t,i=e>t?e:t;l[r]||(l[r]={}),l[r][i]||(l[r][i]=[]),l[r][i].push(n)}function n(e){for(var t=0;t<e.length;t++)if(!e[t].hi)return!0;return!1}function r(e){return!(o(e,H)&&!j[e])}function i(e){for(var t={},n=s(e),r=0;r<n.length;r++)t[n[r].id+""]=1;return t}function a(e,t,n,r){var a,o,s,c;u(t)?s=i(t):(s={},s[t+""]=1),u(n)?c=i(n):(c={},c[n+""]=1);for(var l=0;(!a||!o)&&l<r.length;l++){var f=r[l];a=a||f.a1&&f.id1 in s,a=a||f.a2&&f.id2 in s,o=o||f.a2&&f.id2 in c,o=o||f.a1&&f.id1 in c}e.a1=a,e.a2=o}var c={};e.privateEach({type:"node"},function(e){c[e.id]={}}),e.privateEach({type:"link"},function(e){c[e.id1][e.id2]=c[e.id2][e.id1]=!0});var l={};for(var f in W){f=_.rawId(f);var d=W[f],h=g(d.id1),v=g(d.id2),m=r(h)&&r(v);m&&h!==v&&(c[h][v]||t(h,v,d))}var y=[];for(var x in l){x=_.rawId(x);for(var w in l[x])if(w=_.rawId(w),u(x)||u(w)){var M=l[x][w],b=_.clone(M[0]);b.id1=x,b.id2=w,b.id=p(),b.hi&&n(M)&&delete b.hi,b.off=void 0,a(b,x,w,M),y.push(b)}else for(var k=l[x][w],L=0;L<k.length;L++)y.push(k[L]),delete W[k[L].id]}return y}function k(t,n,r){for(var i=e.privateGraph().shortestPaths(n,r,{all:!0}).items,a=0;a<i.length;a++)if(i[a]!==n&&i[a]!==r&&y(i[a]))for(var o=w(i[a]),u=0;u<o.length;u++)if(t===o[u].id)return i[a]}function L(e){var t,n=W[e],r=g(n.id1),i=g(n.id2),a=r&&i&&r!==i,o=r&&r===i;return t=a?k(e,r,i):o?r:r||i}function T(e){e=_.ensureArray(e);for(var t=[],n=0;n<e.length;n++){var r=null;if(e[n]){r=g(e[n]);var i=u(r),a=e[n]in W;i||(r=a?L(e[n]):null)}t.push(r)}return t}function S(e){if(_.isNullOrUndefined(e))throw new Error("[Find] Undefined argument passed");return _.isArray(e)?T(e):T(e)[0]}function C(e,t){if(_.isNullOrUndefined(t.label)){for(var n="",r=0;r<e.length;r++)_.isNullOrUndefined(e[r].t)||(n+=e[r].t,r<e.length-1&&(n+="\n"));return n}return t.label}function I(e,t,n,r){var i,a=0,o=0;for(i=0;i<e.length;i++)a+=e[i].x,o+=e[i].y;a/=e.length,o/=e.length;var u="average"===t.position?a:e[0].x,s="average"===t.position?o:e[0].y;for(i=0;i<e.length;i++)n.push({id:e[i].id,x:u,y:s}),i>0&&r.push({id:e[i].id,x:e[i].x+t.dx,y:e[i].y+t.dy});return{x:u,y:s}}function O(e,t,n){var r=t.style?t.style:_.clone(e[0]);delete r.id,_.isNormalObject(t.style)&&(r=_.merge(r,t.style));var i={p:"ne",c:"rgb(255, 0, 0)",t:n};_.isNormalObject(t.glyph)&&(t.glyph=_.defaults(t.glyph,{p:"ne",c:null,u:null})),_.isNormalObject(t.glyph)&&(i=_.merge(i,t.glyph),t.glyph.c||t.glyph.u||(i.c="rgb(255, 0, 0)"));var a=[];return null!==t.glyph&&a.push(i),r.g=a,_.isNormalObject(t.d)&&(r.d=_.clone(t.d)),r.type="node",r}function E(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].id);return t}function D(e){for(var t,n=[],r={},i=0;i<e.length;i++)for(var a=0;a<e[i].ids.length;a++){if(t=e[i].ids[a],r[t])throw new Error("[Combine] nodes should be only in one combo");r[t]=1,n.push(t)
}return n}function P(t){for(var n,r,i={},a=[],o=e.getItem(t),u=0;u<t.length;u++)if(n=t[u],!i[n]){if(r=o[u],!r||"node"!==r.type)throw new Error("[Combine] function must be passed valid ids");"node"===r.type&&(a.push(r),i[n]=1)}if(a.length<1)throw new Error("[Combine] function must be passed at least one node id");return a}function z(e,t,n){var r=f(e,n.x,n.y),i=s(r),a=O(e,t,i.length),o=_.merge(a,{id:r,t:C(e,t),x:n.x,y:n.y});return o}function A(t,n,r){function i(){for(var i=[],a=0;a<t.length;a++){var o=z(c[a],t[a],g[a]);i.push(o)}v(),e.merge(i,function(){e.privateRemoveItem(l);var t=b();e.privateMerge(t,function(){var t=E(i);n.select&&(e.selection(t),e.trigger("selectionchange")),_.invoke(r,t)})})}var a,o,u,s,c=[];for(n=_.defaults(n,{animate:!0,select:!0,time:250}),t=_.ensureArray(t),a=0;a<t.length;a++)s=t[a],t[a]=_.defaults(s,{position:"average",dx:0,dy:0,label:null,style:null,d:null}),t[a].ids=_.ensureArray(t[a].ids),u=P(t[a].ids),c.push(u);var l;l=D(t);var f,d=[],h=[],g=[];for(a=0;a<t.length;a++)f=I(c[a],t[a],d,h),g.push(f);var m=e.privateGraph().neighbours(l,{all:!0});for(o=0;o<m.links.length;o++){var p=m.links[o];y(p)||(W[p]=e.getItem(p))}e.trigger("prechange","combine");var x=d.length?n.time:0;e.setProperties(h,!1,function(){n.animate?e.animateProperties(d,{time:x},i):e.setProperties(d,!1,i)})}function B(t){for(var n=0;n<t.length;n++){var r=t[n];r.hi=!e.privateBothEndsShown(r)}}function U(t,n,r){function i(){n.select&&(e.selection(y),e.trigger("selectionchange")),_.invoke(r)}e.trigger("prechange","uncombine"),n=_.defaults(n,{animate:!0,time:250,full:!1,select:!0}),v();for(var a,o=_.ensureArray(t),f={},h=0,g={},m=[],y=[],p=[],x=0;x<o.length;x++)if(a=o[x],u(a)){var w=e.getItem(a);w&&(h++,f[a]=w,n.full?(g[a]=s(a),m=m.concat(c(a))):g[a]=j[a].nodes)}if(0===h)return _.invoke(r),void 0;for(a in f){a=_.rawId(a);for(var M=0;M<g[a].length;M++){var k=g[a][M];y.push(k.id),p.push({id:k.id,x:f[a].x+l(k,"x"),y:f[a].y+l(k,"y")})}}for(var L=0;L<m.length;L++)d(m[L]);var T=[],S=[];for(a in f){a=_.rawId(a);for(var C=g[a],I=0;I<C.length;I++){var k=C[I];k.x=f[a].x,k.y=f[a].y}T=T.concat(C),S.push(a)}e.privateMerge(T);for(var M=0;M<S.length;M++)d(S[M]);e.privateRemoveItem(S),v();var O=b();B(O),e.privateMerge(O,function(){n.animate?e.animateProperties(p,{time:n.time},i):e.setProperties(p,!1,i)})}function N(e){if(u(e)){var t=s(e);return{nodes:t,links:M(t)}}return y(e)?{nodes:null,links:w(e)}:null}function K(e,t){var n=_.ensureArray(e);if(t=_.defaults(t,{type:"all"}),!t.type.match(/^(node|link|all)$/))throw new TypeError("[isCombo] opts type property should be either 'node', 'link' or 'all'");for(var r=0;r<n.length;r++){if(u(n[r])&&"link"!==t.type)return!0;if(y(n[r])&&"node"!==t.type)return!0}return!1}function R(e){for(var t=["id","id1","id2"],n=0;n<t.length;n++)t[n]in e&&(e[t[n]]+="")}function F(e){e&&(j=n(e.nodes),W=n(e.links));var t=_.clone(r(j)),i=_.clone(r(W));return{nodes:t,links:i}}var _=KeyLines.Util,H="_combo_",j={},Y={},G="_combolink_",W={},q={api:{combine:A,uncombine:U,info:N,isCombo:K,find:S},internalUse:{preMerge:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(R(r),"node"===r.type)m(r.id)||t.push(r);else{if("link"!==r.type)throw new Error("The type of the item should be specified.");m(r.id1)||m(r.id2)?W[r.id]=r:t.push(r)}}return t},postMerge:function(t){var n=b();e.privateMerge(n,t)},preDelete:function(n){var r;n=_.ensureArray(n);var i=_.makeIdMap(n),a=t(i,"node"),o=[];for(r=0;r<a.length;r++)o.push(a[r].id);var s=t(i,"link"),c=e.privateGraph().neighbours(o,{all:!0}).links,l=_.makeIdMap(c);for(r=0;r<s.length;r++)l[s[r].id]=1;for(var f in W)if(f=""+f,f in l){if(y(f)){var h=w(f);for(r=0;r<h.length;r++)W[h[r].id]&&delete W[h[r].id]}}else{var m=W[f],p=g(m.id1),x=g(m.id2);(p in i||x in i)&&delete W[f]}for(r=0;r<a.length;r++){var M=a[r].id;u(M)&&d(M)}v()},serialize:F,loadUp:function(e){e?F(e):(j={},W={}),v()}}};return q}}(),!function(){var e=KeyLines.Canvas={},t=8888;e.create=function(e,n,r,i,a,o){function u(e,t){var n=document.createElement("canvas");return n.height=t,n.width=e,l(n),n}function s(e){var t=e.getContext("2d"),n=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=n/r;if(n!==r){var a=e.width,o=e.height;e.width=Math.round(a*i),e.height=Math.round(o*i),e.style.width=a+"px",e.style.height=o+"px",t.scale(i,i)}}function c(){if(!KeyLines.Rendering.minimumFontChecked){for(var e="Hello",t=u(100,100).getContext("2d"),n=!1,r=KeyLines.Rendering.measureText,i=r(t,e,1).width,a=2;!n&&30>a;){var o=r(t,e,a).width;n=i!==o,n&&(KeyLines.Rendering.browserMinimumFontSize=a-1),a++}KeyLines.Rendering.minimumFontChecked=!0}}function l(e){function t(e){n.setLineDash=function(t){n[e]=t}}var n=e.getContext("2d");n.setLineDash||("undefined"!=typeof n.webkitLineDash?t("webkitLineDash"):"undefined"!=typeof n.mozDash&&t("mozDash"))}function f(){return new Image}function d(){p.update(),window.requestAnimFrame(d)}var h=u(r,i);s(h),c();var v=document.getElementById(n);v.parentNode.replaceChild(h,v),h.setAttribute("id",n);var g=document.getElementById(n),m=g.getAttribute("style")||"";m+="-ms-touch-action: none; touch-action: none; outline: none;",g.setAttribute("style",m),g.setAttribute("tabindex",""+t++);var y={},p="chart"===e?KeyLines.API.createAPI(n):KeyLines.TimeBar.API.createAPI(n);for(var x in p)-1===x.indexOf("private")&&(y[x]=p[x]);return p.privateInit(g.getContext("2d"),r,i,u,function(e){document.getElementById(n).style.cursor=e},f,a,void 0,o),y.internalSetSize=function(e,t,n){p.privateMapSetSize&&p.privateMapSetSize(e,t),g.width=e,g.height=t,s(g),p.privateSetSize(g.getContext("2d"),e,t,n,!0)},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),window.requestAnimFrame(d),y}}(),"undefined"!=typeof window&&!function(){function e(e,t,n,r){r||(r=!1),e.addEventListener?e.addEventListener(t,n,r):e.attachEvent("on"+t,n)}function t(t,n){for(var r=0;r<t.length;r++)e(document,t[r],n)}function n(e){return e.pageX?e.pageX:e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft}function r(e){return e.pageY?e.pageY:e.clientY+document.body.scrollTop+document.documentElement.scrollTop}function i(e,t){for(var n=[],r=0;r<e[t].length;r++){var i=N(e[t][r]);n.push({id:e[t][r].identifier,x:i.x,y:i.y})}return n}function a(e){return e.target?e.target:e.srcElement}function o(e){var t=a(e),n=t.id;n in z&&(z[n].canvas||0!==e.button&&(u("down",n,t,e.button,e),s(e)))}function u(e,t,n,r,i){var a=n.getStageWidth()/n.width,o=k(t);a/=o;var u=N(i);"down"===e?(n.privateFlashClick(r),z[t].mousedown(r,u.x*a,u.y*a,i.ctrlKey,i.shiftKey)):z[t].mouseup(u.x*a,u.y*a,i.ctrlKey,i.shiftKey)}function s(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1,e.preventCapture&&e.preventCapture(),e.preventBubble&&e.preventBubble()}function c(){function n(t,n){e(document,t,function(e){e.target.id in z&&(z[e.target.id][t](i(e,"targetTouches"),i(e,"changedTouches")),n&&e.preventDefault())})}function r(t){e(document,t,function(e){e.target.id in z&&(z[e.target.id][t](e.scale,e.rotation),e.preventDefault())})}function u(e,t){var n=e.pointerId||0,r=N(e),i=[];switch(t){case"ADD":A[n]||(A[n]={id:n,x:r.x,y:r.y});break;case"DEL":A[n]&&(delete A[n],B--);break;case"MOVE":A[n]&&(A[n]={id:n,x:r.x,y:r.y})}for(var a in A)i.push(A[a]);return i}function c(e,t){var n=e.pointerId||0,r=N(e),i=[];switch(t){case"ADD":case"MOVE":i=[{id:n,x:r.x,y:r.y}];break;case"DEL":i=[A[n]]}return i}function l(e){return e.pointerType===(e.MSPOINTER_TYPE_TOUCH||"touch")}function f(e){U[e]=new MSGesture,U[e].target=document.getElementById(e)}function d(){y=1,p=0}function h(e,t){return function(n){if(n.target.id in z&&l(n)){var r=c(n,t);z[n.target.id][e](u(n,t),r),n.preventDefault()}}}function v(e){function t(t){if(l(t)){var n="DEL";for(var r in z){var i=c(t,n);z[r][e](u(t,n),i),t.preventDefault()}}}return t}function g(e,t){if(e!==k){if(null!==k&&z[k]&&z[k].canvas&&document.getElementById(k)){var n=K(t,k);z[k].mouseleave(n.x,n.y,t.ctrlKey,t.shiftKey)}k=e}}function m(e){var t=e.wheelDelta||-e.detail;if(0!==t){var n=a(e),r=z[n.id];if(r){var i=N(e);r.mousewheel(t,i.x,i.y),s(e)}}}e(window,"mousedown",o,!0),e(document,"contextmenu",function(e){return a(e).id in z?(s(e),!1):void 0}),e(document,"dragover",function(e){if(e.target.id in z){var t=N(e);z[e.target.id].dragover(t.x,t.y)}}),"ontouchstart"in document.documentElement&&(n("touchstart",!0),n("touchmove"),n("touchend"),n("touchcancel"),r("gesturestart"),r("gesturechange"),r("gestureend"));var y=1,p=0;if(navigator.msMaxTouchPoints||navigator.maxTouchPoints){var x=["MSPointerDown","pointerdown"],w=["MSPointerMove","pointermove"],M=["MSPointerUp","pointerup"],b=["MSPointerCancel","pointercancel"];t(x,function(e){if(e.target.id in z&&l(e)){U[e.target.id]||f(e.target.id),B++,U[e.target.id].addPointer(e.pointerId);var t=c(e,"ADD");z[e.target.id].touchstart(u(e,"ADD"),t),e.preventDefault()}}),t(w,h("touchmove","MOVE")),t(M,v("touchend")),t(b,v("touchcancel")),e(document,"MSHoldVisual",function(e){e.preventDefault()}),e(document,"MSGestureStart",function(e){var t=e.gestureObject.target.id,n=B>1;t in z&&n&&(z[t].gesturestart(),e.preventDefault())}),e(document,"MSGestureChange",function(e){var t=e.gestureObject.target.id,n=B>1&&e.detail!==e.MSGESTURE_FLAG_INERTIA;t in z&&n&&(y*=e.scale,p+=180*e.rotation/Math.PI,z[t].gesturechange(y,p),e.preventDefault())}),e(document,"MSGestureEnd",function(e){var t=e.gestureObject.target.id;t in z&&(z[t].gestureend(y,p),d(),e.preventDefault())})}e(window,"mousedown",function(e){if(e.target.id in z&&z[e.target.id].canvas){var t=N(e);z[e.target.id].mousedown(e.button,t.x,t.y,e.ctrlKey,e.shiftKey)}}),e(window,"mouseup",function(e){if(e.target.id in z&&z[e.target.id].canvas){var t=N(e);z[e.target.id].mouseup(t.x,t.y,e.ctrlKey,e.shiftKey)}});var k=null;e(window,"mousemove",function(e){if(e.target.id in z){if(g(e.target.id,e),z[e.target.id].canvas){var t=N(e);z[e.target.id].mousemove(t.x,t.y,e.ctrlKey,e.shiftKey)}}else g(null,e)}),e(window,"dblclick",function(e){if(e.target.id in z&&z[e.target.id].canvas){var t=N(e);z[e.target.id].dblclick(t.x,t.y,e.ctrlKey,e.shiftKey),e.preventDefault()}}),t(["wheel","mousewheel","DOMMouseScroll"],m),e(document,"MozMousePixelScroll",function(e){z[e.target.id]&&s(e)}),e(document,"keyup",function(e){e.target&&e.target.id in z&&z[e.target.id].canvas&&z[e.target.id].keyup(e.keyCode)}),e(document,"keydown",function(e){var t=!1;e.target&&e.target.id in z&&z[e.target.id].canvas&&(t=t||z[e.target.id].keydown(e.keyCode,e.ctrlKey,e.shiftKey)),t&&e.preventDefault&&e.preventDefault()})}function l(e){e in z&&delete z[e]}function f(e){e in z||(z[e]={})}function d(e,t){var n=t?"_klidc":"_klid";if(!e[n]){var r="sink"+ ++F;KeyLines[r]=function(){var n=[].slice.call(arguments);if(t){for(var r=[],i=0;i<n.length;i++)r.push(KeyLines.Util.arrayToDict(n[i]));n=r}return e.apply(this,n)},e[n]=r}return e[n]}function h(e,t,n,r,i){var a;if(n.length>0){var o=n[n.length-1];KeyLines.Util.isFunction(o)&&(a=d(o,i),n.pop())}var u=e.callAPI(t,n,a,r,i);return i&&(u=KeyLines.Util.arrayToDict(u)),u}function v(e){function t(e,t,n,i){e[t]=function(){var e=[].slice.call(arguments);return h(r,t,e,n,i)}}for(var n=z[e],r=document.getElementById(e),i=r.privateFunctionNames(),a=r.privateFunctionDefinitions(),o=0;o<i.length;o++){var u=i[o];t(n,u,null,a[u])}var s=r.privateNamespaceDefinitions();for(var c in s)!function(){for(var e={},i=r.privateNamespaceNames(c),a=0;a<i.length;a++)t(e,i[a],c,s[c][i[a]]);n[c]=function(){return e}}()}function g(e,t){KeyLines.Util.invoke(t,new Error('Cannot create KeyLines component. No element with id "'+e+'" exists in the DOM'))}function m(e){return+e.replace(/px$/,"")}function y(e,t,n,r){function i(e,t){e?KeyLines.Util.invoke(r,e):t.options(n,function(){r&&r(null,t)})}var a=document.getElementById(t);if(!a)return g(t,r);var o=a.clientWidth||m(a.style.width),u=a.clientHeight||m(a.style.height);w(e,t,o,u,n?i:r)}function p(){H=document.createElement("span"),H.style.position="absolute",H.style.left="-10000px",H.style.top="-10000px",H.style.visibility="hidden",H.style.lineHeight="normal",H.style.fontSize="200px",H.style.fontVariant="normal",H.style.fontStyle="normal",H.style.letterSpacing="0",H.style.width="auto",H.style.height="auto",H.style.display="block",H.style.margin=0,H.style.padding=0,H.style.whiteSpace="nowrap"}function x(e,t,n){function r(){var e=H.offsetWidth,t=(new Date).getTime()-f,a=e!==c,o=0;for(l in u)e!==u[l]&&o++;a=a&&o>1,d||a||t>i?n():setTimeout(r,16)}var i=1e4,a=["sans-serif","Verdana","serif"];H.style.fontWeight=t,H.innerHTML="giItT1WQy@!-/#|";var o=!H.parentNode;o&&document.body.appendChild(H);for(var u={},s=0;s<a.length;s++)H.style.fontFamily=a[s],u[a[s]]=H.offsetWidth;var c="bold"===t?1606:1522;H.style.fontFamily=e;var l,f=(new Date).getTime(),d=e in u;r()}function w(e,t,n,r,i){l(t),n||(n=100),r||(r=100);var a="flash"!==_;if(a&&q()&&M())Z(e,t,n,r,i);else{if("canvas"===_){var o="Could not create HTML5 canvas. Try using auto or flash mode.";return i(o),void 0}nt(e,t,n,r,i)}}function M(){return"undefined"!=typeof KeyLines.Canvas}function b(e,t){var n=z[t];n.id=function(){return t},"chart"===e?KeyLines.API.appendExtras(n,t):"timebar"===e&&KeyLines.TimeBar.API.appendExtras(n)}function k(e){var t=document.getElementById(e);return t?t.clientWidth/Number(t.width):void 0}function L(t){var n=document.getElementById(t),r=n.parentNode;r.addEventListener||(e(r,"mousedown",function(e){if(e.button>1&&e.srcElement.id===t){r.setCapture();var i=e.button<4?2:1;u("down",t,n,i,e)}},!0),e(r,"mouseup",function(e){e.srcElement.id===t&&u("up",t,n,null,e),r.releaseCapture()},!0))}function T(e,t){Q[e]&&J[e]&&(Q[e]=!1,J[e]=!1,L(e),b(t,e),et[e]&&et[e](null,z[e]))}function S(e){if("undefined"!=typeof swfobject)return e();var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=V,n.onreadystatechange=e,n.onload=e,t.appendChild(n)}function C(){return I(["webkitIsFullScreen","mozFullScreen","msFullscreenElement","fullScreenElement"])}function I(e){for(var t=KeyLines.Util.defined,n=0;n<e.length;n++)if(t(document[e[n]]))return!!document[e[n]];return!1}function O(e){var t=KeyLines.Util.defined;return t(document.webkitCurrentFullScreenElement)?document.webkitCurrentFullScreenElement===e:t(document.mozFullScreenElement)?document.mozFullScreenElement===e:t(document.msFullscreenElement)?document.msFullscreenElement===e:void 0}function E(e,t){for(var n,r=0;!n&&r<t.length;r++)e[t[r]]&&(n=!0,e[t[r]]())}function D(e){E(e,["requestFullScreen","mozRequestFullScreen","webkitRequestFullScreen","msRequestFullscreen"])}function P(){rt&&rt(C())}var z=KeyLines.components={};KeyLines.charts=z;var A={},B=0,U={};c();var N=KeyLines.coords=function(e){return K(e,a(e).id)},K=function(e,t){var i=R(t),a=Math.floor(n(e)-i.left),o=Math.floor(r(e)-i.top);return{x:a,y:o}},R=KeyLines.getOffset=function(e){var t=document.getElementById(e),n={top:0,left:0};t&&(n=t.getBoundingClientRect());var r=window.pageXOffset||0===window.pageXOffset?window.pageXOffset:document.body.scrollLeft,i=window.pageYOffset||0===window.pageYOffset?window.pageYOffset:document.body.scrollTop;return{top:n.top+i-document.documentElement.clientTop,left:n.left+r-document.documentElement.clientLeft}},F=0,_="auto";KeyLines.mode=function(e){return e&&(_=e),_},KeyLines.createChart=function(){var e,t,n,r;switch(arguments.length){case 0:throw new Error("createChart called with zero arguments");case 1:case 2:e=arguments[0],r=arguments[1];var i=document.getElementById(e);if(!i)return g(e,r);t=i.clientWidth,n=i.clientHeight;break;default:e=arguments[0],t=Number(arguments[1]),n=Number(arguments[2]),r=arguments[3]}w("chart",e,t,n,r)},KeyLines.create=function(e,t){var n=KeyLines.Util,r=n.ensureArray(e);if(r.length<1)return n.invoke(t,new Error("No definition passed to KeyLines.create")),void 0;var i=0,a=[],o=function(){var e=r[i],u=e.id||e;y(e.type||"chart",u,e.options,function(e,u){if(e)n.invoke(t,e);else if(a[i]=u,i++,i>=r.length){var s=1===i?u:a;t&&t(null,s)}else o()})};KeyLines.fontsLoader([KeyLines.Rendering.defaultFamily],o)};var H,j={};KeyLines.fontsLoader=function(e,t){function n(){var t=e[i];j[t]?setTimeout(r,0):(j[t]=!0,x(t,"normal",function(){x(t,"bold",r)}))}function r(){i===e.length-1?(H.parentNode&&H.parentNode.removeChild(H),t()):(i++,n())}if(!e.length||!q())return KeyLines.Util.invoke(t);H||p();var i=0;n()},KeyLines.getFontIcon=function(e){H||p(),document.body.appendChild(H);var t=e.replace(/\./g,"");H.className!==t&&(H.className=t);var n=window.getComputedStyle(H,":before").getPropertyValue("content");return H.parentNode&&H.parentNode.removeChild(H),H.className="",n.charCodeAt(1)||n.charCodeAt(0)};var Y,G,W=KeyLines.setCanvasPaths=function(e){Y=e};KeyLines.imageBasePath=function(e){return e&&(G=e),G},W("assets/");var q=KeyLines.html5CanvasSupport=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},Z=function(e,t,n,r,i){f(t);try{z[t]=KeyLines.Canvas.create(e,t,n,r,Y,G)}catch(a){if(i)return i(a)}z[t].canvas=!0,b(e,t),i&&i(null,z[t])};KeyLines.flashInitialized=function(e,t){f(e),v(e),z[e].canvas=!1,J[e]=!0,T(e,t)},KeyLines.setSize=function(e,t,n){if(!(0>=t||0>=n)){var r=document.getElementById(e);r&&(r.style.height=n+"px",r.style.width=t+"px",z[e]&&z[e].canvas&&z[e].internalSetSize(t,n,1))}},KeyLines.getElementWidth=function(e){var t=document.getElementById(e);return t?t.clientWidth:void 0};var V,X,$,Q={},J={},et={},tt=KeyLines.setFlashPaths=function(e,t,n){X=e,V=t,$=n},nt=function(e,t,n,r,i){et[t]=i,Q[t]=!1,J[t]=!1,S(function(){var a={identifier:t,widget:e,assets:Y},o={menu:"false",quality:"best",wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all"},u={};"undefined"!=typeof swfobject&&(Q[t]||swfobject.embedSWF(X,t,n,r,"10.0.0",$,a,o,u,function(n){n.success?(Q[t]=!0,T(t,e)):i("swfobject embedSWF returned error "+n)}))})};KeyLines.paths=function(e){return e&&(e.assets&&W(e.assets),e.flash&&tt(e.flash.swf,e.flash.swfObject,e.flash.expressInstall),e.images&&KeyLines.imageBasePath(e.images)),{assets:Y,flash:{swf:X,swfObject:V,expressInstall:$},images:G}},document.addEventListener&&t(["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"],P),KeyLines.fullScreenCapable=function(){if(!document.addEventListener)return!1;var e=KeyLines.Util.defined;return e(document.webkitCurrentFullScreenElement)?!0:e(document.mozFullScreenElement)?!0:e(document.msFullscreenEnabled)?document.msFullscreenEnabled:!1};var rt;KeyLines.toggleFullScreen=function(e,t){document.addEventListener&&(rt=t,C()?O(e)?E(document,["cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen"]):D(e):D(e))},KeyLines.dashedLineSupport=function(){if(q()){var e=document.createElement("canvas"),t=e.getContext("2d");return!!t.setLineDash||!!t.mozDash||!!t.webkitLineDash}return!1},KeyLines.hasConsole=function(){return"undefined"!=typeof console}}(),!function(){var e=KeyLines.Draggers={};e.createDraggers=function(e){var t,n=KeyLines.Util,r={};return r.setOptions=function(e){t=e.fanLength},r.primitiveMover=function(t,r,i,a,o,u,s,c,l,f){function d(e,t){return{dx:e-c,dy:t-l}}function h(e,t,r,i){var a,o={};if(s.length>0){o.x1=o.x2=o.y1=o.y2=0;for(var u=0;u<s.length;u++){a=s[u];var c="x"===a.charAt(0)?e:t;o[a]=c}r&&(0!==o.x1&&(o.x2=-o.x1),0!==o.x2&&(o.x1=-o.x2),0!==o.y1&&(o.y2=-o.y1),0!==o.y2&&(o.y1=-o.y2))}else i&&(e=Math.abs(e)>Math.abs(t)?e:0,t=0!==e?0:t),o.x1=o.x2=e,o.y1=o.y2=t;for(var l={},f=["x1","y1","x2","y2"],d=0;d<f.length;d++)a=f[d],l[a]=g[a]+o[a];if(i){var h=g.x2-g.x1,v=g.y2-g.y1;if(Math.abs(h)>0&&Math.abs(v)>0){var m,y=v/h,p=l.x2-l.x1,x=l.y2-l.y1,w=Math.abs(e)>Math.abs(t);if(w){var M=Math.floor(y*(h+p)-v)-x;r||!n.contains(s,"y1")&&!n.contains(s,"y2")?(m=Math.floor(M/2),l.y1-=m,l.y2+=m):(n.contains(s,"y1")&&(l.y1-=M),n.contains(s,"y2")&&(l.y2+=M))}else{var b=Math.floor((v+x)/y-h)-p;r||!n.contains(s,"x1")&&!n.contains(s,"x2")?(m=Math.floor(b/2),l.x1-=m,l.x2+=m):(n.contains(s,"x1")&&(l.x1-=b),n.contains(s,"x2")&&(l.x2+=b))}}}return l}function v(e,t,n,r){var i=d(e,t);return h(i.dx,i.dy,n,r)}if(!e.trigger("dragstart","resize",a,i.unscale(c),i.unscale(l),null)){var g=t.extents(r,o),m={};for(var y in o)m[y]=o[y];t.setAlpha(m,.5);var p={scrollable:!0,getCursor:function(){return u?"crosshair":"move"},generate:function(e){e.copyPrimitive(m)},dragMove:function(e,n,i,a){var o=v(e,n,i,a);t.setExtents(m,o.x1,o.y1,o.x2,o.y2,r)},endDrag:function(n,u,s,c,l){i.cancelScroll();var d=e.trigger("dragend","resize",a,i.unscale(u),i.unscale(s));if(!d&&n){var h=v(u,s,c,l);t.setExtents(o,h.x1,h.y1,h.x2,h.y2,r),f(o)}e.trigger("dragcomplete","resize",a,i.unscale(u),i.unscale(s))}};return p}},r.createHandDragger=function(t,r,i,a){function o(e,t){h=h||Math.abs(r-e)>10||Math.abs(i-t)>10,f=e-r,d=t-i,s&&(s.x||(f=0),s.y||(d=0))}function u(){h&&(t.offsetX(c+f),t.offsetY(l+d),e.trigger("viewchange"))}var s={x:!0,y:!0},c=t.offsetX(),l=t.offsetY(),f=0,d=0,h=!1,v="hand",g=e.trigger("dragstart",v,null,t.unscale(r),t.unscale(i));if(g){if(!n.isNormalObject(g))return a(),void 0;for(var m in g)s[m]=g[m]}return{animate:u,direction:s,dragMove:o,getCursor:function(){return"move"},endDrag:function(n,r,i){var s=e.trigger("dragend",v,null,t.unscale(r),t.unscale(i));h?(!s&&n?o(r,i):f=d=0,u()):a(),e.trigger("dragcomplete",v,null,t.unscale(r),t.unscale(i))}}},r.createDefaultDragger=function(t,r,i,a,o,u,s,c){function l(e){return v.add&&v.add[e]}function f(){for(var e in t)(i(e)||l(e))&&M[e]&&(t[e].x=M[e].x+C.dx,t[e].y=M[e].y+C.dy);for(var n in k)(i(n)||l(n))&&r[n]&&(r[n].y=k[n].y+C.dy)}function d(){for(var e in t)M[e]&&(t[e].x=M[e].x,t[e].y=M[e].y);for(var n in k)r[n]&&(r[n].y=k[n].y)}function h(e,t){return I=I||Math.abs(s-e)>10||Math.abs(c-t)>10,e=o?o.newToOldX(e):e,t=o?o.newToOldY(t):t,v&&(v.x||(e=x),v.y||(t=w)),{dx:I?e-x:0,dy:I?t-w:0}}var v={x:!0,y:!0,add:null},g=n.rawId(u),m="move",y=e.trigger("dragstart",m,g,o.unscale(s),o.unscale(c),n.subId(u));if(y)if(n.isArray(y))v.add=n.makeIdMap(y);else{if(!n.isNormalObject(y))return;for(var p in y)v[p]=y[p];n.isArray(v.add)&&(v.add=n.makeIdMap(v.add))}var x=o?o.newToOldX(s):s,w=o?o.newToOldY(c):c,M={};for(var b in t)M[b]={x:t[b].x,y:t[b].y};var k={};for(var L in r)"h"===r[L].st&&(k[L]={y:r[L].y||0});var T,S,C=h(s,c),I=!1,O={scrollable:!0,direction:v,animate:f,excludeHit:function(){var e={};return null!==g&&(e[g]=1),e},getCursor:function(){return"move"},dragMove:function(e,t){C=h(e,t)},mouseMoved:function(e){return e&&(T=!0),T},afterDraw:function(t,r,i){T=!1;var a=n.rawId(t);g!==a&&(void 0===S?S=a:a!==S&&(e.trigger("dragover",a,o.unscale(r),o.unscale(i),n.subId(t)),S=a))},endDrag:function(t,r,i){o.cancelScroll();var a=e.trigger("dragend",m,n.rawId(u),o.unscale(r),o.unscale(i));a?d():t&&I?(d(),C=h(r,i),e.trigger("prechange","move"),f()):d(),e.trigger("dragcomplete",m,n.rawId(u),o.unscale(r),o.unscale(i))}};return O},r.createLinkEndDragger=function(t,r,i,a,o,u,s,c,l){function f(e,t){a[o[u]].x=e,a[o[u]].y=t}function d(e,t){return e=i?i.newToOldX(e):e,t=i?i.newToOldY(t):t,{dx:e-m,dy:t-y}}function h(){return o["id1"===u?"id2":"id1"]}if(e.trigger("dragstart","dummy",l,i.unscale(s),i.unscale(c),null))return!1;var v,g,m=i?i.newToOldX(s):s,y=i?i.newToOldY(c):c,p=a[o[u]].x,x=a[o[u]].y,w=d(s,c),M=s,b=c,k=null,L={scrollable:!0,animate:function(){f(p+w.dx,x+w.dy)},getCursor:function(){return"move"},dragMove:function(e,n){w=d(e,n),M=e,b=n,k=t.hittest(e,n)},mouseMoved:function(e){return e&&(g=!0),g},afterDraw:function(t,r,a){g=!1;var o=n.rawId(t),u=n.subId(t);l===o&&(o=null,u=null),void 0===v?v=o:o!==v&&(e.trigger("dragover",o,i.unscale(r),i.unscale(a),u),v=o)},endDrag:function(t,s,c){i.cancelScroll();var l=e.trigger("dragend","dummy",k,i.unscale(s),i.unscale(c));if(!l)if(t)if(f(p,x),e.trigger("prechange","move"),k=n.rawId(k),a[k]&&k!==h()){delete a[o[u]],o[u]=k;var v={};v[o.id]=o,r.resetConnectionOffsets(v)}else w=d(s,c),f(p+w.dx,x+w.dy),k=null;else f(p,x);e.trigger("dragcomplete","dummy",k,i.unscale(s),i.unscale(c))}};return L},r.createLinkDragger=function(t,r,i,a,o,u,s){function c(e,t,n,r,i,a){return((n-e)*(t-a)-(e-i)*(r-t))/Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}function l(e,n){var r=i.newToOldX(e),o=i.newToOldY(n),u=t("x1",a),s=t("y1",a),l=t("x2",a),f=t("y2",a),g=c(u,s,l,f,r,o);v&&Math.abs(g-d)>8&&(v=!1),v||(Math.abs(g)<12&&(g=0),h=g)}function f(){a.off=h}if(e.trigger("dragstart","offset",s,i.unscale(o),i.unscale(u),n.subId(s)))return!1;var d=a.off?a.off:0,h=d;i.newToOldY(u),a.y,a.y;var v=!0,g=!1,m={scrollable:!0,animate:function(){f()},getCursor:function(){return"move"},dragMove:function(e,t){l(e,t),g=!0},endDrag:function(t,n,r){i.cancelScroll();var o=e.trigger("dragend","offset",s,i.unscale(n),i.unscale(r));o||(t&&g?(a.off=d,e.trigger("prechange","offset"),l(n,r),f()):a.off=d),e.trigger("dragcomplete","offset",s,i.unscale(n),i.unscale(r))}};return m},r}}(),!function(){function e(e,t,n){return function(){if(!n||!n()){var r,i=t[e];return i&&(r=i.apply(null,arguments)),r}}}var t=KeyLines.Common={};t.frameManager=function(e,t){var n=(new Date).getTime(),r=n>>10,i=0,a=!1,o=!0,u=0;return{frameRate:function(){return u},update:function(){var s=(new Date).getTime(),c=s>>10;c>r?(u=Math.round(i/(c-r)),i=0,r=c):i++;var l=t(s-n);n=s,a=a||l,a&&(a=!1,o&&e())},redraw:function(){a=!0},allowDraw:function(e){e&&!o&&(a=!0),o=e}}},t.animator=function(e){var t=[],n=[];return{push:function(r,i){r&&(r.queue=i,i?n.push(r):t.push(r),e())},cancel:function(){t=[],n=[],e()},animate:function(e,r,i){var a=!1,o=!1;if(t.length>0){var u=t;t=[];for(var s=0;s<u.length;s++)u[s].animate(e)&&(o=o||u[s].queue,t.push(u[s]));a=!0}return o||n.length>0&&(t.push(n.shift()),a=!0),r&&r.animate&&(r.animate(e),a=!0),i&&(a=a||i.animated()),a}}},t.makeValueAnimator=function(e,t){var n,r,i,a;return function(o,u,s){var c=t();c===o||a&&r===o||(n=c,r=o,i=0,a||(a={animate:function(e){i=Math.min(u,i+e);var o=0>=u?r:n+(r-n)*i/u;t(o);var c=u>i;return c||(a=null,KeyLines.Util.invoke(s)),c}},e.push(a,!1)))}};var n=["mousemove","mousedown","mouseup","mouseleave","mousewheel","dblclick","touchstart","touchmove","touchend","touchcancel","keyup","keydown","gesturestart","gesturechange","gestureend","dragover"];t.appendActions=function(t,r,i){for(var a=0;a<n.length;a++)t[n[a]]=e(n[a],r,i)},t.hitTester=function(e,t,n,r,i){function a(e){i&&i(e),s.clear(e,t,n),s.backFill(e,l,1,t,n),s.drawShadowCanvas(e,r,h,o,c.rawId),f=!1}var o,u,s=KeyLines.Rendering,c=KeyLines.Util,l=s.randomColour(),f=!0,d=5,h=function(){var e={},t={};return{getColour:function(n){if(n in e)return e[n];var r=s.randomColour(t);return e[n]=r,t[r]=n,r},getId:function(e){return t[e]||null}}}(),v={};return v.test=function(t,n,r){f&&v.draw();var i=e.getImageData(Math.floor(t),Math.floor(n),1,1).data,a=s.rgbtostring(i[0],i[1],i[2]);if(a===l)return null;var o=h.getId(a);return o?o:(r=r||1,r>d?null:t+r>d&&n+r>d?v.test(t-1,n-1,++r):v.test(t+1,n+1,++r))},v.dirty=function(){f=!0},v.exclusions=function(e){o=e},v.debugCanvas=function(e){u=e},v.draw=function(){a(e),u&&a(u)},v}}(),!function(){var e=KeyLines.TimeBar.Controller={};e.createController=function(e,t,n,r){function i(){e.trigger("redraw")}function a(e,n,r){W=e,j=n,Y=r,t.setSize(n,r);var i=G(j,Y);X=KeyLines.Common.hitTester(i.getContext("2d"),n,r,it)}function o(e){var t={};for(var n in mt){var r=mt[n];t[r]=!0}nt.imageLoader(e,q,t,function(e,t){vt={};for(var n in t)vt[n]={im:t[n]};i()})}function u(){xt._tbLeft=xt._tbRight='url("'+q+'openhand.cur"), pointer';for(var e in ht)xt[e]="pointer"}function s(){var e=null,t=tt.makeValueAnimator(at,function(t){return 0===arguments.length?e:(e=t,void 0)});return function(n){return r.options.heightChange.animate&&null!==e?t(n,r.options.heightChange.time):e=n,e}}function c(e,t){return e&&t?e.t1!==t.t1||e.t2!==t.t2:!0}function l(e,n){for(var r=t.getHistogram(),i="_tbBar"===Q,a=0;r.x[a+1]<n&&a<r.count;)a++;var o=i?r.value[a]:r.selvalues[e][a],u=i?r.maxvalue:r.maxselvalue,s=(r.x[a]+r.x[a+1])/2,c=t.getBounds().histogram,l=c.ybase,f=i?c.maxbarh:c.maxselh,d=Math.floor(f*o/u),h=l-d;return i||(h-=5),{x:s,y:h,v:o}}function f(n,r,i){Q=X.test(n,r),y(n,r)&&(J=t.findRange(n,r));var a=c(J,dt.lastRange);if("hover"!==i||Q!==dt.lastId||a){var o,u,s,f,d=n,h=r,v=null;if(y(n,r)&&(o=rt.unUTCify(J.t1),u=rt.unUTCify(J.t2),v="histogram"!==t.getClickedBar(r)?"scale":null),p()){v="bar","_tbBar"!==Q&&(v="selection",s=+Q.match(yt)[1]);var g=l(s,n);d=g.x,h=g.y,f=g.v}dt.lastId=Q,dt.lastRange=J,e.trigger(i,v,s,f,d,h,o,u)}}function d(e){V=!!e.extend,Z||(Z=!0,at.push({animate:function(e){var n=t.offsetRanges(Math.floor(t.getTimeRate()*(r.options.playSpeed||r.defaultPlaySpeed)*e/1e3),V);return Z&&n?(t.triggerTimeBarChanged(),!0):(Z=!1,!1)}}))}function h(e,n,i,a,o,u){var s=e.t1,c=e.t2,l=i-s,f=a-c;o=o||{};var d=o.time||r.defaultAnimationTime,h=d;at.push({animate:function(e){h=Math.max(0,h-e);var r=1-h/d,i=s+l*r,a=c+f*r;return n(i,a),0>=h&&(t.triggerTimeBarChanged(),et.invoke(u)),h>0}})}function v(e,n,r,i){var a=t.limitInnerRange(e,n);h(t.getInnerRange(),t.setInner,a.t1,a.t2,r,i)}function g(e,n,r,i){r.animate?v(e,n,r,i):(t.setInner(e,n),t.triggerTimeBarChanged(),et.invoke(i))}function m(e,n,r,i){h(t.getOuterRange(),t.setOuter,e,n,r,i)}function y(e,n){return t.inMainBarOrHistogram(e,n)||yt.test(Q)}function p(){return"_tbBar"===Q||yt.test(Q)}function x(e,t){return Math.min(t.max,Math.max(t.min,e))}function w(e){return function(n){var i=t.getInnerRange()[e],a=t.getSideLimits(e);return{getCursor:function(){return"ew-resize"},dragMove:function(r){t.setInnerRangeSide(e,x(i+(r-n)*t.getTimeRate(),a)),t.triggerTimeBarChanged()},endDrag:function(){if("fixed"===r.options.sliders){var e=t.getInnerRange(),n=(e.t2-e.t1)*r.fixedSideFactor;m(e.t1-n,e.t2+n,{time:r.sliderReleaseTime})}}}}}function M(e,t){(ct.x!==e||ct.y!==t)&&(ct.x=e,ct.y=t,i())
}function b(){M(-1,-1)}function k(){(Q in ht||dt.lastId in ht)&&i()}function L(e,n,r){var i=t.nextPage(e);g(i.t1,i.t2,n,r)}function T(e){var n=t.getInnerRange().t1;return{getCursor:function(){return"move"},dragMove:function(i){var a=Math.floor((e-i)*t.getTimeRate());"free"===r.options.sliders&&(a=-1*a),t.offsetRanges(a+(n-t.getInnerRange().t1)),t.triggerTimeBarChanged()},endDrag:function(){}}}function S(e){return e[0].x>e[1].x?{xmin:e[1].x,xmax:e[0].x}:{xmin:e[0].x,xmax:e[1].x}}function C(e){var n=S(e),i=t.xtot(n.xmin),a=t.xtot(n.xmax),o=a-i,u=t.getInnerRange(),s=t.ttox(u.t1),c=t.ttox(u.t2);return{pinchMove:function(e){var u=S(e);if("free"===r.options.sliders){var l=s+(u.xmin-n.xmin),f=c+(u.xmax-n.xmax);t.setInner(t.xtot(l),t.xtot(f))}else if(u.xmax!==u.xmin){var d=o/(u.xmax-u.xmin),h=Math.floor(i-d*(u.xmin-s)),v=Math.floor(a+d*(c-u.xmax));t.setInner(h,v),t.triggerTimeBarChanged()}},endPinch:function(){}}}function I(e){var t=K(X.test(e.x,e.y));return Mt[t]}function O(e,t,n,r,i){lt&&(lt.endDrag(!1,t,n,r,i),lt=null,ut("auto"))}function E(){ft&&(ft=null)}function D(e,t,n,r){b(),O(!1,e,t,n,r)}function P(e,n,r,i,a){i=et.defaults(i,{animate:!0,time:200}),r=r||.5;var o=e>0?r:1/r,u=t.getInnerRange(),s=u.t1,c=u.t2,l=c-s,f=l*o,d=(n-u.t1)/(u.t2-u.t1);s=Math.floor(s-(f-l)*d),c=Math.floor(c+(f-l)*(1-d)),g(s,c,i,a)}function z(e,n){var r;if(r=e&&e.id?t.getRangeForIds(e.id):t.dataRange()){var i=e&&et.isNumber(e.pad)?e.pad:0;if(i=Math.max(i,0),0!==i){var a=Math.floor((r.t2-r.t1)*i/100);r.t1-=a,r.t2+=a}ot.range(r.t1,r.t2,e,n)}else et.invoke(n)}function A(){var e=t.getInnerRange();return(e.t1+e.t2)/2}function B(e,t,n){P(e,A(),.5,t,n)}function U(e,t){B(1,e,t)}function N(e,t){B(-1,e,t)}function K(e){return yt.test(e)&&(e="_tbLine"),e}function R(e,t,n){var i=X.test(e,t);n||("_tbplay"===i?ot.play():"_tbplayextend"===i?ot.play({extend:!0}):"_tbpause"===i?ot.pause():"_tbnext"===i?ot.pan("forward"):"_tbprev"===i?ot.pan("back"):"_tbfit"===i?z():"_tbzoomin"===i?"free"===r.options.sliders?N():U():"_tbzoomout"===i&&("free"===r.options.sliders?U():N())),i=K(i),wt[i]&&(lt=wt[i](e,t),ut(lt.getCursor(e,t)))}function F(e,t){if(1===e.length)R(e[0].x,e[0].y,!t),f(e[0].x,e[0].y,"touchdown");else if(2===e.length){var n=I(e[0]),r=I(e[1]);n&&n===r&&(ft=n(e))}}function _(e,n){if(t.inMainBarOrHistogram(e,n)){var i=t.findRange(e,n);i=t.limitInnerRange(i.t1,i.t2,!0);var a="free"===r.options.sliders?r.doubleClickZoomTimeFree:r.doubleClickZoomTime;v(i.t1,i.t2,{time:a})}}function H(e){var t=!1;return 1===e.length&&(gt?(_(e[0].x,e[0].y),t=!0):gt=setTimeout(function(){gt=null},600)),t}var j,Y,G,W,q,Z,V,X,$,Q,J,et=KeyLines.Util,tt=KeyLines.Common,nt=KeyLines.Rendering,rt=KeyLines.DateTime,it=nt.instructionPool(),at=tt.animator(i),ot={},ut=function(){},st=new Date/13162,ct={x:-1,y:-1},lt=null,ft=null,dt={lastId:null,lastRange:null},ht={_tbfit:1,_tbzoomout:1,_tbzoomin:1,_tbprev:1,_tbpause:1,_tbplay:1,_tbplayextend:1,_tbnext:1};ot.privateInit=function(e,n,r,i,s,c,l){G=i,ut=s,q=l,o(c),u(),a(e,n,r),t.setInner(rt.UTCify(new Date(2011,4,6)),rt.UTCify(new Date))},ot.privateSetSize=function(e,t,n){var r=ot.range();a(e,t,n),ot.range(r.dt1,r.dt2)},ot.imageList=function(){return vt},ot.imageNames=function(){return mt},ot.isPlayingFixed=function(){return Z&&!V},ot.isPlayingExtend=function(){return Z&&V},ot.selectionRegExp=function(){return yt},ot.animate=at.animate,ot.draw=function(){if(vt){it.reset(),n.generate(ot,t,W,it,r,ct,Q),nt.clear(W,j,Y);var e=110913751-st;e===Math.abs(e)&&nt.draw(W,it,vt),X.dirty()}},ot.range=function(e,n,r,i){if(0===arguments.length){var a=t.getInnerRange();return{dt1:rt.unUTCify(a.t1),dt2:rt.unUTCify(a.t2)}}if(et.isNullOrUndefined(e)||et.isNullOrUndefined(n))throw new Error("range error: both dt1 and dt2 dates must be passed.");var o=et.defaults(r,{animate:!0}),u=t.extractUTC(e),s=t.extractUTC(n),c=t.limitInnerRange(u,s,!0);g(c.t1,c.t2,o,i)},ot.play=function(e){e=e||{},d(e)},ot.pan=function(e,t,n){t=et.defaults(t,{animate:!0}),L(e||"forward",t,n)},ot.zoom=function(e,t,n){switch(e){case"in":U(t,n);break;case"out":N(t,n);break;case"fit":z(t,n)}},ot.pause=function(){Z=!1},ot.options=function(e,n){return e&&(r.setOptions(e),t.updateOptions(),i()),et.invoke(n),r.getOptions()},ot.animateBarHeight=s(),ot.animateSelHeight=s();var vt,gt,mt={play:"TBPlay.png",pause:"TBPause.png",next:"TBNext.png",prev:"TBPrev.png",fit:"TBFit.png",playextend:"TBPlayExtend.png",zoomin:"TBZoomIn.png",zoomout:"TBZoomOut.png"},yt=/^_tbLine(.)/,pt=et.ratelimit(f,r.hoverTime),xt={},wt={_tbBar:T,_tbHisto:T,_tbLine:T,_tbMain:T,_tbLeft:w("t1"),_tbRight:w("t2")},Mt={_tbBar:C,_tbHisto:C,_tbLine:C,_tbMain:C};return ot.mousedown=function(e,t,n){R(t,n),f(t,n,"click")},ot.mousewheel=function(e,n,i){var a;return a="free"===r.options.sliders?A():t.xtot(n),t.inMainBarOrHistogram(n,i)&&P(e,a,.65,{animate:!0}),!0},ot.dblclick=function(e,t){_(e,t)},ot.mousemove=function(e,n,r,i){t.inMainBarOrHistogram(e,n)?M(e,n):b();var a;lt?(a=lt.getCursor(e,n),lt.dragMove(e,n,r,i)):(Q=X.test(e,n),a=xt[K(Q)]||"auto"),k(),$!==a&&($=a,ut(a)),pt(e,n,"hover")},ot.mouseup=function(e,t,n,r){O(!0,e,t,n,r)},ot.mouseleave=function(e,t,n,r){arguments.length&&D(e,t,n,r),Q=null,k()},ot.touchstart=function(e){H(e)||F(e,!0)},ot.touchmove=function(e){ft?ft.pinchMove(e):lt&&lt.dragMove(e[0].x,e[0].y,!1,!1)},ot.touchend=function(e){E(),O(!1),F(e,!1)},ot.touchcancel=function(){E(),O(!1)},ot.keydown=function(e,t,n){if(!t&&!n&&32===e){var r=Z?"pause":"play";return ot[r]({extend:V}),!0}},ot}}();;

